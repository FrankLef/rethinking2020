<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>rethinking2020 - 14&nbsp; Adventures in Covariance</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./references.html" rel="next">
<link href="./ch13_multilevels.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="site_libs/htmlwidgets-1.6.2/htmlwidgets.js"></script>
<script src="site_libs/plotly-binding-4.10.2/plotly.js"></script>
<script src="site_libs/typedarray-0.1/typedarray.min.js"></script>
<script src="site_libs/jquery-3.5.1/jquery.min.js"></script>
<link href="site_libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet">
<script src="site_libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>
<link href="site_libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="site_libs/plotly-main-2.11.1/plotly-latest.min.js"></script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./ch14_covariances.html"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Adventures in Covariance</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">rethinking2020</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch01_golem.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">The Golem of Prague</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch02_worlds.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Small Worlds and Large Worlds</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch03_sampling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Sampling the Imaginary</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch04_linear.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Linear Models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch05_multivariate.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Multivariate Linear Models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch06_scm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Structural Causal Models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch07_information.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Ulysses’ Compass</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch08_interactions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Conditional Manatees</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch09_mcmc.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Markov Chain Monte Carlo</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch10_glm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Big Entropy and the Generalized Linear Model</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch11_counting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Counting and Classification</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch12_mixed.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Monsters and Mixtures</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch13_multilevels.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Multilevel Models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch14_covariances.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Adventures in Covariance</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#varying-slopes-by-construction" id="toc-varying-slopes-by-construction" class="nav-link active" data-scroll-target="#varying-slopes-by-construction"><span class="header-section-number">14.1</span> Varying slopes by construction</a>
  <ul class="collapse">
  <li><a href="#simulate-the-population" id="toc-simulate-the-population" class="nav-link" data-scroll-target="#simulate-the-population"><span class="header-section-number">14.1.1</span> Simulate the population</a></li>
  <li><a href="#simulate-the-observations-visits-by-cafe" id="toc-simulate-the-observations-visits-by-cafe" class="nav-link" data-scroll-target="#simulate-the-observations-visits-by-cafe"><span class="header-section-number">14.1.2</span> Simulate the observations (visits by cafe)</a></li>
  <li><a href="#the-varying-slopes-model" id="toc-the-varying-slopes-model" class="nav-link" data-scroll-target="#the-varying-slopes-model"><span class="header-section-number">14.1.3</span> The varying slopes model</a></li>
  </ul></li>
  <li><a href="#advanced-varying-slopes" id="toc-advanced-varying-slopes" class="nav-link" data-scroll-target="#advanced-varying-slopes"><span class="header-section-number">14.2</span> Advanced varying slopes</a></li>
  <li><a href="#instruments-and-causal-designs" id="toc-instruments-and-causal-designs" class="nav-link" data-scroll-target="#instruments-and-causal-designs"><span class="header-section-number">14.3</span> Instruments and Causal designs</a></li>
  <li><a href="#social-relations-as-correlated-varying-effects" id="toc-social-relations-as-correlated-varying-effects" class="nav-link" data-scroll-target="#social-relations-as-correlated-varying-effects"><span class="header-section-number">14.4</span> Social relations as correlated varying effects</a>
  <ul class="collapse">
  <li><a href="#data" id="toc-data" class="nav-link" data-scroll-target="#data"><span class="header-section-number">14.4.1</span> Data</a></li>
  <li><a href="#model" id="toc-model" class="nav-link" data-scroll-target="#model"><span class="header-section-number">14.4.2</span> Model</a></li>
  </ul></li>
  <li><a href="#continuous-categories-and-the-gaussian-process" id="toc-continuous-categories-and-the-gaussian-process" class="nav-link" data-scroll-target="#continuous-categories-and-the-gaussian-process"><span class="header-section-number">14.5</span> Continuous categories and the Gaussian process</a>
  <ul class="collapse">
  <li><a href="#spatial-autocorrelation-in-oceanic-tools" id="toc-spatial-autocorrelation-in-oceanic-tools" class="nav-link" data-scroll-target="#spatial-autocorrelation-in-oceanic-tools"><span class="header-section-number">14.5.1</span> Spatial autocorrelation in Oceanic tools</a></li>
  <li><a href="#phylogenic-distance" id="toc-phylogenic-distance" class="nav-link" data-scroll-target="#phylogenic-distance"><span class="header-section-number">14.5.2</span> Phylogenic distance</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary"><span class="header-section-number">14.6</span> Summary</a></li>
  <li><a href="#practice" id="toc-practice" class="nav-link" data-scroll-target="#practice"><span class="header-section-number">14.7</span> Practice</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="Covariance" class="quarto-section-identifier"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Adventures in Covariance</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>Some options to facilitate the computations</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#  For execution on a local, multicore CPU with excess RAM</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">mc.cores =</span> parallel<span class="sc">::</span><span class="fu">detectCores</span>())</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co">#  To avoid recompilation of unchanged Stan programs</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">rstan_options</span>(<span class="at">auto_write =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The default theme used by <code>ggplot2</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(ggthemes<span class="sc">::</span><span class="fu">theme_stata</span>(<span class="at">base_size =</span> <span class="dv">11</span>, <span class="at">base_family =</span> <span class="st">"sans"</span>, </span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>                                <span class="at">scheme =</span> <span class="st">"s2color"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="varying-slopes-by-construction" class="level2" data-number="14.1">
<h2 data-number="14.1" class="anchored" data-anchor-id="varying-slopes-by-construction"><span class="header-section-number">14.1</span> Varying slopes by construction</h2>
<section id="simulate-the-population" class="level3" data-number="14.1.1">
<h3 data-number="14.1.1" class="anchored" data-anchor-id="simulate-the-population"><span class="header-section-number">14.1.1</span> Simulate the population</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>simCafes <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>simCafes <span class="ot">&lt;-</span> <span class="fu">within</span>(simCafes, {</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># a := average morning wait time</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># b := average difference afternoon wait time</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  Mu <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"a"</span> <span class="ot">=</span> <span class="fl">3.5</span>, <span class="st">"b"</span> <span class="ot">=</span> <span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># a := std dev of intercepts</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># b := std dev of slopes</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  sigmas <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"a"</span> <span class="ot">=</span> <span class="dv">1</span>, <span class="st">"b"</span> <span class="ot">=</span> <span class="fl">0.5</span>)</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># correlation between intercepts and slopes</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  rho <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fl">0.7</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>  cov_ab <span class="ot">&lt;-</span> <span class="fu">prod</span>(sigmas) <span class="sc">*</span> rho</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>McElreath mentions a difficulty using the <code>matrix</code> function. He misses the argument <code>byrow</code> which resolve this.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># use byrow = TRUE to solve McElrath's issue</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">matrix</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2]
[1,]    1    2
[2,]    3    4</code></pre>
</div>
</div>
<p>we get the covariance matrix <code>sigma</code> as follows</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>simCafes <span class="ot">&lt;-</span> <span class="fu">within</span>(simCafes, {</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># matrix of correlation</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  Rho <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>, rho, rho, <span class="dv">1</span>), <span class="at">nrow =</span> <span class="dv">2</span>)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># covariance matrix</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  Sigma <span class="ot">&lt;-</span> <span class="fu">diag</span>(sigmas) <span class="sc">%*%</span> Rho <span class="sc">%*%</span> <span class="fu">diag</span>(sigmas)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>and we simulate the bivariate normal distribution</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>simCafes <span class="ot">&lt;-</span> <span class="fu">within</span>(simCafes, {</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  n_cafes <span class="ot">&lt;-</span> <span class="dv">20</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">1409</span>)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  vary_effects <span class="ot">&lt;-</span> MASS<span class="sc">::</span><span class="fu">mvrnorm</span>(<span class="at">n =</span> n_cafes, <span class="at">mu =</span> Mu, <span class="at">Sigma =</span> Sigma) <span class="sc">|&gt;</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.data.frame</span>() <span class="sc">|&gt;</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">cafe =</span> <span class="fu">seq_len</span>(n_cafes)) <span class="sc">|&gt;</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">relocate</span>(cafe)</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="co"># glimpse(simCafes$vary_effects)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>and we plot the simulated data which represents the intercept and slope</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>simCafes<span class="sc">$</span>vary_effects <span class="sc">|&gt;</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> a, <span class="at">y =</span> b)) <span class="sc">+</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">3</span>, <span class="at">color =</span> <span class="st">"purple"</span>) <span class="sc">+</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lapply</span>(<span class="at">X =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span> <span class="sc">/</span> <span class="dv">5</span>, <span class="at">FUN =</span> <span class="cf">function</span>(x) {</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">stat_ellipse</span>(<span class="at">type =</span> <span class="st">"norm"</span>, <span class="at">level =</span> x, <span class="at">linetype =</span> <span class="st">"dotted"</span>, <span class="at">size =</span> <span class="fl">0.25</span>)}) <span class="sc">+</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">sprintf</span>(<span class="st">"Distribution of intercept and slopes for %d cafes"</span>, </span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>                       simCafes<span class="sc">$</span>n_cafes),</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"intercepts (a_cafe)"</span>, <span class="at">y =</span> <span class="st">"slope (b_cafe)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.
ℹ Please use `linewidth` instead.</code></pre>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="ch14_covariances_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure 14.2</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="simulate-the-observations-visits-by-cafe" class="level3" data-number="14.1.2">
<h3 data-number="14.1.2" class="anchored" data-anchor-id="simulate-the-observations-visits-by-cafe"><span class="header-section-number">14.1.2</span> Simulate the observations (visits by cafe)</h3>
<p>Now using the simulated intercepts and slopes, we create the simulated visits to each cafe.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>simCafes <span class="ot">&lt;-</span> <span class="fu">within</span>(simCafes, {</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  n_visits <span class="ot">&lt;-</span> <span class="dv">10</span>  <span class="co"># nb of visits to each cafe by robot</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  sigma <span class="ot">&lt;-</span> <span class="fl">0.5</span>  <span class="co"># std dev within cafes</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">1409</span>)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> vary_effects <span class="sc">|&gt;</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">expand_grid</span>(simCafes<span class="sc">$</span>cafe, <span class="st">"visit"</span> <span class="ot">=</span> <span class="fu">seq_len</span>(n_visits)) <span class="sc">|&gt;</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">afternoon =</span> <span class="fu">rep</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>, <span class="at">times =</span> <span class="fu">n</span>()<span class="sc">/</span><span class="dv">2</span>)) <span class="sc">|&gt;</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">mu =</span> a <span class="sc">+</span> b <span class="sc">*</span> afternoon) <span class="sc">|&gt;</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">wait =</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="fu">n</span>(), <span class="at">mean =</span> mu, <span class="at">sd =</span> sigma))</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a><span class="co"># glimpse(simCafes$vary_effects)</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="co"># glimpse(simCafes$data)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>and plot the simulated observations.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>simCafes<span class="sc">$</span>data <span class="sc">|&gt;</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">afternoon =</span> <span class="fu">if_else</span>(afternoon <span class="sc">==</span> <span class="dv">0</span>, <span class="st">"M"</span>, <span class="st">"A"</span>),</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">day =</span> <span class="fu">rep</span>(<span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="at">each =</span> <span class="dv">2</span>), <span class="at">times =</span> simCafes<span class="sc">$</span>n_cafes),</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">label =</span> <span class="fu">paste</span>(<span class="st">"cafe"</span>, simCafes<span class="sc">$</span>data<span class="sc">$</span>cafe)) <span class="sc">|&gt;</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(cafe <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">5</span>)) <span class="sc">|&gt;</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> visit, <span class="at">y =</span> wait, <span class="at">group =</span> day)) <span class="sc">+</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> afternoon), <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"green"</span>) <span class="sc">+</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"M"</span> <span class="ot">=</span> <span class="st">"royalblue"</span>, <span class="st">"A"</span> <span class="ot">=</span> <span class="st">"hotpink"</span>)) <span class="sc">+</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Varying slopes simulation"</span>) <span class="sc">+</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> label, <span class="at">ncol =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ch14_covariances_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="the-varying-slopes-model" class="level3" data-number="14.1.3">
<h3 data-number="14.1.3" class="anchored" data-anchor-id="the-varying-slopes-model"><span class="header-section-number">14.1.3</span> The varying slopes model</h3>
<section id="the-model" class="level4" data-number="14.1.3.1">
<h4 data-number="14.1.3.1" class="anchored" data-anchor-id="the-model"><span class="header-section-number">14.1.3.1</span> The model</h4>
<p><span class="math display">\[
\begin{align*}
wait_i &amp;\sim \mathcal{N}(\mu_i, \sigma) \\
\mu_i &amp;= \alpha_{cafe[i]} + \beta_{cafe[i]} \cdot afternoon_i \\
\begin{bmatrix}
\alpha_{cafe} \\
\beta_{cafe}
\end{bmatrix}
&amp;\sim
\mathcal{MVNormal}(
\begin{bmatrix}
\alpha \\
\beta
\end{bmatrix}
,
\bf{\Sigma}
) \\
\bf{\Sigma} &amp;=
\begin{bmatrix}
\sigma_{\alpha} &amp; 0 \\
0 &amp; \sigma_{\beta}
\end{bmatrix}
\begin{bmatrix}
1 &amp; \rho \\
\rho &amp; 1
\end{bmatrix}
\begin{bmatrix}
\sigma_{\alpha} &amp; 0 \\
0 &amp; \sigma_{\beta}
\end{bmatrix} \\
\alpha &amp;\sim \mathcal{N}(0, 10) \\
\beta &amp;\sim \mathcal{N}(0, 10) \\
\sigma &amp;\sim \mathcal{HalfCauchy}(0, 1) \\
\sigma_{\alpha} &amp;\sim \mathcal{HalfCauchy}(0, 1) \\
\sigma_{\beta} &amp;\sim \mathcal{HalfCauchy}(0, 1) \\
\rho
&amp;\sim \mathcal{LKJcorr}(K=2)
\end{align*}
\]</span></p>
</section>
<section id="lkj-prior" class="level4" data-number="14.1.3.2">
<h4 data-number="14.1.3.2" class="anchored" data-anchor-id="lkj-prior"><span class="header-section-number">14.1.3.2</span> LKJ prior</h4>
<p>We use the <code>ggdist</code> package to illustrate the LKJ distribution.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>lkj_dist <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>lkj_dist <span class="ot">&lt;-</span> <span class="fu">within</span>(lkj_dist, {</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> <span class="fu">crossing</span>(<span class="at">K =</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>, <span class="at">eta =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">4</span>), <span class="at">x =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">to =</span> <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.05</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">dens =</span> purrr<span class="sc">::</span><span class="fu">pmap_dbl</span>(<span class="at">.l =</span> ., </span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>                              <span class="at">.f =</span> \(K, eta, x) ggdist<span class="sc">::</span><span class="fu">dlkjcorr_marginal</span>(<span class="at">x =</span> x, <span class="at">K =</span> K, <span class="at">eta =</span> eta))) <span class="sc">|&gt;</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">id =</span> K<span class="sc">^</span>eta,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">label_K =</span> <span class="fu">paste0</span>(<span class="st">"K=="</span>, K),</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">label_eta =</span> <span class="fu">paste0</span>(<span class="st">"eta=="</span>, eta)) <span class="sc">|&gt;</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">identity</span>()</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> dens, <span class="at">color =</span> id)) <span class="sc">+</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.5</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_paletteer_c</span>(<span class="st">"palr::sst_pal"</span>) <span class="sc">+</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_grid</span>(<span class="at">facets =</span> label_eta <span class="sc">~</span> label_K, <span class="at">scales=</span> <span class="st">"fixed"</span>, <span class="at">labeller =</span> label_parsed) <span class="sc">+</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Lewandowski-Kurowicka-Joe Distribution"</span>,</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> <span class="st">"correlation"</span>, <span class="at">y =</span> <span class="st">"density"</span>)</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: The `facets` argument of `facet_grid()` is deprecated as of ggplot2 2.2.0.
ℹ Please use the `rows` argument instead.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># lkj_dist$df |&gt;</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="co">#   glimpse()</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>lkj_dist<span class="sc">$</span>p</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="ch14_covariances_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure 14.3</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>tictoc<span class="sc">::</span><span class="fu">tic</span>(<span class="at">msg =</span> <span class="fu">sprintf</span>(<span class="st">"run time of %s, use the cache."</span>, <span class="st">"60 secs."</span>))</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>fit14_01 <span class="ot">&lt;-</span> xfun<span class="sc">::</span><span class="fu">cache_rds</span>({</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  out <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> simCafes<span class="sc">$</span>data,</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> gaussian,</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">formula =</span> wait <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> afternoon <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">+</span> afternoon <span class="sc">|</span> cafe),</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">prior =</span> <span class="fu">c</span>(</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">5</span>, <span class="dv">2</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="fl">0.5</span>), <span class="at">class =</span> b),</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sd),</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma),</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>      <span class="fu">prior</span>(<span class="fu">lkj</span>(<span class="dv">2</span>), <span class="at">class =</span> cor)),</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">sample_prior =</span> <span class="cn">TRUE</span>,</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">iter =</span> <span class="dv">1000</span>, <span class="at">warmup =</span> <span class="dv">500</span>, <span class="at">chains =</span> <span class="dv">2</span>,</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">cores =</span> <span class="fu">detectCores</span>(), <span class="at">seed =</span> <span class="dv">1423</span>)</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_criterion</span>(out, <span class="fu">c</span>(<span class="st">"loo"</span>, <span class="st">"waic"</span>))},</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">"ch14_fit14_01"</span>, <span class="at">rerun =</span> <span class="cn">FALSE</span>)</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>tictoc<span class="sc">::</span><span class="fu">toc</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>run time of 60 secs., use the cache.: 0.14 sec elapsed</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>post14_01 <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>post14_01 <span class="ot">&lt;-</span> <span class="fu">within</span>(post14_01, {</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  prior <span class="ot">&lt;-</span> <span class="fu">prior_draws</span>(<span class="at">x =</span> fit14_01)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  post <span class="ot">&lt;-</span> <span class="fu">tidy_draws</span>(<span class="at">model =</span> fit14_01)</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># dataframe of correlations to plot</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>  corr <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="st">"value"</span> <span class="ot">=</span> <span class="fu">c</span>(prior<span class="sc">$</span>cor_cafe, post<span class="sc">$</span>cor_cafe__Intercept__afternoon),</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"id"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">"prior"</span>, <span class="fu">nrow</span>(prior)), <span class="fu">rep</span>(<span class="st">"post"</span>, <span class="fu">nrow</span>(post))))</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>  coefs <span class="ot">&lt;-</span> fit14_01 <span class="sc">|&gt;</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">spread_draws</span>(b_Intercept, b_afternoon, r_cafe[cafe, term]) <span class="sc">|&gt;</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> <span class="fu">c</span>(<span class="st">"b_Intercept"</span>, <span class="st">"b_afternoon"</span>, <span class="st">"cafe"</span>),</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>                <span class="at">names_from =</span> <span class="st">"term"</span>, <span class="at">values_from =</span> <span class="st">"r_cafe"</span>) <span class="sc">|&gt;</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(cafe) <span class="sc">|&gt;</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">b_Intercept =</span> <span class="fu">mean</span>(b_Intercept), <span class="at">b_afternoon =</span> <span class="fu">mean</span>(b_afternoon),</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>              <span class="at">r_afternoon =</span> <span class="fu">mean</span>(afternoon), <span class="at">r_Intercept =</span> <span class="fu">mean</span>(Intercept)) <span class="sc">|&gt;</span></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Intercept =</span> b_Intercept <span class="sc">+</span> r_Intercept,</span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>           <span class="at">afternoon =</span> b_afternoon <span class="sc">+</span> r_afternoon) <span class="sc">|&gt;</span></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(cafe, Intercept, afternoon) <span class="sc">|&gt;</span></span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">identity</span>()</span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>  all <span class="ot">&lt;-</span> simCafes<span class="sc">$</span>vary_effects <span class="sc">|&gt;</span></span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="st">"Intercept"</span> <span class="ot">=</span> a, <span class="st">"afternoon"</span> <span class="ot">=</span> b)</span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>  all <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(<span class="st">"real"</span> <span class="ot">=</span> all, <span class="st">"post"</span> <span class="ot">=</span> coefs, <span class="at">.id =</span> <span class="st">"id"</span>)</span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a><span class="co"># glimpse(post14_01$post)</span></span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a><span class="co"># glimpse(post14_01$coefs)</span></span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a><span class="co"># glimpse(post14_01$all)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>plot14_01 <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>plot14_01 <span class="ot">&lt;-</span> <span class="fu">within</span>(plot14_01, {</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  cor <span class="ot">&lt;-</span> post14_01<span class="sc">$</span>corr <span class="sc">|&gt;</span> </span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">color =</span> id, <span class="at">linetype =</span> id)) <span class="sc">+</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_density</span>(<span class="at">size =</span> <span class="dv">1</span>, <span class="at">adjust =</span> <span class="fl">0.75</span>) <span class="sc">+</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"prior"</span> <span class="ot">=</span> <span class="st">"black"</span>, <span class="st">"post"</span> <span class="ot">=</span> <span class="st">"blue"</span>)) <span class="sc">+</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_linetype_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"prior"</span> <span class="ot">=</span> <span class="st">"longdash"</span>, <span class="st">"post"</span> <span class="ot">=</span> <span class="st">"solid"</span>)) <span class="sc">+</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.8</span>, <span class="fl">0.8</span>), <span class="at">legend.title =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Posterior and Prior distribution of the correlation"</span>,</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> <span class="st">"correlation"</span>)</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>plot14_01<span class="sc">$</span>cor</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="ch14_covariances_files/figure-html/ch14_plot14_01-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure 14.4</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>pred14_01 <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>pred14_01 <span class="ot">&lt;-</span> <span class="fu">within</span>(pred14_01, {</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  pred_df <span class="ot">&lt;-</span> simCafes<span class="sc">$</span>data <span class="sc">|&gt;</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(cafe, afternoon) <span class="sc">|&gt;</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">mwait =</span> <span class="fu">mean</span>(wait)) <span class="sc">|&gt;</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_predicted_draws</span>(<span class="at">object =</span> fit14_01) <span class="sc">|&gt;</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mean_qi</span>(<span class="at">.width =</span> <span class="fl">0.89</span>) <span class="sc">|&gt;</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">term =</span> <span class="fu">if_else</span>(afternoon <span class="sc">==</span> <span class="dv">0</span>, <span class="st">"Intercept"</span>, <span class="st">"afternoon"</span>))</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>  real <span class="ot">&lt;-</span> pred_df <span class="sc">|&gt;</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(cafe, term, mwait) <span class="sc">|&gt;</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> cafe, <span class="at">names_from =</span> term, <span class="at">values_from =</span> mwait)</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>  pred <span class="ot">&lt;-</span> pred_df <span class="sc">|&gt;</span></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(cafe, term, .prediction) <span class="sc">|&gt;</span></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> cafe, <span class="at">names_from =</span> term, <span class="at">values_from =</span> .prediction)</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>  all <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(<span class="st">"real"</span> <span class="ot">=</span> real, <span class="st">"pred"</span> <span class="ot">=</span> pred, <span class="at">.id =</span> <span class="st">"id"</span>)</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'cafe'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># glimpse(pred14_01$all)</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="co"># glimpse(simCafes$data)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>plot14_01 <span class="ot">&lt;-</span> <span class="fu">within</span>(plot14_01, {</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  coefs <span class="ot">&lt;-</span> post14_01<span class="sc">$</span>all <span class="sc">|&gt;</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> Intercept, <span class="at">y =</span> afternoon, <span class="at">group =</span> cafe, <span class="at">color =</span> id)) <span class="sc">+</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lapply</span>(<span class="at">X =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span> <span class="sc">/</span> <span class="dv">5</span>, <span class="at">FUN =</span> <span class="cf">function</span>(x) {</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">stat_ellipse</span>(<span class="at">data =</span> post14_01<span class="sc">$</span>all, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> Intercept, <span class="at">y =</span> afternoon),</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>                   <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>,</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>                   <span class="at">geom =</span> <span class="st">"polygon"</span>, <span class="at">type =</span> <span class="st">"norm"</span>, <span class="at">level =</span> x, <span class="at">linewidth =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">5</span>,</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>                 <span class="at">color =</span> <span class="st">"dodgerblue"</span>, <span class="at">fill =</span> <span class="st">"transparent"</span>)}) <span class="sc">+</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_paletteer_d</span>(<span class="st">"awtools::spalette"</span>, <span class="at">direction =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.2</span>, <span class="fl">0.2</span>),</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.title =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Coefficients and shrinkage"</span>,</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> <span class="st">"Intercept"</span>, <span class="at">y =</span> <span class="st">"Slope"</span>)</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>  wait <span class="ot">&lt;-</span> pred14_01<span class="sc">$</span>all <span class="sc">|&gt;</span></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> Intercept, <span class="at">y =</span> afternoon, <span class="at">group =</span> cafe, <span class="at">color =</span> id)) <span class="sc">+</span></span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lapply</span>(<span class="at">X =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span> <span class="sc">/</span> <span class="dv">5</span>, <span class="at">FUN =</span> <span class="cf">function</span>(x) {</span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>      <span class="fu">stat_ellipse</span>(<span class="at">data =</span> pred14_01<span class="sc">$</span>all, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> Intercept, <span class="at">y =</span> afternoon),</span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>                   <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>,</span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a>                   <span class="at">geom =</span> <span class="st">"polygon"</span>, <span class="at">type =</span> <span class="st">"norm"</span>, <span class="at">level =</span> x, <span class="at">linewidth =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">5</span>,</span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a>                 <span class="at">color =</span> <span class="st">"dodgerblue"</span>, <span class="at">fill =</span> <span class="st">"transparent"</span>)}) <span class="sc">+</span></span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_paletteer_d</span>(<span class="st">"awtools::spalette"</span>, <span class="at">direction =</span> <span class="sc">-</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.8</span>, <span class="fl">0.2</span>),</span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.title =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Waiting time and shrinkage"</span>,</span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> <span class="st">"morning wait"</span>, <span class="at">y =</span> <span class="st">"afternoon wait"</span>)</span>
<span id="cb22-32"><a href="#cb22-32" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb22-33"><a href="#cb22-33" aria-hidden="true" tabindex="-1"></a><span class="co"># plot14_01$coefs</span></span>
<span id="cb22-34"><a href="#cb22-34" aria-hidden="true" tabindex="-1"></a><span class="fu">wrap_plots</span>(plot14_01[<span class="fu">c</span>(<span class="st">"coefs"</span>, <span class="st">"wait"</span>)]) <span class="sc">+</span></span>
<span id="cb22-35"><a href="#cb22-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(<span class="at">title =</span> <span class="st">"Shrinkage in two dimensions"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="ch14_covariances_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure 14.5</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="advanced-varying-slopes" class="level2" data-number="14.2">
<h2 data-number="14.2" class="anchored" data-anchor-id="advanced-varying-slopes"><span class="header-section-number">14.2</span> Advanced varying slopes</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(chimpanzees)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>dataChimp <span class="ot">&lt;-</span> chimpanzees <span class="sc">|&gt;</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">block =</span> <span class="fu">factor</span>(block),</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">actor =</span> <span class="fu">factor</span>(actor),</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">treatment =</span> <span class="fu">factor</span>(<span class="dv">1</span> <span class="sc">+</span> prosoc_left <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> condition, <span class="at">levels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>,</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>                            <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"AR"</span>, <span class="st">"AL"</span>, <span class="st">"PR"</span>, <span class="st">"PL"</span>)))</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(chimpanzees)</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>dataChimp <span class="sc">|&gt;</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">skim</span>() <span class="sc">|&gt;</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="at">.cols =</span> <span class="fu">where</span>(is.numeric), <span class="at">.fns =</span> round, <span class="at">digits =</span> <span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: There was 1 warning in `mutate()`.
ℹ In argument: `across(.cols = where(is.numeric), .fns = round, digits = 2)`.
Caused by warning:
! The `...` argument of `across()` is deprecated as of dplyr 1.1.0.
Supply arguments directly to `.fns` through an anonymous function instead.

  # Previously
  across(a:b, mean, na.rm = TRUE)

  # Now
  across(a:b, \(x) mean(x, na.rm = TRUE))</code></pre>
</div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<caption>Data summary</caption>
<tbody>
<tr class="odd">
<td style="text-align: left;">Name</td>
<td style="text-align: left;">dataChimp</td>
</tr>
<tr class="even">
<td style="text-align: left;">Number of rows</td>
<td style="text-align: left;">504</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Number of columns</td>
<td style="text-align: left;">9</td>
</tr>
<tr class="even">
<td style="text-align: left;">_______________________</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Column type frequency:</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">factor</td>
<td style="text-align: left;">3</td>
</tr>
<tr class="odd">
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">6</td>
</tr>
<tr class="even">
<td style="text-align: left;">________________________</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Group variables</td>
<td style="text-align: left;">None</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: factor</strong></p>
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 15%">
<col style="width: 11%">
<col style="width: 15%">
<col style="width: 8%">
<col style="width: 10%">
<col style="width: 38%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">skim_variable</th>
<th style="text-align: right;">n_missing</th>
<th style="text-align: right;">complete_rate</th>
<th style="text-align: left;">ordered</th>
<th style="text-align: right;">n_unique</th>
<th style="text-align: left;">top_counts</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">actor</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">7</td>
<td style="text-align: left;">1: 72, 2: 72, 3: 72, 4: 72</td>
</tr>
<tr class="even">
<td style="text-align: left;">block</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">6</td>
<td style="text-align: left;">1: 84, 2: 84, 3: 84, 4: 84</td>
</tr>
<tr class="odd">
<td style="text-align: left;">treatment</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">4</td>
<td style="text-align: left;">AR: 126, AL: 126, PR: 126, PL: 126</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 17%">
<col style="width: 12%">
<col style="width: 17%">
<col style="width: 7%">
<col style="width: 7%">
<col style="width: 3%">
<col style="width: 7%">
<col style="width: 6%">
<col style="width: 7%">
<col style="width: 6%">
<col style="width: 7%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">skim_variable</th>
<th style="text-align: right;">n_missing</th>
<th style="text-align: right;">complete_rate</th>
<th style="text-align: right;">mean</th>
<th style="text-align: right;">sd</th>
<th style="text-align: right;">p0</th>
<th style="text-align: right;">p25</th>
<th style="text-align: right;">p50</th>
<th style="text-align: right;">p75</th>
<th style="text-align: right;">p100</th>
<th style="text-align: left;">hist</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">recipient</td>
<td style="text-align: right;">252</td>
<td style="text-align: right;">0.5</td>
<td style="text-align: right;">5.00</td>
<td style="text-align: right;">2.00</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">3.00</td>
<td style="text-align: right;">5.0</td>
<td style="text-align: right;">7.00</td>
<td style="text-align: right;">8</td>
<td style="text-align: left;">▇▃▃▃▇</td>
</tr>
<tr class="even">
<td style="text-align: left;">condition</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.0</td>
<td style="text-align: right;">0.50</td>
<td style="text-align: right;">0.50</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.5</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">▇▁▁▁▇</td>
</tr>
<tr class="odd">
<td style="text-align: left;">trial</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.0</td>
<td style="text-align: right;">36.50</td>
<td style="text-align: right;">20.80</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">18.75</td>
<td style="text-align: right;">36.5</td>
<td style="text-align: right;">54.25</td>
<td style="text-align: right;">72</td>
<td style="text-align: left;">▇▇▇▇▇</td>
</tr>
<tr class="even">
<td style="text-align: left;">prosoc_left</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.0</td>
<td style="text-align: right;">0.50</td>
<td style="text-align: right;">0.50</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.5</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">▇▁▁▁▇</td>
</tr>
<tr class="odd">
<td style="text-align: left;">chose_prosoc</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.0</td>
<td style="text-align: right;">0.57</td>
<td style="text-align: right;">0.50</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">1.0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">▆▁▁▁▇</td>
</tr>
<tr class="even">
<td style="text-align: left;">pulled_left</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.0</td>
<td style="text-align: right;">0.58</td>
<td style="text-align: right;">0.49</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">1.0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">▆▁▁▁▇</td>
</tr>
</tbody>
</table>
</div>
</div>
<section id="the-model-1" class="level4" data-number="14.2.0.1">
<h4 data-number="14.2.0.1" class="anchored" data-anchor-id="the-model-1"><span class="header-section-number">14.2.0.1</span> The model</h4>
<p>$$ <span class="math display">\[\begin{align*}
L_i &amp;\sim \mathcal{Binomial}(1, p_i) \\
logit(p_i) &amp;\sim \gamma_{treatment[i]} + \alpha_{actor[i], treatment[i]} + \beta_{block[i], treatment[i]} \\
\gamma_{treatment[i]} &amp;\sim \mathcal{N}(0, 1), \, \text{for } i = 1 \ldots 4 \\


\begin{bmatrix}
\alpha_{j, 1} \\
\alpha_{j, 2} \\
\alpha_{j, 3} \\
\alpha_{j, 4}
\end{bmatrix}
&amp;\sim
\mathcal{MVNormal}(
\begin{bmatrix}
0 \\
0 \\
0 \\
0\\
\end{bmatrix}
,
\bf{\Sigma_{actor}}
) \\


\begin{bmatrix}
\beta_{j, 1} \\
\beta_{j, 2} \\
\beta_{j, 3} \\
\beta_{j, 4}
\end{bmatrix}
&amp;\sim
\mathcal{MVNormal}(
\begin{bmatrix}
0 \\
0 \\
0 \\
0 \\
\end{bmatrix}
,
\bf{\Sigma_{block}}
) \\



\bf{\Sigma_{actor}} &amp;=
\begin{bmatrix}
\sigma_{factor} &amp; 0 \\
0 &amp; \sigma_{factor}
\end{bmatrix}
\cdot
\begin{bmatrix}
1 &amp; \rho_{factor} \\
\rho_{factor} &amp; 1
\end{bmatrix}
\cdot
\begin{bmatrix}
\sigma_{factor} &amp; 0 \\
0 &amp; \sigma_{factor}\\
\end{bmatrix} \\



\bf{\Sigma_{block}} &amp;=
\begin{bmatrix}
\sigma_{block} &amp; 0 \\
0 &amp; \sigma_{block}
\end{bmatrix}
\cdot
\begin{bmatrix}
1 &amp; \rho_{block} \\
\rho_{block} &amp; 1
\end{bmatrix}
\cdot
\begin{bmatrix}
\sigma_{block} &amp; 0 \\
0 &amp; \sigma_{block}\\
\end{bmatrix} \\



\sigma_{actor, j} &amp;\sim \mathcal{Exponential}(1), \, \text{for } i = 1 \ldots 4 \\
\sigma_{block, j} &amp;\sim \mathcal{Exponential}(1), \, \text{for } i = 1 \ldots 4 \\


\rho_{actor}, \rho_{block} &amp;\sim \mathcal{LKJcorr}(2)

\end{align*}\]</span> $$</p>
<p>We don’t do model m14.2 since it is only done to illustrate centralized vs non-centralized parametrization and that <code>brms</code> uses only non-centralized parametrization.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>tictoc<span class="sc">::</span><span class="fu">tic</span>(<span class="at">msg =</span> <span class="fu">sprintf</span>(<span class="st">"run time of %s, use the cache."</span>, <span class="st">"80 secs."</span>))</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>fit14_03 <span class="ot">&lt;-</span> xfun<span class="sc">::</span><span class="fu">cache_rds</span>({</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  out <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> dataChimp,</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> bernoulli,</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">formula =</span> <span class="fu">bf</span>(pulled_left <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> treatment <span class="sc">+</span> (<span class="dv">0</span> <span class="sc">+</span> treatment <span class="sc">|</span> actor) <span class="sc">+</span> (<span class="dv">0</span> <span class="sc">+</span> treatment <span class="sc">|</span> block)),</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">prior =</span> <span class="fu">c</span>(</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> b),</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sd, <span class="at">group =</span> actor),</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sd, <span class="at">group =</span> block),</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">prior</span>(<span class="fu">lkj</span>(<span class="dv">2</span>), <span class="at">class =</span> cor, <span class="at">group =</span> actor),</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>      <span class="fu">prior</span>(<span class="fu">lkj</span>(<span class="dv">2</span>), <span class="at">class =</span> cor, <span class="at">group =</span> block)),</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">iter =</span> <span class="dv">1000</span>, <span class="at">warmup =</span> <span class="dv">500</span>, <span class="at">chains =</span> <span class="dv">2</span>,</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">cores =</span> <span class="fu">detectCores</span>(), <span class="at">seed =</span> <span class="dv">1427</span>)</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_criterion</span>(out, <span class="fu">c</span>(<span class="st">"loo"</span>, <span class="st">"waic"</span>))},</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">"ch14_fit14_03"</span>, <span class="at">rerun =</span> <span class="cn">FALSE</span>)</span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>tictoc<span class="sc">::</span><span class="fu">toc</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>run time of 80 secs., use the cache.: 0.17 sec elapsed</code></pre>
</div>
</div>
<p>The plot is slightly different than what McElreath has. The open circle represent the actual results and the solid circles are the predicted mean.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>plot14_03 <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>plot14_03 <span class="ot">&lt;-</span> <span class="fu">within</span>(plot14_03, {</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> dataPredicted <span class="ot">&lt;-</span> dataChimp <span class="sc">|&gt;</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(actor, treatment, block) <span class="sc">|&gt;</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">prop =</span> <span class="fu">mean</span>(pulled_left)) <span class="sc">|&gt;</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_epred_draws</span>(fit14_03) <span class="sc">|&gt;</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">prop =</span> <span class="fu">mean</span>(prop),</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>              <span class="fu">mean_qi</span>(.epred, <span class="at">.width =</span> <span class="fl">0.89</span>) ) <span class="sc">|&gt;</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="st">".epred"</span> <span class="ot">=</span> y, <span class="st">".lower"</span> <span class="ot">=</span> ymin, <span class="st">".upper"</span> <span class="ot">=</span> ymax)</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># every block is different but, for plotting, we use the average of the blocks</span></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(actor, treatment) <span class="sc">|&gt;</span></span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(</span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">prop =</span> <span class="fu">mean</span>(prop),</span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">.epred =</span> <span class="fu">mean</span>(.epred),</span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">.lower =</span> <span class="fu">mean</span>(.lower),</span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">.upper =</span> <span class="fu">mean</span>(.upper)) <span class="sc">|&gt;</span></span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">label =</span> <span class="fu">paste</span>(<span class="st">"actor"</span>, actor)) <span class="sc">|&gt;</span></span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">condition =</span> <span class="fu">if_else</span>(<span class="fu">substring</span>(treatment, <span class="dv">1</span>, <span class="dv">1</span>) <span class="sc">==</span> <span class="st">"A"</span>, <span class="st">"alone"</span>, <span class="st">"partner"</span>),</span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a>           <span class="at">condition =</span> <span class="fu">as.factor</span>(condition),</span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a>           <span class="at">prosoc_left =</span> <span class="fu">if_else</span>(<span class="fu">substring</span>(treatment, <span class="dv">2</span>, <span class="dv">2</span>) <span class="sc">==</span> <span class="st">"R"</span>, <span class="st">"right"</span>, <span class="st">"left"</span>),</span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a>           <span class="at">prosoc_left =</span> <span class="fu">as.factor</span>(prosoc_left)) <span class="sc">|&gt;</span></span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">label =</span> <span class="fu">paste</span>(<span class="st">"actor"</span>, actor))</span>
<span id="cb27-27"><a href="#cb27-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-28"><a href="#cb27-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-29"><a href="#cb27-29" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-30"><a href="#cb27-30" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span></span>
<span id="cb27-31"><a href="#cb27-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> treatment, <span class="at">y =</span> .epred,</span>
<span id="cb27-32"><a href="#cb27-32" aria-hidden="true" tabindex="-1"></a>                             <span class="at">group =</span> prosoc_left, <span class="at">color =</span> prosoc_left,</span>
<span id="cb27-33"><a href="#cb27-33" aria-hidden="true" tabindex="-1"></a>                             <span class="at">fill =</span> prosoc_left)) <span class="sc">+</span></span>
<span id="cb27-34"><a href="#cb27-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">linetype =</span> <span class="st">"solid"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb27-35"><a href="#cb27-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">16</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb27-36"><a href="#cb27-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> prop), <span class="at">linetype =</span> <span class="st">"solid"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb27-37"><a href="#cb27-37" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> prop), <span class="at">shape =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb27-38"><a href="#cb27-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> .lower, <span class="at">ymax =</span> .upper), <span class="at">width =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb27-39"><a href="#cb27-39" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fl">0.5</span>, <span class="at">color =</span> <span class="st">"brown"</span>, <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb27-40"><a href="#cb27-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_percent</span>()) <span class="sc">+</span></span>
<span id="cb27-41"><a href="#cb27-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_paletteer_d</span>(<span class="st">"jcolors::pal9"</span>) <span class="sc">+</span></span>
<span id="cb27-42"><a href="#cb27-42" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb27-43"><a href="#cb27-43" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>) <span class="sc">+</span></span>
<span id="cb27-44"><a href="#cb27-44" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Posterior expected predictions with 89% CI"</span>,</span>
<span id="cb27-45"><a href="#cb27-45" aria-hidden="true" tabindex="-1"></a>         <span class="at">subtitle =</span> <span class="st">"Open circles are actual results, solid circles are mean predictions."</span>,</span>
<span id="cb27-46"><a href="#cb27-46" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="st">"proportion pulled left"</span>) <span class="sc">+</span></span>
<span id="cb27-47"><a href="#cb27-47" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_grid</span>(. <span class="sc">~</span> label)</span>
<span id="cb27-48"><a href="#cb27-48" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'actor', 'treatment'. You can override
using the `.groups` argument.
`summarise()` has grouped output by 'actor', 'treatment', 'block', 'prop'. You
can override using the `.groups` argument.
`summarise()` has grouped output by 'actor'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># glimpse(plot14_03$df)</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>plot14_03<span class="sc">$</span>p</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="ch14_covariances_files/figure-html/ch14_plot14_03-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure 14.7</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="instruments-and-causal-designs" class="level2" data-number="14.3">
<h2 data-number="14.3" class="anchored" data-anchor-id="instruments-and-causal-designs"><span class="header-section-number">14.3</span> Instruments and Causal designs</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>ggdag<span class="sc">::</span><span class="fu">dagify</span>(E <span class="sc">~</span> U, W <span class="sc">~</span> U, W <span class="sc">~</span> E) <span class="sc">|&gt;</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>    ggdag<span class="sc">::</span><span class="fu">ggdag_classic</span>(<span class="at">layout =</span> <span class="st">"sugiyama"</span>, <span class="at">text_col =</span> <span class="st">"royalblue"</span>) <span class="sc">+</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>    ggdag<span class="sc">::</span><span class="fu">theme_dag_blank</span>(</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"snow"</span>, <span class="at">color =</span> <span class="st">"snow"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ch14_covariances_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<blockquote class="blockquote">
<p>In causal terms, an instrument variable is a variable that acts like a natural experiment on the exposure <span class="math inline">\(E\)</span>.</p>
</blockquote>
<p>In mathematical terms the instrumental variable <span class="math inline">\(Q\)</span> is characterized as follows:</p>
<ol type="1">
<li>Independent of <span class="math inline">\(U\)</span>, i.e.&nbsp;<span class="math inline">\(Q \perp\!\!\!\perp U\)</span></li>
<li>Not independent of <span class="math inline">\(E\)</span>, i.e.&nbsp;<span class="math inline">\(Q \not\!\perp\!\!\!\perp E\)</span></li>
<li>Has no effect on <span class="math inline">\(W\)</span> except through <span class="math inline">\(E\)</span>, also called the <strong>exclusion condition</strong></li>
</ol>
<blockquote class="blockquote">
<p>The exclusion restriction cannot be tested, and it is often implausible.</p>
</blockquote>
<p>In the education and wage example, the simplest instrument variable <span class="math inline">\(Q\)</span> would be as follows</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>ggdag<span class="sc">::</span><span class="fu">dagify</span>(E <span class="sc">~</span> U <span class="sc">+</span> Q, W <span class="sc">~</span> U, W <span class="sc">~</span> E) <span class="sc">|&gt;</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>    ggdag<span class="sc">::</span><span class="fu">ggdag_classic</span>(<span class="at">layout =</span> <span class="st">"sugiyama"</span>, <span class="at">text_col =</span> <span class="st">"royalblue"</span>) <span class="sc">+</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>    ggdag<span class="sc">::</span><span class="fu">theme_dag_blank</span>(</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"snow"</span>, <span class="at">color =</span> <span class="st">"snow"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ch14_covariances_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We now use a simulation to illustrate.</p>
<blockquote class="blockquote">
<p>With real data, you never know what the right anser is. This is h=why studying simulated examples is so important.</p>
</blockquote>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>simInstrument <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>simInstrument <span class="ot">&lt;-</span> <span class="fu">within</span>(simInstrument, {</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">=</span> 500L</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  U <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n)</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>  Q <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="at">size =</span> n, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>  E <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> U <span class="sc">+</span> Q)</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># we assume that the true influence of E (education)</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">#  on W (wage) is zero. Just for the sake of the example.</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>  W <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> U <span class="sc">+</span> <span class="dv">0</span> <span class="sc">*</span> E)</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"W"</span> <span class="ot">=</span> <span class="fu">scale</span>(W),</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">"E"</span> <span class="ot">=</span> <span class="fu">scale</span>(E),</span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Q"</span> <span class="ot">=</span> <span class="fu">scale</span>(Q)</span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>simInstrument<span class="sc">$</span>df <span class="sc">|&gt;</span></span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 500
Columns: 3
$ W &lt;dbl&gt; -1.12780402, -0.78848452, 0.94201935, -0.04856341, -0.20283111, -0.2…
$ E &lt;dbl&gt; -0.50147547, -0.16726498, 0.44072307, -0.47604532, 0.52109651, -1.25…
$ Q &lt;dbl&gt; -1.4403794, 0.3782814, -1.4403794, -0.5310490, 1.2876118, -1.4403794…</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>tictoc<span class="sc">::</span><span class="fu">tic</span>(<span class="at">msg =</span> <span class="fu">sprintf</span>(<span class="st">"run time of %s, use the cache."</span>, <span class="st">"60 secs."</span>))</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>fit14_04 <span class="ot">&lt;-</span> xfun<span class="sc">::</span><span class="fu">cache_rds</span>({</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  out <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> simInstrument<span class="sc">$</span>df,</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> gaussian,</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">formula =</span> W <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> E,</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">prior =</span> <span class="fu">c</span>(</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.2</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">class =</span> b),</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">iter =</span> <span class="dv">1000</span>, <span class="at">warmup =</span> <span class="dv">500</span>, <span class="at">chains =</span> <span class="dv">2</span>,</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">cores =</span> <span class="fu">detectCores</span>(), <span class="at">seed =</span> <span class="dv">1429</span>)</span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_criterion</span>(out, <span class="fu">c</span>(<span class="st">"loo"</span>, <span class="st">"waic"</span>))},</span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">"ch14_fit14_04"</span>, <span class="at">rerun =</span> <span class="cn">FALSE</span>)</span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>tictoc<span class="sc">::</span><span class="fu">toc</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>run time of 60 secs., use the cache.: 0.18 sec elapsed</code></pre>
</div>
</div>
<p>which gives us the results</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summarize_draws</span>(fit14_04, <span class="st">"mean"</span>, <span class="st">"sd"</span>, <span class="sc">~</span><span class="fu">quantile</span>(.x, <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.055</span>, <span class="fl">0.945</span>)),</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>                <span class="fu">default_convergence_measures</span>()) <span class="sc">|&gt;</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"^lp"</span>, <span class="at">x =</span> variable)) <span class="sc">|&gt;</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="at">.cols =</span> <span class="fu">where</span>(is.numeric), <span class="at">.fns =</span> round, <span class="at">digits =</span> <span class="dv">2</span>),</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>         <span class="fu">across</span>(<span class="at">.cols =</span> <span class="fu">starts_with</span>(<span class="st">"ess"</span>), <span class="at">.fns =</span> as.integer))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 8
  variable     mean    sd `5.5%` `94.5%`  rhat ess_bulk ess_tail
  &lt;chr&gt;       &lt;num&gt; &lt;num&gt;  &lt;num&gt;   &lt;num&gt; &lt;num&gt;    &lt;num&gt;    &lt;num&gt;
1 b_Intercept  0     0.04  -0.06    0.06     1     1103      636
2 b_E          0.4   0.04   0.34    0.46     1      970      696
3 sigma        0.92  0.03   0.87    0.96     1     1172      843</code></pre>
</div>
</div>
<p>The value <span class="math inline">\(b_E\)</span> should have been close to zero. The oncorrect value is caused by the confounding effect of <span class="math inline">\(U\)</span>.</p>
<p>Now, lets see what happens when we include the instrumental variable <span class="math inline">\(Q\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>tictoc<span class="sc">::</span><span class="fu">tic</span>(<span class="at">msg =</span> <span class="fu">sprintf</span>(<span class="st">"run time of %s, use the cache."</span>, <span class="st">"60 secs."</span>))</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>fit14_05 <span class="ot">&lt;-</span> xfun<span class="sc">::</span><span class="fu">cache_rds</span>({</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  out <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> simInstrument<span class="sc">$</span>df,</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> gaussian,</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">formula =</span> W <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> E <span class="sc">+</span> Q,</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">prior =</span> <span class="fu">c</span>(</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.2</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">class =</span> b),</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">iter =</span> <span class="dv">1000</span>, <span class="at">warmup =</span> <span class="dv">500</span>, <span class="at">chains =</span> <span class="dv">2</span>,</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">cores =</span> <span class="fu">detectCores</span>(), <span class="at">seed =</span> <span class="dv">1429</span>)</span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_criterion</span>(out, <span class="fu">c</span>(<span class="st">"loo"</span>, <span class="st">"waic"</span>))},</span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">"ch14_fit14_05"</span>, <span class="at">rerun =</span> <span class="cn">FALSE</span>)</span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>tictoc<span class="sc">::</span><span class="fu">toc</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>run time of 60 secs., use the cache.: 0.15 sec elapsed</code></pre>
</div>
</div>
<p>which gives us the results</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summarize_draws</span>(fit14_05, <span class="st">"mean"</span>, <span class="st">"sd"</span>, <span class="sc">~</span><span class="fu">quantile</span>(.x, <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.055</span>, <span class="fl">0.945</span>)),</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>                <span class="fu">default_convergence_measures</span>()) <span class="sc">|&gt;</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"^lp"</span>, <span class="at">x =</span> variable)) <span class="sc">|&gt;</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="at">.cols =</span> <span class="fu">where</span>(is.numeric), <span class="at">.fns =</span> round, <span class="at">digits =</span> <span class="dv">2</span>),</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>         <span class="fu">across</span>(<span class="at">.cols =</span> <span class="fu">starts_with</span>(<span class="st">"ess"</span>), <span class="at">.fns =</span> as.integer))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 8
  variable     mean    sd `5.5%` `94.5%`  rhat ess_bulk ess_tail
  &lt;chr&gt;       &lt;num&gt; &lt;num&gt;  &lt;num&gt;   &lt;num&gt; &lt;num&gt;    &lt;num&gt;    &lt;num&gt;
1 b_Intercept  0     0.04  -0.06    0.06  1         896      646
2 b_E          0.6   0.05   0.52    0.68  1.01      941      577
3 b_Q         -0.35  0.05  -0.43   -0.27  1         843      650
4 sigma        0.87  0.03   0.83    0.92  1         872      737</code></pre>
</div>
</div>
<p>The results are now even more confusing as the influence of <span class="math inline">\(Q\)</span> makes the effect of <span class="math inline">\(E\)</span> difficult to evaluate on its own.</p>
<p>So lets use the instrumental variable <span class="math inline">\(Q\)</span> again but taking into account the covariance of <span class="math inline">\(E\)</span> and <span class="math inline">\(Q\)</span>. That is, we express the model as a *multivariate statistical model as follows</p>
<p><span class="math display">\[
\begin{align*}
\begin{bmatrix}
W_i \\
E_i \\
\end{bmatrix}
&amp;\sim
\mathcal{MVNormal}(
\begin{bmatrix}
\mu_{W, i} \\
\mu_{E, i}
\end{bmatrix},
\bf{\Sigma}
) \\
\mu_{W, i} &amp;= \alpha_W + \beta_{EW}E_i \\
\mu_{E, i} &amp;= \alpha_E + \beta_{QE}Q_i \\
\bf{\Sigma} &amp;=
\begin{bmatrix}
\sigma_W &amp; 0 \\
0 &amp; \sigma_E
\end{bmatrix}
\cdot
\begin{bmatrix}
1 &amp; \rho \\
\rho &amp; 1
\end{bmatrix}
\cdot
\begin{bmatrix}
\sigma_W &amp; 0 \\
0 &amp; \sigma_E
\end{bmatrix}
\\
\alpha_W, \alpha_E &amp;\sim \mathcal{N}(0, 0.2) \\
\beta_{EW}, \beta_{QE} &amp;\sim \mathcal{N}(0, 0.5) \\
\sigma_W, \sigma_E &amp;\sim \mathcal{Exponential}(1) \\
\rho &amp;\sim \mathcal{LKJ}(2)
\end{align*}
\]</span></p>
<p>and the final fit is</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>tictoc<span class="sc">::</span><span class="fu">tic</span>(<span class="at">msg =</span> <span class="fu">sprintf</span>(<span class="st">"run time of %s, use the cache."</span>, <span class="st">"90 secs."</span>))</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>fit14_06 <span class="ot">&lt;-</span> xfun<span class="sc">::</span><span class="fu">cache_rds</span>({</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  out <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> simInstrument<span class="sc">$</span>df,</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> gaussian,</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">formula =</span> <span class="fu">bf</span>(W <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> E) <span class="sc">+</span> <span class="fu">bf</span>(E <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> Q),</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">prior =</span> <span class="fu">c</span>(</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.2</span>), <span class="at">class =</span> Intercept, <span class="at">resp =</span> E),</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">class =</span> b, <span class="at">resp =</span> E),</span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma, <span class="at">resp =</span> E),</span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.2</span>), <span class="at">class =</span> Intercept, <span class="at">resp =</span> W),</span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>      <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">class =</span> b, <span class="at">resp =</span> W),</span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>      <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma, <span class="at">resp =</span> W),</span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">prior</span>(<span class="fu">lkj</span>(<span class="dv">2</span>), <span class="at">class =</span> rescor)),</span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">iter =</span> <span class="dv">1000</span>, <span class="at">warmup =</span> <span class="dv">500</span>, <span class="at">chains =</span> <span class="dv">2</span>,</span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">cores =</span> <span class="fu">detectCores</span>(), <span class="at">seed =</span> <span class="dv">1429</span>)</span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_criterion</span>(out, <span class="fu">c</span>(<span class="st">"loo"</span>, <span class="st">"waic"</span>))},</span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">"ch14_fit14_06"</span>, <span class="at">rerun =</span> <span class="cn">FALSE</span>)</span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a>tictoc<span class="sc">::</span><span class="fu">toc</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>run time of 90 secs., use the cache.: 0.16 sec elapsed</code></pre>
</div>
</div>
<p>which gives us the results</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summarize_draws</span>(fit14_06, <span class="st">"mean"</span>, <span class="st">"sd"</span>, <span class="sc">~</span><span class="fu">quantile</span>(.x, <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.055</span>, <span class="fl">0.945</span>)),</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>                <span class="fu">default_convergence_measures</span>()) <span class="sc">|&gt;</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"^lp"</span>, <span class="at">x =</span> variable)) <span class="sc">|&gt;</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="at">.cols =</span> <span class="fu">where</span>(is.numeric), <span class="at">.fns =</span> round, <span class="at">digits =</span> <span class="dv">2</span>),</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>         <span class="fu">across</span>(<span class="at">.cols =</span> <span class="fu">starts_with</span>(<span class="st">"ess"</span>), <span class="at">.fns =</span> as.integer))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7 × 8
  variable       mean    sd `5.5%` `94.5%`  rhat ess_bulk ess_tail
  &lt;chr&gt;         &lt;num&gt; &lt;num&gt;  &lt;num&gt;   &lt;num&gt; &lt;num&gt;    &lt;num&gt;    &lt;num&gt;
1 b_W_Intercept  0     0.04  -0.07    0.07  1         899      640
2 b_E_Intercept  0     0.04  -0.06    0.06  1         823      701
3 b_W_E          0     0.08  -0.13    0.13  1.01      452      738
4 b_E_Q          0.58  0.04   0.52    0.64  1         752      727
5 sigma_W        1     0.04   0.93    1.07  1.01      513      738
6 sigma_E        0.82  0.02   0.78    0.86  1         895      662
7 rescor__W__E   0.49  0.06   0.39    0.58  1.01      444      731</code></pre>
</div>
</div>
</section>
<section id="social-relations-as-correlated-varying-effects" class="level2" data-number="14.4">
<h2 data-number="14.4" class="anchored" data-anchor-id="social-relations-as-correlated-varying-effects"><span class="header-section-number">14.4</span> Social relations as correlated varying effects</h2>
<section id="data" class="level3" data-number="14.4.1">
<h3 data-number="14.4.1" class="anchored" data-anchor-id="data"><span class="header-section-number">14.4.1</span> Data</h3>
<p>The research can be find in this <a href="https://research-information.bris.ac.uk/ws/portalfiles/portal/41942591/koster2014sn.pdf">paper</a>. However I could not find what the variable <span class="math inline">\(dlndist\)</span> is. I suppose it it the log of some distance . . but why is it negative? It doesn’t matter, it is only used to color the edges of the network and not in the analysis per se.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(KosterLeckie, <span class="at">package =</span> <span class="st">"rethinking"</span>)</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>dataKL <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"dyads"</span> <span class="ot">=</span> kl_dyads,</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"houses"</span> <span class="ot">=</span> kl_households)</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">c</span>(<span class="st">"kl_dyads"</span>, <span class="st">"kl_households"</span>))</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>dataKL<span class="sc">$</span>dyads <span class="ot">&lt;-</span> dataKL<span class="sc">$</span>dyads <span class="sc">|&gt;</span></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># we only use these variable</span></span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(hidA, hidB, did, giftsAB, giftsBA, offset, dlndist) <span class="sc">|&gt;</span></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">hidA =</span> <span class="fu">factor</span>(hidA),</span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">hidB =</span> <span class="fu">factor</span>(hidB),</span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">did =</span> <span class="fu">factor</span>(did))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The data set can be summarized with the <code>skimr</code> package</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(dataKL<span class="sc">$</span>dyads)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "hidA"    "hidB"    "did"     "giftsAB" "giftsBA" "offset"  "dlndist"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>dataKL<span class="sc">$</span>dyads <span class="sc">|&gt;</span> <span class="fu">skim</span>() <span class="sc">|&gt;</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>n_missing, <span class="sc">-</span>complete_rate) <span class="sc">|&gt;</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="at">.cols =</span> <span class="fu">where</span>(is.numeric), <span class="at">.fns =</span> round, <span class="at">digits =</span> <span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<caption>Data summary</caption>
<tbody>
<tr class="odd">
<td style="text-align: left;">Name</td>
<td style="text-align: left;">dataKL$dyads</td>
</tr>
<tr class="even">
<td style="text-align: left;">Number of rows</td>
<td style="text-align: left;">300</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Number of columns</td>
<td style="text-align: left;">7</td>
</tr>
<tr class="even">
<td style="text-align: left;">_______________________</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Column type frequency:</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">factor</td>
<td style="text-align: left;">3</td>
</tr>
<tr class="odd">
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">4</td>
</tr>
<tr class="even">
<td style="text-align: left;">________________________</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Group variables</td>
<td style="text-align: left;">None</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: factor</strong></p>
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">skim_variable</th>
<th style="text-align: left;">ordered</th>
<th style="text-align: right;">n_unique</th>
<th style="text-align: left;">top_counts</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">hidA</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">24</td>
<td style="text-align: left;">1: 24, 2: 23, 3: 22, 4: 21</td>
</tr>
<tr class="even">
<td style="text-align: left;">hidB</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">24</td>
<td style="text-align: left;">25: 24, 24: 23, 23: 22, 22: 21</td>
</tr>
<tr class="odd">
<td style="text-align: left;">did</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">300</td>
<td style="text-align: left;">1: 1, 2: 1, 3: 1, 4: 1</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 22%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 11%">
<col style="width: 9%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">skim_variable</th>
<th style="text-align: right;">mean</th>
<th style="text-align: right;">sd</th>
<th style="text-align: right;">p0</th>
<th style="text-align: right;">p25</th>
<th style="text-align: right;">p50</th>
<th style="text-align: right;">p75</th>
<th style="text-align: right;">p100</th>
<th style="text-align: left;">hist</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">giftsAB</td>
<td style="text-align: right;">3.87</td>
<td style="text-align: right;">7.97</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">4.00</td>
<td style="text-align: right;">75.00</td>
<td style="text-align: left;">▇▁▁▁▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">giftsBA</td>
<td style="text-align: right;">5.70</td>
<td style="text-align: right;">11.47</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">2.00</td>
<td style="text-align: right;">6.00</td>
<td style="text-align: right;">110.00</td>
<td style="text-align: left;">▇▁▁▁▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">offset</td>
<td style="text-align: right;">-0.13</td>
<td style="text-align: right;">0.21</td>
<td style="text-align: right;">-1.24</td>
<td style="text-align: right;">-0.11</td>
<td style="text-align: right;">-0.02</td>
<td style="text-align: right;">-0.01</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: left;">▁▁▁▁▇</td>
</tr>
<tr class="even">
<td style="text-align: left;">dlndist</td>
<td style="text-align: right;">-2.26</td>
<td style="text-align: right;">0.59</td>
<td style="text-align: right;">-4.07</td>
<td style="text-align: right;">-2.58</td>
<td style="text-align: right;">-2.18</td>
<td style="text-align: right;">-1.85</td>
<td style="text-align: right;">-1.03</td>
<td style="text-align: left;">▁▂▆▇▂</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>We can visualize the distribution of dyadic gifts using a scatter plot</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>dataKL<span class="sc">$</span>dyads <span class="sc">|&gt;</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> giftsAB, <span class="at">y =</span> giftsBA)) <span class="sc">+</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"darkblue"</span>) <span class="sc">+</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">slope =</span> <span class="dv">1</span>, <span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">"royalblue"</span>) <span class="sc">+</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_equal</span>(<span class="at">ratio =</span> <span class="dv">1</span>, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">120</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">120</span>)) <span class="sc">+</span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Distribution of dyadic gifts"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="ch14_covariances_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure 14.8</figcaption>
</figure>
</div>
</div>
</div>
<p>and since this a social network then we can visualize the network with the <code>ggnetwork</code> package.For details see <a href="https://cran.r-project.org/web/packages/ggnetwork/vignettes/ggnetwork.html">ggnetwork</a>.</p>
<p>First we need to create an igraph object. See <a href="https://igraph.org/r/doc/graph_from_data_frame.html">igraph</a> for details.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>netKL <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>netKL <span class="ot">&lt;-</span> <span class="fu">within</span>(netKL, {</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># the tbl_graph object</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>  the_edges <span class="ot">&lt;-</span> dataKL<span class="sc">$</span>dyads <span class="sc">|&gt;</span></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">giftsSum =</span> <span class="fu">abs</span>(giftsAB <span class="sc">-</span> giftsBA))</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>  the_nodes <span class="ot">&lt;-</span> dataKL<span class="sc">$</span>houses</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>  grf <span class="ot">&lt;-</span> <span class="fu">tbl_graph</span>(<span class="at">nodes =</span> the_nodes, <span class="at">edges =</span> the_edges, <span class="at">directed =</span> <span class="cn">FALSE</span>)</span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>  colrs <span class="ot">&lt;-</span> paletteer<span class="sc">::</span><span class="fu">paletteer_c</span>(<span class="st">"oompaBase::jetColors"</span>, <span class="at">direction =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">n =</span> <span class="dv">16</span>)</span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="fu">ggraph</span>(grf, <span class="at">layout =</span> <span class="st">"circle"</span>) <span class="sc">+</span></span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_edge_link</span>(<span class="fu">aes</span>(<span class="at">color =</span> dlndist)) <span class="sc">+</span></span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_node_point</span>(<span class="fu">aes</span>(<span class="at">size =</span> hwealth), <span class="at">color =</span> <span class="st">"brown"</span>) <span class="sc">+</span></span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_paletteer_c</span>(<span class="st">"oompaBase::jetColors"</span>, <span class="at">direction =</span> <span class="sc">-</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_size_continuous</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">4</span>)) <span class="sc">+</span></span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_edge_color_gradientn</span>(<span class="at">colors =</span> colrs) <span class="sc">+</span></span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_blank</span>() <span class="sc">+</span></span>
<span id="cb51-17"><a href="#cb51-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">title =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"midnightblue"</span>)) <span class="sc">+</span></span>
<span id="cb51-18"><a href="#cb51-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"The KosterLeckie Network"</span>)</span>
<span id="cb51-19"><a href="#cb51-19" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb51-20"><a href="#cb51-20" aria-hidden="true" tabindex="-1"></a>netKL<span class="sc">$</span>p</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using the `size` aesthetic in this geom was deprecated in ggplot2 3.4.0.
ℹ Please use `linewidth` in the `default_aes` field and elsewhere instead.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="ch14_covariances_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="model" class="level3" data-number="14.4.2">
<h3 data-number="14.4.2" class="anchored" data-anchor-id="model"><span class="header-section-number">14.4.2</span> Model</h3>
<p>$$ <span class="math display">\[\begin{align*}
\begin{bmatrix}
y_{a \rightarrow b} \\
y_{b \rightarrow a} \\
\end{bmatrix}
&amp;\sim
\begin{bmatrix}
\mathcal{Poisson}(\lambda_{AB}) \\
\mathcal{Poisson}(\lambda_{BA}) \\
\end{bmatrix} \\
\log{\lambda_{AB}} &amp;= \alpha + g_A + r_B + d_{AB} \\
\log{\lambda_{BA}} &amp;= \alpha + g_B + r_A + d_{BA} \\
\begin{bmatrix}
g_i \\
r_i \\
\end{bmatrix}
&amp;\sim
\mathcal{MVNormal}(
\begin{bmatrix}
0 \\
0
\end{bmatrix},
\Sigma_{gr}
) \\
\begin{bmatrix}
d_{ij} \\
d_{ji} \\
\end{bmatrix}
&amp;\sim
\mathcal{MVNormal}(
\begin{bmatrix}
0 \\
0
\end{bmatrix},
\Sigma_d
) \\

\Sigma_{gr} &amp;=
\begin{bmatrix}
\sigma_g &amp; 0 \\
0 &amp; \sigma_r &amp;
\end{bmatrix}
\cdot
\begin{bmatrix}
1 &amp; \rho_{gr} \\
\rho_{gr} &amp; 1 \\
\end{bmatrix}
\cdot
\begin{bmatrix}
\sigma_g &amp; 0 \\
0 &amp; \sigma_r \\
\end{bmatrix} \\

\Sigma_d &amp;=
\begin{bmatrix}
\sigma_d &amp; 0 \\
0 &amp; \sigma_d &amp;
\end{bmatrix}
\cdot
\begin{bmatrix}
1 &amp; \rho_d \\
\rho_d &amp; 1 \\
\end{bmatrix}
\cdot
\begin{bmatrix}
\sigma_d &amp; 0 \\
0 &amp; \sigma_d \\
\end{bmatrix} \\

\sigma_d, \sigma_g, \sigma_r &amp;\sim \mathcal{Exponential}(1) \\


\rho_{gr}, \rho_d &amp;\sim \mathcal{LKJ}(4)
\end{align*}\]</span> $$</p>
<p>Kurtz says that there is no known way to use <code>brms</code>. The package <code>bisonR</code> that specializes in social networks and uses <code>brms</code>. It can be found at <a href="https://github.com/JHart96/bisonR">bison</a> with a useful vignette at <a href="https://jordanhart.co.uk/bisonR/articles/getting_started.html">vignette</a>.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>This section is skipped. But one day, it might be interesting to do it with the <code>bisonR</code> package.</p>
</div>
</div>
</section>
</section>
<section id="continuous-categories-and-the-gaussian-process" class="level2" data-number="14.5">
<h2 data-number="14.5" class="anchored" data-anchor-id="continuous-categories-and-the-gaussian-process"><span class="header-section-number">14.5</span> Continuous categories and the Gaussian process</h2>
<section id="spatial-autocorrelation-in-oceanic-tools" class="level3" data-number="14.5.1">
<h3 data-number="14.5.1" class="anchored" data-anchor-id="spatial-autocorrelation-in-oceanic-tools"><span class="header-section-number">14.5.1</span> Spatial autocorrelation in Oceanic tools</h3>
<section id="data-1" class="level4" data-number="14.5.1.1">
<h4 data-number="14.5.1.1" class="anchored" data-anchor-id="data-1"><span class="header-section-number">14.5.1.1</span> Data</h4>
<p>The observed data is as follows. All the data is put in 2 dataframes to be able to analyse it as graph data.</p>
<ul>
<li>nodes_df: The data related to the nodes</li>
<li>edges_df: The data related to the edges, e.g.&nbsp;the distance between the cultures</li>
</ul>
<p>First we define the nodes dataframes</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Kline2)</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>dataKline <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>dataKline <span class="ot">&lt;-</span> <span class="fu">within</span>(dataKline, {</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>  nodes_df <span class="ot">&lt;-</span> Kline2 <span class="sc">|&gt;</span></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">log_pop_s =</span> <span class="fu">as.vector</span>(<span class="fu">scale</span>(logpop)),</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">cid =</span> <span class="fu">factor</span>(contact, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"low"</span>, <span class="st">"high"</span>))) <span class="sc">|&gt;</span></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># latitude and longitude coverted to thousands of km</span></span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># using the average distance at the equator</span></span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">lat_pos =</span> lat <span class="sc">*</span> <span class="fl">0.11132</span>,</span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>           <span class="at">lon2_pos =</span> lon2 <span class="sc">*</span> <span class="fl">0.11132</span>)</span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(Kline2)</span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a>dataKline<span class="sc">$</span>nodes_df <span class="sc">|&gt;</span></span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">skim</span>() <span class="sc">|&gt;</span></span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>n_missing, <span class="sc">-</span>complete_rate) <span class="sc">|&gt;</span></span>
<span id="cb53-16"><a href="#cb53-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="at">.cols =</span> <span class="fu">where</span>(is.numeric), <span class="at">.fns =</span> round, <span class="at">digits =</span> <span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<caption>Data summary</caption>
<tbody>
<tr class="odd">
<td style="text-align: left;">Name</td>
<td style="text-align: left;">dataKline$nodes_df</td>
</tr>
<tr class="even">
<td style="text-align: left;">Number of rows</td>
<td style="text-align: left;">10</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Number of columns</td>
<td style="text-align: left;">13</td>
</tr>
<tr class="even">
<td style="text-align: left;">_______________________</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Column type frequency:</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">factor</td>
<td style="text-align: left;">3</td>
</tr>
<tr class="odd">
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">10</td>
</tr>
<tr class="even">
<td style="text-align: left;">________________________</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Group variables</td>
<td style="text-align: left;">None</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: factor</strong></p>
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">skim_variable</th>
<th style="text-align: left;">ordered</th>
<th style="text-align: right;">n_unique</th>
<th style="text-align: left;">top_counts</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">culture</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">10</td>
<td style="text-align: left;">Chu: 1, Haw: 1, Lau: 1, Mal: 1</td>
</tr>
<tr class="even">
<td style="text-align: left;">contact</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">hig: 5, low: 5</td>
</tr>
<tr class="odd">
<td style="text-align: left;">cid</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">low: 5, hig: 5</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 17%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 11%">
<col style="width: 12%">
<col style="width: 7%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">skim_variable</th>
<th style="text-align: right;">mean</th>
<th style="text-align: right;">sd</th>
<th style="text-align: right;">p0</th>
<th style="text-align: right;">p25</th>
<th style="text-align: right;">p50</th>
<th style="text-align: right;">p75</th>
<th style="text-align: right;">p100</th>
<th style="text-align: left;">hist</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">population</td>
<td style="text-align: right;">34109.10</td>
<td style="text-align: right;">84793.03</td>
<td style="text-align: right;">1100.00</td>
<td style="text-align: right;">3897.75</td>
<td style="text-align: right;">7700.00</td>
<td style="text-align: right;">12050.00</td>
<td style="text-align: right;">275000.00</td>
<td style="text-align: left;">▇▁▁▁▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">total_tools</td>
<td style="text-align: right;">34.80</td>
<td style="text-align: right;">17.85</td>
<td style="text-align: right;">13.00</td>
<td style="text-align: right;">22.50</td>
<td style="text-align: right;">30.50</td>
<td style="text-align: right;">42.25</td>
<td style="text-align: right;">71.00</td>
<td style="text-align: left;">▇▃▃▂▂</td>
</tr>
<tr class="odd">
<td style="text-align: left;">mean_TU</td>
<td style="text-align: right;">4.83</td>
<td style="text-align: right;">1.14</td>
<td style="text-align: right;">3.20</td>
<td style="text-align: right;">4.00</td>
<td style="text-align: right;">4.85</td>
<td style="text-align: right;">5.30</td>
<td style="text-align: right;">6.60</td>
<td style="text-align: left;">▅▅▇▂▅</td>
</tr>
<tr class="even">
<td style="text-align: left;">lat</td>
<td style="text-align: right;">-5.22</td>
<td style="text-align: right;">13.51</td>
<td style="text-align: right;">-21.20</td>
<td style="text-align: right;">-15.30</td>
<td style="text-align: right;">-9.70</td>
<td style="text-align: right;">5.03</td>
<td style="text-align: right;">19.90</td>
<td style="text-align: left;">▇▇▂▅▂</td>
</tr>
<tr class="odd">
<td style="text-align: left;">lon</td>
<td style="text-align: right;">93.71</td>
<td style="text-align: right;">137.16</td>
<td style="text-align: right;">-175.20</td>
<td style="text-align: right;">140.30</td>
<td style="text-align: right;">151.25</td>
<td style="text-align: right;">167.12</td>
<td style="text-align: right;">178.10</td>
<td style="text-align: left;">▂▁▁▁▇</td>
</tr>
<tr class="even">
<td style="text-align: left;">lon2</td>
<td style="text-align: right;">-14.29</td>
<td style="text-align: right;">19.89</td>
<td style="text-align: right;">-41.90</td>
<td style="text-align: right;">-28.93</td>
<td style="text-align: right;">-13.25</td>
<td style="text-align: right;">-4.23</td>
<td style="text-align: right;">24.40</td>
<td style="text-align: left;">▇▂▇▅▂</td>
</tr>
<tr class="odd">
<td style="text-align: left;">logpop</td>
<td style="text-align: right;">8.98</td>
<td style="text-align: right;">1.53</td>
<td style="text-align: right;">7.00</td>
<td style="text-align: right;">8.26</td>
<td style="text-align: right;">8.95</td>
<td style="text-align: right;">9.39</td>
<td style="text-align: right;">12.52</td>
<td style="text-align: left;">▃▇▃▁▂</td>
</tr>
<tr class="even">
<td style="text-align: left;">log_pop_s</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">-1.29</td>
<td style="text-align: right;">-0.47</td>
<td style="text-align: right;">-0.02</td>
<td style="text-align: right;">0.27</td>
<td style="text-align: right;">2.32</td>
<td style="text-align: left;">▃▇▃▁▂</td>
</tr>
<tr class="odd">
<td style="text-align: left;">lat_pos</td>
<td style="text-align: right;">-0.58</td>
<td style="text-align: right;">1.50</td>
<td style="text-align: right;">-2.36</td>
<td style="text-align: right;">-1.70</td>
<td style="text-align: right;">-1.08</td>
<td style="text-align: right;">0.56</td>
<td style="text-align: right;">2.22</td>
<td style="text-align: left;">▇▇▂▅▂</td>
</tr>
<tr class="even">
<td style="text-align: left;">lon2_pos</td>
<td style="text-align: right;">-1.59</td>
<td style="text-align: right;">2.21</td>
<td style="text-align: right;">-4.66</td>
<td style="text-align: right;">-3.22</td>
<td style="text-align: right;">-1.47</td>
<td style="text-align: right;">-0.47</td>
<td style="text-align: right;">2.72</td>
<td style="text-align: left;">▇▂▇▅▂</td>
</tr>
</tbody>
</table>
</div>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># glimpse(dataKline$df)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>and we will also use a matrix of the longitudinal and latitudinal relative positions of the societies. This is an approximation only as it used the km per degree at the equator which is 111.32 km per degree at the equator. This gives the following relative position matrix.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(islandsDistMatrix)</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>dataKline <span class="ot">&lt;-</span> <span class="fu">within</span>(dataKline, {</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>  dist <span class="ot">&lt;-</span> islandsDistMatrix</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># create the edges dataframe</span></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>  edges_df <span class="ot">&lt;-</span> dist</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># set lower triangle and diagonal to 0 to avoid double values.</span></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># zeros can be removed later</span></span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>  edges_df[<span class="fu">lower.tri</span>(edges_df, <span class="at">diag =</span> <span class="cn">FALSE</span>)] <span class="ot">&lt;-</span> <span class="cn">NA_real_</span></span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># The distances in dataframe format</span></span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a>  edges_df <span class="ot">&lt;-</span> dist <span class="sc">|&gt;</span></span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.data.frame</span>() <span class="sc">|&gt;</span></span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a>    tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">"x"</span>) <span class="sc">|&gt;</span></span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span>x, <span class="at">names_to =</span> <span class="st">"y"</span>, <span class="at">values_to =</span> <span class="st">"dist"</span>)</span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb55-16"><a href="#cb55-16" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(islandsDistMatrix)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>and we can visualize the distance in a heatmap</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>heatmaply<span class="sc">::</span><span class="fu">heatmaply</span>(</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> dataKline<span class="sc">$</span>dist,</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">cellnote =</span> <span class="fu">round</span>(dataKline<span class="sc">$</span>dist, <span class="dv">1</span>),</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">colors =</span> <span class="fu">unclass</span>(paletteer<span class="sc">::</span><span class="fu">paletteer_c</span>(<span class="st">"pals::ocean.speed"</span>, <span class="at">n =</span> <span class="dv">16</span>)),</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">hide_colorbar =</span> <span class="cn">TRUE</span>,</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">main =</span> <span class="st">"Distances between Oceanic Societies in Thousands of km"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-337c8444eb7a14a88827" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-337c8444eb7a14a88827">{"x":{"data":[{"x":[3.6875,1,null,1,1,null,3.6875,6.375,null,6.375,6.375,null,6.375,3.625,null,3.625,3.625,null,3.625,2.5,null,2.5,2.5,null,2.5,2,null,2,2,null,2.5,3,null,3,3,null,3.625,4.75,null,4.75,4.75,null,4.75,4,null,4,4,null,4.75,5.5,null,5.5,5.5,null,5.5,5,null,5,5,null,5.5,6,null,6,6,null,6.375,9.125,null,9.125,9.125,null,9.125,8.25,null,8.25,8.25,null,8.25,7.5,null,7.5,7.5,null,7.5,7,null,7,7,null,7.5,8,null,8,8,null,8.25,9,null,9,9,null,9.125,10,null,10,10],"y":[14.242528005940519,14.242528005940519,null,14.242528005940519,0,null,14.242528005940519,14.242528005940519,null,14.242528005940519,11.682571763100793,null,11.682571763100793,11.682571763100793,null,11.682571763100793,5.9422722085074495,null,5.9422722085074495,5.9422722085074495,null,5.9422722085074495,2.1783264218202008,null,2.1783264218202008,2.1783264218202008,null,2.1783264218202008,0,null,2.1783264218202008,2.1783264218202008,null,2.1783264218202008,0,null,5.9422722085074495,5.9422722085074495,null,5.9422722085074495,1.4406984417288722,null,1.4406984417288722,1.4406984417288722,null,1.4406984417288722,0,null,1.4406984417288722,1.4406984417288722,null,1.4406984417288722,0.89666939280874292,null,0.89666939280874292,0.89666939280874292,null,0.89666939280874292,0,null,0.89666939280874292,0.89666939280874292,null,0.89666939280874292,0,null,11.682571763100793,11.682571763100793,null,11.682571763100793,6.1259859614595928,null,6.1259859614595928,6.1259859614595928,null,6.1259859614595928,3.5330892997488754,null,3.5330892997488754,3.5330892997488754,null,3.5330892997488754,2.2245601812493185,null,2.2245601812493185,2.2245601812493185,null,2.2245601812493185,0,null,2.2245601812493185,2.2245601812493185,null,2.2245601812493185,0,null,3.5330892997488754,3.5330892997488754,null,3.5330892997488754,0,null,6.1259859614595928,6.1259859614595928,null,6.1259859614595928,0],"text":["y: 14.2425280","y: 14.2425280",null,"y: 14.2425280","y: 14.2425280",null,"y: 14.2425280","y: 14.2425280",null,"y: 14.2425280","y: 14.2425280",null,"y: 11.6825718","y: 11.6825718",null,"y: 11.6825718","y: 11.6825718",null,"y:  5.9422722","y:  5.9422722",null,"y:  5.9422722","y:  5.9422722",null,"y:  2.1783264","y:  2.1783264",null,"y:  2.1783264","y:  2.1783264",null,"y:  2.1783264","y:  2.1783264",null,"y:  2.1783264","y:  2.1783264",null,"y:  5.9422722","y:  5.9422722",null,"y:  5.9422722","y:  5.9422722",null,"y:  1.4406984","y:  1.4406984",null,"y:  1.4406984","y:  1.4406984",null,"y:  1.4406984","y:  1.4406984",null,"y:  1.4406984","y:  1.4406984",null,"y:  0.8966694","y:  0.8966694",null,"y:  0.8966694","y:  0.8966694",null,"y:  0.8966694","y:  0.8966694",null,"y:  0.8966694","y:  0.8966694",null,"y: 11.6825718","y: 11.6825718",null,"y: 11.6825718","y: 11.6825718",null,"y:  6.1259860","y:  6.1259860",null,"y:  6.1259860","y:  6.1259860",null,"y:  3.5330893","y:  3.5330893",null,"y:  3.5330893","y:  3.5330893",null,"y:  2.2245602","y:  2.2245602",null,"y:  2.2245602","y:  2.2245602",null,"y:  2.2245602","y:  2.2245602",null,"y:  2.2245602","y:  2.2245602",null,"y:  3.5330893","y:  3.5330893",null,"y:  3.5330893","y:  3.5330893",null,"y:  6.1259860","y:  6.1259860",null,"y:  6.1259860","y:  6.1259860"],"type":"scatter","mode":"lines","line":{"width":2.2677165354330708,"color":"rgba(0,0,0,1)","dash":"solid"},"hoveron":"points","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[3.6875,1,6.375,3.625,2.5,2,3,4.75,4,5.5,5,6,9.125,8.25,7.5,7,8,9,10],"y":[14.242528005940519,0,11.682571763100793,5.9422722085074495,2.1783264218202008,0,0,1.4406984417288722,0,0.89666939280874292,0,0,6.1259859614595928,3.5330892997488754,2.2245601812493185,0,0,0,0],"text":["y: 14.2425280","y:  0.0000000","y: 11.6825718","y:  5.9422722","y:  2.1783264","y:  0.0000000","y:  0.0000000","y:  1.4406984","y:  0.0000000","y:  0.8966694","y:  0.0000000","y:  0.0000000","y:  6.1259860","y:  3.5330893","y:  2.2245602","y:  0.0000000","y:  0.0000000","y:  0.0000000","y:  0.0000000"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"transparent","opacity":1,"size":null,"symbol":null,"line":{"width":1.8897637795275593,"color":"transparent"}},"hoveron":"points","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"type":"scatter","mode":"markers","marker":{"color":"rgba(44,160,44,1)","line":{"color":"rgba(44,160,44,1)"}},"error_y":{"color":"rgba(44,160,44,1)"},"error_x":{"color":"rgba(44,160,44,1)"},"line":{"color":"rgba(44,160,44,1)"},"xaxis":"x2","yaxis":"y","frame":null},{"x":[1,2,3,4,5,6,7,8,9,10],"y":[1,2,3,4,5,6,7,8,9,10],"z":[[0,0.70172750069657286,0.68041237113402064,0.79102814154360546,0.73599888548342163,0.75243800501532454,0.9268598495402619,0.93647255502925608,0.80621342992477008,1],[0.70172750069657286,0,0.10629701866815269,0.25912510448592924,0.27375313457787687,0.31749791028141544,0.54235162998049591,0.6439119531903037,0.66717748676511557,0.8548342156589579],[0.68041237113402064,0.10629701866815269,0,0.17191418222346058,0.1721928113680691,0.21593758707160771,0.44845360824742264,0.54416271942045136,0.56101978266926722,0.75104485929228193],[0.79102814154360546,0.25912510448592924,0.17191418222346058,0,0.066174421844524933,0.087907495123989973,0.28364446921147951,0.38924491501811093,0.44274171078294788,0.6078294789634997],[0.73599888548342163,0.27375313457787687,0.1721928113680691,0.066174421844524933,0,0.043884090275842856,0.27960434661465589,0.37196990805238228,0.4008080245193647,0.58135971022568966],[0.75243800501532454,0.31749791028141544,0.21593758707160771,0.087907495123989973,0.043884090275842856,0,0.23794928949568125,0.32822513234884365,0.36054611312343271,0.53761493452215103],[0.9268598495402619,0.54235162998049591,0.44845360824742264,0.28364446921147951,0.27960434661465589,0.23794928949568125,0,0.11841738645862357,0.25090554471997772,0.3429924770130956],[0.93647255502925608,0.6439119531903037,0.54416271942045136,0.38924491501811093,0.37196990805238228,0.32822513234884365,0.11841738645862357,0,0.16898857620507107,0.22513234884368907],[0.80621342992477008,0.66717748676511557,0.56101978266926722,0.44274171078294788,0.4008080245193647,0.36054611312343271,0.25090554471997772,0.16898857620507107,0,0.21663415993312901],[1,0.8548342156589579,0.75104485929228193,0.6078294789634997,0.58135971022568966,0.53761493452215103,0.3429924770130956,0.22513234884368907,0.21663415993312901,0]],"text":[["row: Hawaii<br>column: Hawaii<br>value: 0.000","row: Hawaii<br>column: Tonga<br>value: 5.037","row: Hawaii<br>column: Lau Fiji<br>value: 4.884","row: Hawaii<br>column: Malekula<br>value: 5.678","row: Hawaii<br>column: Tikopia<br>value: 5.283","row: Hawaii<br>column: Santa Cruz<br>value: 5.401","row: Hawaii<br>column: Trobriand<br>value: 6.653","row: Hawaii<br>column: Manus<br>value: 6.722","row: Hawaii<br>column: Chuuk<br>value: 5.787","row: Hawaii<br>column: Yap<br>value: 7.178"],["row: Tonga<br>column: Hawaii<br>value: 5.037","row: Tonga<br>column: Tonga<br>value: 0.000","row: Tonga<br>column: Lau Fiji<br>value: 0.763","row: Tonga<br>column: Malekula<br>value: 1.860","row: Tonga<br>column: Tikopia<br>value: 1.965","row: Tonga<br>column: Santa Cruz<br>value: 2.279","row: Tonga<br>column: Trobriand<br>value: 3.893","row: Tonga<br>column: Manus<br>value: 4.622","row: Tonga<br>column: Chuuk<br>value: 4.789","row: Tonga<br>column: Yap<br>value: 6.136"],["row: Lau Fiji<br>column: Hawaii<br>value: 4.884","row: Lau Fiji<br>column: Tonga<br>value: 0.763","row: Lau Fiji<br>column: Lau Fiji<br>value: 0.000","row: Lau Fiji<br>column: Malekula<br>value: 1.234","row: Lau Fiji<br>column: Tikopia<br>value: 1.236","row: Lau Fiji<br>column: Santa Cruz<br>value: 1.550","row: Lau Fiji<br>column: Trobriand<br>value: 3.219","row: Lau Fiji<br>column: Manus<br>value: 3.906","row: Lau Fiji<br>column: Chuuk<br>value: 4.027","row: Lau Fiji<br>column: Yap<br>value: 5.391"],["row: Malekula<br>column: Hawaii<br>value: 5.678","row: Malekula<br>column: Tonga<br>value: 1.860","row: Malekula<br>column: Lau Fiji<br>value: 1.234","row: Malekula<br>column: Malekula<br>value: 0.000","row: Malekula<br>column: Tikopia<br>value: 0.475","row: Malekula<br>column: Santa Cruz<br>value: 0.631","row: Malekula<br>column: Trobriand<br>value: 2.036","row: Malekula<br>column: Manus<br>value: 2.794","row: Malekula<br>column: Chuuk<br>value: 3.178","row: Malekula<br>column: Yap<br>value: 4.363"],["row: Tikopia<br>column: Hawaii<br>value: 5.283","row: Tikopia<br>column: Tonga<br>value: 1.965","row: Tikopia<br>column: Lau Fiji<br>value: 1.236","row: Tikopia<br>column: Malekula<br>value: 0.475","row: Tikopia<br>column: Tikopia<br>value: 0.000","row: Tikopia<br>column: Santa Cruz<br>value: 0.315","row: Tikopia<br>column: Trobriand<br>value: 2.007","row: Tikopia<br>column: Manus<br>value: 2.670","row: Tikopia<br>column: Chuuk<br>value: 2.877","row: Tikopia<br>column: Yap<br>value: 4.173"],["row: Santa Cruz<br>column: Hawaii<br>value: 5.401","row: Santa Cruz<br>column: Tonga<br>value: 2.279","row: Santa Cruz<br>column: Lau Fiji<br>value: 1.550","row: Santa Cruz<br>column: Malekula<br>value: 0.631","row: Santa Cruz<br>column: Tikopia<br>value: 0.315","row: Santa Cruz<br>column: Santa Cruz<br>value: 0.000","row: Santa Cruz<br>column: Trobriand<br>value: 1.708","row: Santa Cruz<br>column: Manus<br>value: 2.356","row: Santa Cruz<br>column: Chuuk<br>value: 2.588","row: Santa Cruz<br>column: Yap<br>value: 3.859"],["row: Trobriand<br>column: Hawaii<br>value: 6.653","row: Trobriand<br>column: Tonga<br>value: 3.893","row: Trobriand<br>column: Lau Fiji<br>value: 3.219","row: Trobriand<br>column: Malekula<br>value: 2.036","row: Trobriand<br>column: Tikopia<br>value: 2.007","row: Trobriand<br>column: Santa Cruz<br>value: 1.708","row: Trobriand<br>column: Trobriand<br>value: 0.000","row: Trobriand<br>column: Manus<br>value: 0.850","row: Trobriand<br>column: Chuuk<br>value: 1.801","row: Trobriand<br>column: Yap<br>value: 2.462"],["row: Manus<br>column: Hawaii<br>value: 6.722","row: Manus<br>column: Tonga<br>value: 4.622","row: Manus<br>column: Lau Fiji<br>value: 3.906","row: Manus<br>column: Malekula<br>value: 2.794","row: Manus<br>column: Tikopia<br>value: 2.670","row: Manus<br>column: Santa Cruz<br>value: 2.356","row: Manus<br>column: Trobriand<br>value: 0.850","row: Manus<br>column: Manus<br>value: 0.000","row: Manus<br>column: Chuuk<br>value: 1.213","row: Manus<br>column: Yap<br>value: 1.616"],["row: Chuuk<br>column: Hawaii<br>value: 5.787","row: Chuuk<br>column: Tonga<br>value: 4.789","row: Chuuk<br>column: Lau Fiji<br>value: 4.027","row: Chuuk<br>column: Malekula<br>value: 3.178","row: Chuuk<br>column: Tikopia<br>value: 2.877","row: Chuuk<br>column: Santa Cruz<br>value: 2.588","row: Chuuk<br>column: Trobriand<br>value: 1.801","row: Chuuk<br>column: Manus<br>value: 1.213","row: Chuuk<br>column: Chuuk<br>value: 0.000","row: Chuuk<br>column: Yap<br>value: 1.555"],["row: Yap<br>column: Hawaii<br>value: 7.178","row: Yap<br>column: Tonga<br>value: 6.136","row: Yap<br>column: Lau Fiji<br>value: 5.391","row: Yap<br>column: Malekula<br>value: 4.363","row: Yap<br>column: Tikopia<br>value: 4.173","row: Yap<br>column: Santa Cruz<br>value: 3.859","row: Yap<br>column: Trobriand<br>value: 2.462","row: Yap<br>column: Manus<br>value: 1.616","row: Yap<br>column: Chuuk<br>value: 1.555","row: Yap<br>column: Yap<br>value: 0.000"]],"colorscale":[[0,"#FFFDCD"],[0.043884090275842856,"#F7F0B5"],[0.066174421844524933,"#F3E9A8"],[0.087907495123989973,"#EFE39D"],[0.10629701866815269,"#EBDE93"],[0.11841738645862357,"#E9DA8C"],[0.16898857620507107,"#DDCD71"],[0.17191418222346058,"#DCCC6F"],[0.1721928113680691,"#DCCC6F"],[0.21593758707160771,"#D0C258"],[0.21663415993312901,"#D0C158"],[0.22513234884368907,"#CEC054"],[0.23794928949568125,"#CABD4D"],[0.25090554471997772,"#C7BA46"],[0.25912510448592924,"#C4B942"],[0.27375313457787687,"#BFB63B"],[0.27960434661465589,"#BDB539"],[0.28364446921147951,"#BBB438"],[0.31749791028141544,"#AEAF2A"],[0.32822513234884365,"#AAAD25"],[0.3429924770130956,"#A4AA21"],[0.36054611312343271,"#9DA81C"],[0.37196990805238228,"#98A619"],[0.38924491501811093,"#91A314"],[0.4008080245193647,"#8CA110"],[0.44274171078294788,"#799B0D"],[0.44845360824742264,"#769A0D"],[0.53761493452215103,"#4E8A12"],[0.54235162998049591,"#4C8913"],[0.54416271942045136,"#4C8914"],[0.56101978266926722,"#448617"],[0.58135971022568966,"#3B821B"],[0.6078294789634997,"#307D1F"],[0.6439119531903037,"#257624"],[0.66717748676511557,"#1D7126"],[0.68041237113402064,"#1A6E27"],[0.70172750069657286,"#166929"],[0.73599888548342163,"#0E612B"],[0.75104485929228193,"#0F5E2B"],[0.75243800501532454,"#0F5D2B"],[0.79102814154360546,"#0F542A"],[0.80621342992477008,"#10502A"],[0.8548342156589579,"#154527"],[0.9268598495402619,"#17341E"],[0.93647255502925608,"#17311D"],[1,"#172313"]],"type":"heatmap","showscale":false,"autocolorscale":false,"showlegend":false,"xaxis":"x","yaxis":"y2","hoverinfo":"text","frame":null},{"x":[1],"y":[1],"name":"99_b47bed16170256dd91aea5a50efe11aa","type":"scatter","mode":"markers","opacity":0,"hoverinfo":"skip","showlegend":false,"marker":{"color":[0,1],"colorscale":[[0,"#FFFDCD"],[0.0033444816053511705,"#FEFCCB"],[0.006688963210702341,"#FEFBC9"],[0.01003344481605351,"#FDFAC7"],[0.013377926421404682,"#FDF9C6"],[0.016722408026755852,"#FCF8C4"],[0.02006688963210702,"#FCF7C2"],[0.023411371237458192,"#FBF6C0"],[0.026755852842809364,"#FAF5BE"],[0.030100334448160532,"#FAF4BC"],[0.033444816053511704,"#F9F3BA"],[0.036789297658862873,"#F9F2B9"],[0.040133779264214041,"#F8F1B7"],[0.043478260869565216,"#F7F0B5"],[0.046822742474916385,"#F7EFB3"],[0.05016722408026756,"#F6EEB1"],[0.053511705685618728,"#F5EDAF"],[0.05685618729096989,"#F5ECAD"],[0.060200668896321065,"#F4EBAC"],[0.06354515050167224,"#F4EAAA"],[0.066889632107023408,"#F3E9A8"],[0.070234113712374577,"#F2E8A6"],[0.073578595317725745,"#F2E7A4"],[0.076923076923076913,"#F1E6A2"],[0.080267558528428082,"#F0E5A1"],[0.08361204013377925,"#F0E49F"],[0.086956521739130432,"#EFE39D"],[0.090301003344481601,"#EFE29B"],[0.093645484949832769,"#EEE199"],[0.096989966555183937,"#EDE098"],[0.10033444816053512,"#EDDF96"],[0.10367892976588629,"#ECDE94"],[0.10702341137123746,"#EBDD92"],[0.11036789297658861,"#EBDD90"],[0.11371237458193978,"#EADC8F"],[0.11705685618729096,"#E9DB8D"],[0.12040133779264213,"#E9DA8B"],[0.1237458193979933,"#E8D989"],[0.12709030100334448,"#E7D887"],[0.13043478260869565,"#E7D786"],[0.13377926421404682,"#E6D684"],[0.13712374581939799,"#E5D582"],[0.14046822742474915,"#E4D480"],[0.14381270903010032,"#E3D37E"],[0.14715719063545149,"#E3D27D"],[0.15050167224080266,"#E2D27B"],[0.15384615384615383,"#E1D179"],[0.157190635451505,"#E0D077"],[0.16053511705685616,"#DFCF75"],[0.16387959866220733,"#DECE74"],[0.1672240802675585,"#DDCD72"],[0.1705685618729097,"#DDCC70"],[0.17391304347826086,"#DCCC6E"],[0.17725752508361203,"#DBCB6C"],[0.1806020066889632,"#DACA6B"],[0.18394648829431437,"#D9C969"],[0.18729096989966554,"#D8C867"],[0.19063545150501671,"#D7C765"],[0.19397993311036787,"#D7C763"],[0.19732441471571904,"#D6C661"],[0.20066889632107024,"#D5C560"],[0.20401337792642141,"#D4C45E"],[0.20735785953177258,"#D3C35C"],[0.21070234113712374,"#D2C35B"],[0.21404682274247491,"#D1C259"],[0.21739130434782608,"#D0C157"],[0.22073578595317722,"#CFC156"],[0.22408026755852839,"#CEC054"],[0.22742474916387956,"#CDBF52"],[0.23076923076923075,"#CCBF51"],[0.23411371237458192,"#CBBE4F"],[0.23745819397993309,"#CABD4D"],[0.24080267558528426,"#C9BC4C"],[0.24414715719063543,"#C8BC4A"],[0.2474916387959866,"#C8BB48"],[0.25083612040133779,"#C7BA46"],[0.25418060200668896,"#C6BA45"],[0.25752508361204013,"#C5B943"],[0.2608695652173913,"#C4B841"],[0.26421404682274247,"#C3B83F"],[0.26755852842809363,"#C2B73E"],[0.2709030100334448,"#C0B63C"],[0.27424749163879597,"#BFB63B"],[0.27759197324414714,"#BEB53A"],[0.28093645484949831,"#BCB539"],[0.28428093645484948,"#BBB437"],[0.28762541806020064,"#BAB436"],[0.29096989966555181,"#B9B335"],[0.29431438127090298,"#B7B234"],[0.29765886287625415,"#B6B232"],[0.30100334448160532,"#B5B131"],[0.30434782608695649,"#B3B130"],[0.30769230769230765,"#B2B02E"],[0.31103678929765888,"#B1B02D"],[0.31438127090300999,"#AFAF2B"],[0.31772575250836121,"#AEAF2A"],[0.32107023411371233,"#ADAE29"],[0.32441471571906355,"#ABAD27"],[0.32775919732441466,"#AAAD26"],[0.33110367892976589,"#A9AC24"],[0.334448160535117,"#A8AC23"],[0.33779264214046822,"#A6AB22"],[0.34113712374581939,"#A5AB21"],[0.34448160535117056,"#A3AA20"],[0.34782608695652173,"#A2AA1F"],[0.35117056856187284,"#A1A91F"],[0.35451505016722407,"#9FA91E"],[0.35785953177257518,"#9EA81D"],[0.3612040133779264,"#9CA71C"],[0.36454849498327752,"#9BA71B"],[0.36789297658862874,"#9AA61A"],[0.37123745819397991,"#98A619"],[0.37458193979933108,"#97A518"],[0.37792642140468224,"#95A517"],[0.38127090301003341,"#94A416"],[0.38461538461538458,"#92A415"],[0.38795986622073575,"#91A314"],[0.39130434782608692,"#90A213"],[0.39464882943143809,"#8EA212"],[0.39799331103678925,"#8DA111"],[0.40133779264214048,"#8BA110"],[0.40468227424749159,"#8AA010"],[0.40802675585284282,"#88A010"],[0.41137123745819393,"#879F0F"],[0.41471571906354515,"#859F0F"],[0.41806020066889626,"#849E0F"],[0.42140468227424749,"#839E0F"],[0.4247491638795986,"#819D0E"],[0.42809364548494983,"#809D0E"],[0.43143812709030099,"#7E9C0E"],[0.43478260869565216,"#7D9C0E"],[0.43812709030100333,"#7B9B0E"],[0.44147157190635444,"#7A9B0D"],[0.44481605351170567,"#789A0D"],[0.44816053511705678,"#769A0D"],[0.451505016722408,"#75990D"],[0.45484949832775912,"#73990D"],[0.45819397993311034,"#72980C"],[0.46153846153846151,"#70980C"],[0.46488294314381268,"#6F970C"],[0.46822742474916385,"#6D970C"],[0.47157190635451501,"#6C960C"],[0.47491638795986618,"#6A960D"],[0.47826086956521735,"#69950D"],[0.48160535117056852,"#67940D"],[0.48494983277591969,"#66940E"],[0.48829431438127086,"#65930E"],[0.49163879598662208,"#63930E"],[0.49498327759197319,"#62920E"],[0.49832775919732442,"#60910F"],[0.50167224080267558,"#5F910F"],[0.50501672240802675,"#5D900F"],[0.50836120401337792,"#5C900F"],[0.51170568561872909,"#5A8F10"],[0.51505016722408026,"#598E10"],[0.51839464882943143,"#578E10"],[0.52173913043478259,"#558D10"],[0.52508361204013376,"#548C11"],[0.52842809364548493,"#528C11"],[0.5317725752508361,"#518B11"],[0.53511705685618727,"#4F8B11"],[0.53846153846153844,"#4E8A12"],[0.5418060200668896,"#4D8913"],[0.54515050167224077,"#4B8914"],[0.54849498327759194,"#4A8815"],[0.55183946488294311,"#488815"],[0.55518394648829428,"#478716"],[0.55852842809364545,"#458617"],[0.56187290969899661,"#448618"],[0.56521739130434778,"#438518"],[0.56856187290969895,"#418519"],[0.57190635451505012,"#408419"],[0.57525083612040129,"#3E831A"],[0.57859531772575246,"#3C831B"],[0.58193979933110362,"#3B821B"],[0.58528428093645479,"#39821C"],[0.58862876254180596,"#38811C"],[0.59197324414715724,"#36801D"],[0.5953177257525083,"#34801D"],[0.59866220735785947,"#337F1E"],[0.60200668896321063,"#317F1E"],[0.60535117056856191,"#307E1F"],[0.60869565217391297,"#307D1F"],[0.61204013377926414,"#2F7C20"],[0.61538461538461531,"#2E7C20"],[0.61872909698996659,"#2D7B21"],[0.62207357859531776,"#2C7A21"],[0.62541806020066881,"#2B7A21"],[0.62876254180601998,"#2A7922"],[0.63210702341137115,"#297822"],[0.63545150501672243,"#287823"],[0.63879598662207349,"#277723"],[0.64214046822742465,"#257623"],[0.64548494983277582,"#247524"],[0.6488294314381271,"#237524"],[0.65217391304347827,"#227425"],[0.65551839464882933,"#217325"],[0.6588628762541805,"#207325"],[0.66220735785953178,"#1F7226"],[0.66555183946488294,"#1D7126"],[0.668896321070234,"#1D7026"],[0.67224080267558517,"#1C7026"],[0.67558528428093645,"#1B6F27"],[0.67892976588628762,"#1B6E27"],[0.68227424749163879,"#1A6D27"],[0.68561872909698984,"#196D28"],[0.68896321070234112,"#196C28"],[0.69230769230769229,"#186B28"],[0.69565217391304346,"#176A28"],[0.69899665551839452,"#166A29"],[0.70234113712374568,"#166929"],[0.70568561872909696,"#156829"],[0.70903010033444813,"#146729"],[0.7123745819397993,"#13672A"],[0.71571906354515036,"#13662A"],[0.71906354515050164,"#12652A"],[0.72240802675585281,"#11642A"],[0.72575250836120397,"#10642B"],[0.72909698996655503,"#0F632B"],[0.73244147157190631,"#0E622B"],[0.73578595317725748,"#0E612B"],[0.73913043478260865,"#0E612B"],[0.74247491638795982,"#0E602B"],[0.74581939799331098,"#0E5F2B"],[0.74916387959866215,"#0E5E2B"],[0.75250836120401332,"#0F5D2B"],[0.75585284280936449,"#0F5D2B"],[0.75919732441471566,"#0F5C2B"],[0.76254180602006683,"#0F5B2B"],[0.76588628762541799,"#0F5A2B"],[0.76923076923076916,"#0F592B"],[0.77257525083612044,"#0F592A"],[0.7759197324414715,"#0F582A"],[0.77926421404682267,"#0F572A"],[0.78260869565217384,"#0F562A"],[0.78595317725752512,"#0F552A"],[0.78929765886287617,"#0F552A"],[0.79264214046822734,"#0F542A"],[0.79598662207357851,"#0F532A"],[0.79933110367892979,"#0F522A"],[0.80267558528428096,"#0F512A"],[0.80602006688963201,"#10512A"],[0.80936454849498318,"#105029"],[0.81270903010033435,"#114F29"],[0.81605351170568563,"#114E29"],[0.81939799331103669,"#124D29"],[0.82274247491638786,"#124C29"],[0.82608695652173902,"#134C28"],[0.8294314381270903,"#134B28"],[0.83277591973244147,"#134A28"],[0.83612040133779253,"#144928"],[0.8394648829431437,"#144828"],[0.84280936454849498,"#144827"],[0.84615384615384615,"#154727"],[0.8494983277591972,"#154627"],[0.85284280936454837,"#154527"],[0.85618729096989965,"#154427"],[0.85953177257525082,"#164426"],[0.86287625418060199,"#164326"],[0.86622073578595304,"#164226"],[0.86956521739130432,"#164126"],[0.87290969899665549,"#164025"],[0.87625418060200666,"#164025"],[0.87959866220735772,"#163F24"],[0.88294314381270889,"#173E24"],[0.88628762541806017,"#173D23"],[0.88963210702341133,"#173C23"],[0.8929765886287625,"#173C22"],[0.89632107023411356,"#173B22"],[0.89966555183946484,"#173A22"],[0.90301003344481601,"#173921"],[0.90635451505016718,"#173821"],[0.90969899665551823,"#173820"],[0.91304347826086951,"#173720"],[0.91638795986622068,"#17361F"],[0.91973244147157185,"#17351F"],[0.92307692307692302,"#17341E"],[0.92642140468227419,"#17341E"],[0.92976588628762535,"#17331D"],[0.93311036789297652,"#17321D"],[0.93645484949832769,"#17311D"],[0.93979933110367886,"#17311C"],[0.94314381270903003,"#17301C"],[0.9464882943143812,"#172F1B"],[0.94983277591973236,"#172E1B"],[0.95317725752508364,"#172D1A"],[0.9565217391304347,"#172D1A"],[0.95986622073578587,"#172C19"],[0.96321070234113704,"#172B19"],[0.96655518394648832,"#172A18"],[0.96989966555183937,"#172A18"],[0.97324414715719054,"#172917"],[0.97658862876254171,"#172817"],[0.97993311036789299,"#172716"],[0.98327759197324416,"#172716"],[0.98662207357859522,"#172615"],[0.98996655518394638,"#172515"],[0.99331103678929755,"#172414"],[0.99665551839464883,"#172414"],[1,"#172313"]],"colorbar":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.8897637795275593,"thickness":23.039999999999996,"title":null,"titlefont":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724},"tickmode":"array","ticktext":["0","2","4","6"],"tickvals":[0,0.27862914460852606,0.55725828921705212,0.83588743382557817],"tickfont":{"color":"rgba(0,0,0,1)","family":"","size":11.68949771689498},"ticklen":2,"len":0.5},"showscale":false},"xaxis":"x","yaxis":"y2","frame":null},{"x":[1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,9,9,9,9,9,9,9,9,9,9,10,10,10,10,10,10,10,10,10,10],"y":[1,2,3,4,5,6,7,8,9,10,1,2,3,4,5,6,7,8,9,10,1,2,3,4,5,6,7,8,9,10,1,2,3,4,5,6,7,8,9,10,1,2,3,4,5,6,7,8,9,10,1,2,3,4,5,6,7,8,9,10,1,2,3,4,5,6,7,8,9,10,1,2,3,4,5,6,7,8,9,10,1,2,3,4,5,6,7,8,9,10,1,2,3,4,5,6,7,8,9,10],"text":["0","5","4.9","5.7","5.3","5.4","6.7","6.7","5.8","7.2","5","0","0.8","1.9","2","2.3","3.9","4.6","4.8","6.1","4.9","0.8","0","1.2","1.2","1.6","3.2","3.9","4","5.4","5.7","1.9","1.2","0","0.5","0.6","2","2.8","3.2","4.4","5.3","2","1.2","0.5","0","0.3","2","2.7","2.9","4.2","5.4","2.3","1.6","0.6","0.3","0","1.7","2.4","2.6","3.9","6.7","3.9","3.2","2","2","1.7","0","0.8","1.8","2.5","6.7","4.6","3.9","2.8","2.7","2.4","0.8","0","1.2","1.6","5.8","4.8","4","3.2","2.9","2.6","1.8","1.2","0","1.6","7.2","6.1","5.4","4.4","4.2","3.9","2.5","1.6","1.6","0"],"customdata":[0,5.0369999999999999,4.8840000000000003,5.6779999999999999,5.2830000000000004,5.4009999999999998,6.6529999999999996,6.7220000000000004,5.7869999999999999,7.1779999999999999,5.0369999999999999,0,0.76300000000000001,1.8600000000000001,1.9650000000000001,2.2789999999999999,3.8929999999999998,4.6219999999999999,4.7889999999999997,6.1360000000000001,4.8840000000000003,0.76300000000000001,0,1.234,1.236,1.55,3.2189999999999999,3.9060000000000001,4.0270000000000001,5.391,5.6779999999999999,1.8600000000000001,1.234,0,0.47499999999999998,0.63100000000000001,2.036,2.794,3.1779999999999999,4.3630000000000004,5.2830000000000004,1.9650000000000001,1.236,0.47499999999999998,0,0.315,2.0070000000000001,2.6699999999999999,2.8769999999999998,4.173,5.4009999999999998,2.2789999999999999,1.55,0.63100000000000001,0.315,0,1.708,2.3559999999999999,2.5880000000000001,3.859,6.6529999999999996,3.8929999999999998,3.2189999999999999,2.036,2.0070000000000001,1.708,0,0.84999999999999998,1.8009999999999999,2.4620000000000002,6.7220000000000004,4.6219999999999999,3.9060000000000001,2.794,2.6699999999999999,2.3559999999999999,0.84999999999999998,0,1.2130000000000001,1.6160000000000001,5.7869999999999999,4.7889999999999997,4.0270000000000001,3.1779999999999999,2.8769999999999998,2.5880000000000001,1.8009999999999999,1.2130000000000001,0,1.5549999999999999,7.1779999999999999,6.1360000000000001,5.391,4.3630000000000004,4.173,3.859,2.4620000000000002,1.6160000000000001,1.5549999999999999,0],"type":"scatter","mode":"text","textposition":["middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right"],"hovertemplate":["row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>"],"showlegend":false,"textfont":{"color":["rgba(0,0,0,1)","rgba(255,255,255,1)","rgba(255,255,255,1)","rgba(255,255,255,1)","rgba(255,255,255,1)","rgba(255,255,255,1)","rgba(255,255,255,1)","rgba(255,255,255,1)","rgba(255,255,255,1)","rgba(255,255,255,1)","rgba(255,255,255,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(255,255,255,1)","rgba(255,255,255,1)","rgba(255,255,255,1)","rgba(255,255,255,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(255,255,255,1)","rgba(255,255,255,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(255,255,255,1)","rgba(255,255,255,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(255,255,255,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(255,255,255,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(255,255,255,1)","rgba(255,255,255,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(255,255,255,1)","rgba(255,255,255,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(255,255,255,1)","rgba(255,255,255,1)","rgba(255,255,255,1)","rgba(255,255,255,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)"],"size":12},"marker":{"color":"rgba(140,86,75,1)","line":{"color":"rgba(140,86,75,1)"},"showscale":false},"error_y":{"color":"rgba(140,86,75,1)"},"error_x":{"color":"rgba(140,86,75,1)"},"line":{"color":"rgba(140,86,75,1)"},"xaxis":"x","yaxis":"y2","frame":null},{"x":[14.242528005940519,14.242528005940519,null,14.242528005940519,0,null,14.242528005940519,14.242528005940519,null,14.242528005940519,11.682571763100793,null,11.682571763100793,11.682571763100793,null,11.682571763100793,5.9422722085074495,null,5.9422722085074495,5.9422722085074495,null,5.9422722085074495,2.1783264218202008,null,2.1783264218202008,2.1783264218202008,null,2.1783264218202008,0,null,2.1783264218202008,2.1783264218202008,null,2.1783264218202008,0,null,5.9422722085074495,5.9422722085074495,null,5.9422722085074495,1.4406984417288722,null,1.4406984417288722,1.4406984417288722,null,1.4406984417288722,0,null,1.4406984417288722,1.4406984417288722,null,1.4406984417288722,0.89666939280874292,null,0.89666939280874292,0.89666939280874292,null,0.89666939280874292,0,null,0.89666939280874292,0.89666939280874292,null,0.89666939280874292,0,null,11.682571763100793,11.682571763100793,null,11.682571763100793,6.1259859614595928,null,6.1259859614595928,6.1259859614595928,null,6.1259859614595928,3.5330892997488754,null,3.5330892997488754,3.5330892997488754,null,3.5330892997488754,2.2245601812493185,null,2.2245601812493185,2.2245601812493185,null,2.2245601812493185,0,null,2.2245601812493185,2.2245601812493185,null,2.2245601812493185,0,null,3.5330892997488754,3.5330892997488754,null,3.5330892997488754,0,null,6.1259859614595928,6.1259859614595928,null,6.1259859614595928,0],"y":[3.6875,1,null,1,1,null,3.6875,6.375,null,6.375,6.375,null,6.375,3.625,null,3.625,3.625,null,3.625,2.5,null,2.5,2.5,null,2.5,2,null,2,2,null,2.5,3,null,3,3,null,3.625,4.75,null,4.75,4.75,null,4.75,4,null,4,4,null,4.75,5.5,null,5.5,5.5,null,5.5,5,null,5,5,null,5.5,6,null,6,6,null,6.375,9.125,null,9.125,9.125,null,9.125,8.25,null,8.25,8.25,null,8.25,7.5,null,7.5,7.5,null,7.5,7,null,7,7,null,7.5,8,null,8,8,null,8.25,9,null,9,9,null,9.125,10,null,10,10],"text":["y: 14.2425280","y: 14.2425280",null,"y: 14.2425280","y: 14.2425280",null,"y: 14.2425280","y: 14.2425280",null,"y: 14.2425280","y: 14.2425280",null,"y: 11.6825718","y: 11.6825718",null,"y: 11.6825718","y: 11.6825718",null,"y:  5.9422722","y:  5.9422722",null,"y:  5.9422722","y:  5.9422722",null,"y:  2.1783264","y:  2.1783264",null,"y:  2.1783264","y:  2.1783264",null,"y:  2.1783264","y:  2.1783264",null,"y:  2.1783264","y:  2.1783264",null,"y:  5.9422722","y:  5.9422722",null,"y:  5.9422722","y:  5.9422722",null,"y:  1.4406984","y:  1.4406984",null,"y:  1.4406984","y:  1.4406984",null,"y:  1.4406984","y:  1.4406984",null,"y:  1.4406984","y:  1.4406984",null,"y:  0.8966694","y:  0.8966694",null,"y:  0.8966694","y:  0.8966694",null,"y:  0.8966694","y:  0.8966694",null,"y:  0.8966694","y:  0.8966694",null,"y: 11.6825718","y: 11.6825718",null,"y: 11.6825718","y: 11.6825718",null,"y:  6.1259860","y:  6.1259860",null,"y:  6.1259860","y:  6.1259860",null,"y:  3.5330893","y:  3.5330893",null,"y:  3.5330893","y:  3.5330893",null,"y:  2.2245602","y:  2.2245602",null,"y:  2.2245602","y:  2.2245602",null,"y:  2.2245602","y:  2.2245602",null,"y:  2.2245602","y:  2.2245602",null,"y:  3.5330893","y:  3.5330893",null,"y:  3.5330893","y:  3.5330893",null,"y:  6.1259860","y:  6.1259860",null,"y:  6.1259860","y:  6.1259860"],"type":"scatter","mode":"lines","line":{"width":2.2677165354330708,"color":"rgba(0,0,0,1)","dash":"solid"},"hoveron":"points","showlegend":false,"xaxis":"x2","yaxis":"y2","hoverinfo":"text","frame":null},{"x":[14.242528005940519,0,11.682571763100793,5.9422722085074495,2.1783264218202008,0,0,1.4406984417288722,0,0.89666939280874292,0,0,6.1259859614595928,3.5330892997488754,2.2245601812493185,0,0,0,0],"y":[3.6875,1,6.375,3.625,2.5,2,3,4.75,4,5.5,5,6,9.125,8.25,7.5,7,8,9,10],"text":["y: 14.2425280","y:  0.0000000","y: 11.6825718","y:  5.9422722","y:  2.1783264","y:  0.0000000","y:  0.0000000","y:  1.4406984","y:  0.0000000","y:  0.8966694","y:  0.0000000","y:  0.0000000","y:  6.1259860","y:  3.5330893","y:  2.2245602","y:  0.0000000","y:  0.0000000","y:  0.0000000","y:  0.0000000"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"transparent","opacity":1,"size":null,"symbol":null,"line":{"width":1.8897637795275593,"color":"transparent"}},"hoveron":"points","showlegend":false,"xaxis":"x2","yaxis":"y2","hoverinfo":"text","frame":null}],"layout":{"xaxis":{"domain":[0,0.80000000000000004],"automargin":true,"type":"linear","autorange":false,"range":[0.5,10.5],"tickmode":"array","ticktext":["Hawaii","Tonga","Lau Fiji","Malekula","Tikopia","Santa Cruz","Trobriand","Manus","Chuuk","Yap"],"tickvals":[1,2,3,4,5,6,7,8,9,10],"categoryorder":"array","categoryarray":["Hawaii","Tonga","Lau Fiji","Malekula","Tikopia","Santa Cruz","Trobriand","Manus","Chuuk","Yap"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.6529680365296811,"tickwidth":0.66417600664176002,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":13.283520132835198},"tickangle":-45,"showline":true,"linecolor":"rgba(0,0,0,1)","linewidth":0.66417600664176002,"showgrid":false,"gridcolor":null,"gridwidth":0,"zeroline":false,"anchor":"y2","title":"","hoverformat":".2f"},"xaxis2":{"domain":[0.80000000000000004,1],"automargin":true,"showticklabels":false,"showgrid":false,"zeroline":false,"anchor":"y2","type":"linear","autorange":false,"range":[0,14.242528005940519],"tickmode":"array","ticktext":["0","5","10"],"tickvals":[0,5,10],"categoryorder":"array","categoryarray":["0","5","10"],"nticks":null,"ticks":"","tickcolor":null,"ticklen":3.6529680365296811,"tickwidth":0,"tickfont":{"color":null,"family":null,"size":0},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"gridcolor":null,"gridwidth":0,"title":{"text":"","font":{"color":null,"family":null,"size":0}},"hoverformat":".2f"},"yaxis2":{"domain":[0,0.80000000000000004],"automargin":true,"type":"linear","autorange":false,"range":[0.5,10.5],"tickmode":"array","ticktext":["Hawaii","Tonga","Lau Fiji","Malekula","Tikopia","Santa Cruz","Trobriand","Manus","Chuuk","Yap"],"tickvals":[1,2,3,4,5,6,7,8,9,10],"categoryorder":"array","categoryarray":["Hawaii","Tonga","Lau Fiji","Malekula","Tikopia","Santa Cruz","Trobriand","Manus","Chuuk","Yap"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.6529680365296811,"tickwidth":0.66417600664176002,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":13.283520132835205},"tickangle":-0,"showline":true,"linecolor":"rgba(0,0,0,1)","linewidth":0.66417600664176002,"showgrid":false,"gridcolor":null,"gridwidth":0,"zeroline":false,"anchor":"x","title":"","hoverformat":".2f"},"yaxis":{"domain":[0.80000000000000004,1],"automargin":true,"showticklabels":false,"showgrid":false,"zeroline":false,"anchor":"x","type":"linear","autorange":false,"range":[0,14.242528005940519],"tickmode":"array","ticktext":["0","5","10"],"tickvals":[0,5,10],"categoryorder":"array","categoryarray":["0","5","10"],"nticks":null,"ticks":"","tickcolor":null,"ticklen":3.6529680365296811,"tickwidth":0,"tickfont":{"color":null,"family":null,"size":0},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"gridcolor":null,"gridwidth":0,"title":{"text":"","font":{"color":null,"family":null,"size":0}},"hoverformat":".2f"},"annotations":[],"shapes":[{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0,"x1":0.80000000000000004,"y0":0.80000000000000004,"y1":1},{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0,"x1":0.80000000000000004,"y0":0,"y1":0.80000000000000004},{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0.80000000000000004,"x1":1,"y0":0,"y1":0.80000000000000004}],"images":[],"margin":{"t":30,"r":null,"b":79.701120797011228,"l":79.701120797011228},"font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724},"showlegend":false,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.8897637795275593,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.68949771689498},"title":{"text":"","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}},"y":1,"yanchor":"top"},"hovermode":"closest","barmode":"relative","paper_bgcolor":"rgba(255,255,255,1)","title":"Distances between Oceanic Societies in Thousands of km"},"attrs":{"3c2c2244243":{"xend":{},"yend":{},"colour":{},"linetype":{},"size":{},"x":{},"y":{},"type":"scatter"},"3c2c342176e7":{"colour":{},"shape":{},"size":{},"x":{},"y":{}},"3c2c70a13b9":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20]},"3c2c26cad39":{"x":{},"y":{},"fill":{},"text":{},"type":"heatmap"},"3c2c57661764":{"x":{},"y":{},"text":{},"customdata":{},"type":"scatter","mode":"text","textposition":"middle right","hovertemplate":"row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","showlegend":false,"textfont":{"color":["rgba(0,0,0,1)","rgba(255,255,255,1)","rgba(255,255,255,1)","rgba(255,255,255,1)","rgba(255,255,255,1)","rgba(255,255,255,1)","rgba(255,255,255,1)","rgba(255,255,255,1)","rgba(255,255,255,1)","rgba(255,255,255,1)","rgba(255,255,255,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(255,255,255,1)","rgba(255,255,255,1)","rgba(255,255,255,1)","rgba(255,255,255,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(255,255,255,1)","rgba(255,255,255,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(255,255,255,1)","rgba(255,255,255,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(255,255,255,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(255,255,255,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(255,255,255,1)","rgba(255,255,255,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(255,255,255,1)","rgba(255,255,255,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(255,255,255,1)","rgba(255,255,255,1)","rgba(255,255,255,1)","rgba(255,255,255,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)"],"size":12},"inherit":false},"3c2c39c06013":{"xend":{},"yend":{},"colour":{},"linetype":{},"size":{},"x":{},"y":{},"type":"scatter"},"3c2c50421ab2":{"colour":{},"shape":{},"size":{},"x":{},"y":{}}},"source":"A","config":{"doubleClick":"reset","modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false,"displaylogo":false,"modeBarButtonsToRemove":["sendDataToCloud","select2d","lasso2d","autoScale2d","hoverClosestCartesian","hoverCompareCartesian","sendDataToCloud"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"subplot":true,"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>And the basic map, shown as a graph, with latitude and longitude of the culture can be visualize with the <code>ggraph</code> package.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>graph14_08 <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>graph14_08 <span class="ot">&lt;-</span> <span class="fu">within</span>(graph14_08, {</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># create the graph object</span></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># the manual layout requires a special treatment when using ggraph</span></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># source for manual layout:</span></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># https://stackoverflow.com/questions/67756538/plot-ggraph-using-supplied-node-coordinates</span></span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># must add the x and y coords to the nodes for manual layout to work</span></span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>  the_nodes <span class="ot">&lt;-</span> dataKline<span class="sc">$</span>nodes_df <span class="sc">|&gt;</span></span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(culture, <span class="at">x =</span> lon2_pos, <span class="at">y =</span> lat_pos, logpop)</span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>  the_edges <span class="ot">&lt;-</span> dataKline<span class="sc">$</span>edges_df</span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a>  grf <span class="ot">&lt;-</span> <span class="fu">tbl_graph</span>(<span class="at">nodes =</span> the_nodes, <span class="at">edges =</span> the_edges, <span class="at">directed =</span> <span class="cn">FALSE</span>)</span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># we use a special layout, when the x and y have different names to avoid</span></span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># conflict. See the source on manual layout mentioned above</span></span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="fu">ggraph</span>(grf, <span class="at">layout =</span> <span class="fu">data.frame</span>(<span class="at">lx =</span> <span class="cn">NA</span>, <span class="at">ly =</span> <span class="cn">NA</span>)) <span class="sc">+</span></span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_node_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> logpop, <span class="at">size =</span> logpop)) <span class="sc">+</span></span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_node_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> culture), <span class="at">color =</span> <span class="st">"darkblue"</span>, <span class="at">size =</span> <span class="dv">4</span>, <span class="at">repel =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb57-18"><a href="#cb57-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_paletteer_c</span>(<span class="st">"pals::isol"</span>) <span class="sc">+</span></span>
<span id="cb57-19"><a href="#cb57-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb57-20"><a href="#cb57-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Relative positions of societies"</span>,</span>
<span id="cb57-21"><a href="#cb57-21" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> <span class="st">"longitude in thousands of km"</span>, <span class="at">y =</span> <span class="st">"latitude in thousands of km"</span>)</span>
<span id="cb57-22"><a href="#cb57-22" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb57-23"><a href="#cb57-23" aria-hidden="true" tabindex="-1"></a>graph14_08<span class="sc">$</span>p</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="ch14_covariances_files/figure-html/ch14_graph14_08-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="model-1" class="level4" data-number="14.5.1.2">
<h4 data-number="14.5.1.2" class="anchored" data-anchor-id="model-1"><span class="header-section-number">14.5.1.2</span> Model</h4>
<p>We use the scientific model. See section 11.2.1, p.&nbsp;356, in the Overthinking box.</p>
<p><span class="math display">\[
\begin{align*}
T_i &amp;\sim \mathcal{Poisson}(\lambda_i) \\
\lambda_i &amp;= \frac{\alpha P_i^\beta}{\gamma}
\end{align*}
\]</span></p>
<p>and since we need a varying intercept we had one in a <em>multiplicative form</em>. We could simply add it but then it could become negative.</p>
<p><span class="math display">\[
\begin{align*}
T_i &amp;\sim \mathcal{Poisson}(\lambda_i) \\
\lambda_i &amp;= \exp(k_{society}) \frac{\alpha P_i^\beta}{\gamma}
\end{align*}
\]</span> Here <span class="math inline">\(k_{society}\)</span> is the varying intercept. These intercept are part of a multivariate distribution. The multivariate intercept prior is defined as</p>
<p><span class="math display">\[
\begin{align*}
\begin{bmatrix}
k_1 \\
k_2 \\
k_3 \\
\vdots \\
k_{10}
\end{bmatrix}
&amp;\sim
\mathcal{MVNormal} \left(
\begin{bmatrix}
0 \\
0 \\
0 \\
\vdots \\
0
\end{bmatrix}
,
\bf{K}
\right) \\
\bf{K} &amp;= \eta^2 \exp(-\rho^2D_{ij}^2) + \delta_{ij}\sigma^2
\end{align*}
\]</span></p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>The rest of the section comes from <span class="citation" data-cites="kurtz2020b">Kurz (<a href="references.html#ref-kurtz2020b" role="doc-biblioref">2020</a>)</span> who did such a fantastic work at adapting the wonderful <em>rethinking</em> to <code>brms</code>. I am so grateful for the opportunity to enjoy all this.</p>
</div>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>There is a lot more details and info at <span class="citation" data-cites="kurtz2020b">Kurz (<a href="references.html#ref-kurtz2020b" role="doc-biblioref">2020</a>)</span>. Please read it to get the full picture.</p>
</div>
</div>
<p>We could have used <span class="math inline">\(D_{ij}\)</span> instead of <span class="math inline">\(D_{ij}^2\)</span> for <span class="math inline">\(\bf{K}\)</span>. <span class="math inline">\(D_{ij}^2\)</span> because of its half-Gaussian shape which is more sigmoidal in shape. As illustrated just below.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">data.frame</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">4</span>)), <span class="fu">aes</span>(<span class="at">x =</span> x)) <span class="sc">+</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_function</span>(<span class="fu">aes</span>(<span class="at">color =</span> <span class="st">"-exp(D)"</span>), <span class="at">fun =</span> <span class="cf">function</span>(x) <span class="fu">exp</span>(<span class="sc">-</span><span class="dv">1</span> <span class="sc">*</span> x), <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_function</span>(<span class="fu">aes</span>(<span class="at">color =</span> <span class="st">"-exp(D^2)"</span>), <span class="at">fun =</span> <span class="cf">function</span>(x) <span class="fu">exp</span>(<span class="sc">-</span><span class="dv">1</span> <span class="sc">*</span> x<span class="sc">^</span><span class="dv">2</span>), <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_paletteer_d</span>(<span class="st">"ggsci::alternating_igv"</span>) <span class="sc">+</span></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.8</span>, <span class="fl">0.8</span>),</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Shape of function relating distance to covariance"</span>,</span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"distance"</span>, <span class="at">y =</span> <span class="st">"correlation"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="ch14_covariances_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure 14.10</figcaption>
</figure>
</div>
</div>
</div>
<p>Therefore we have the model used by <code>rethinking</code> and the one by <code>brms</code></p>
<section id="rethinking-model" class="level5" data-number="14.5.1.2.1">
<h5 data-number="14.5.1.2.1" class="anchored" data-anchor-id="rethinking-model"><span class="header-section-number">14.5.1.2.1</span> <code>rethinking</code> model</h5>
<p><span class="math display">\[
\begin{align*}
T_i &amp;\sim \mathcal{Poisson}(\lambda_i) \\
\lambda_i &amp;= \exp(k_{society}) \frac{\alpha Population_i^\beta}{\gamma} \\
\begin{bmatrix}
k_1 \\
k_2 \\
k_3 \\
\vdots \\
k_{10}
\end{bmatrix}
&amp;\sim
\mathcal{MVNormal}\left(
\begin{bmatrix}
0 \\
0 \\
0 \\
\vdots \\
0
\end{bmatrix}
,
\bf{K}
\right) \\
\bf{K} &amp;= \eta^2 \exp(-\rho^2Distance_{ij}^2) + \delta_{ij}\sigma^2 \\
\delta_{ij} &amp;= 0 \implies \delta_{ij}\sigma^2 = 0 \; \text{because only 1 observation per island} \\
\alpha, \beta, \gamma &amp;\sim \mathcal{Exponential}(1) \\
\eta^2 &amp;\sim \mathcal{Exponential}(2) \\
\rho^2 &amp;\sim \mathcal{Exponential}(0.5)
\end{align*}
\]</span> ##### <code>brms</code> model</p>
<p><span class="math display">\[
\begin{align*}
T_i &amp;\sim \mathcal{Poisson}(\lambda_i) \\
\lambda_i &amp;= \exp(k_{society}) \frac{\alpha Population_i^\beta}{\gamma} \\
\begin{bmatrix}
k_1 \\
k_2 \\
k_3 \\
\vdots \\
k_{10}
\end{bmatrix}
&amp;\sim
\mathcal{MVNormal} \left(
\begin{bmatrix}
0 \\
0 \\
0 \\
\vdots \\
0
\end{bmatrix}
,
\bf{K}
\right) \\
\bf{K_{ij}} &amp;= sdgp^2 \exp \left(\frac{-Distance_{ij}^2}{2 \cdot lscale^2} \right) \\
\alpha &amp;\sim \mathcal{N}(0, 1) \\
\beta, \gamma &amp;\sim \mathcal{Exponential}(1) \\
sgdp^2 &amp;\sim \mathcal{Exponential}(1) \\
lscale^2 &amp;\sim \mathcal{InvGammal}(2.874624, 2.941204)
\end{align*}
\]</span></p>
</section>
</section>
<section id="fit" class="level4" data-number="14.5.1.3">
<h4 data-number="14.5.1.3" class="anchored" data-anchor-id="fit"><span class="header-section-number">14.5.1.3</span> Fit</h4>
<p>Since our model is non-linear (scientific formula) then the fit with <code>brms</code> uses the non-linear form.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>tictoc<span class="sc">::</span><span class="fu">tic</span>(<span class="at">msg =</span> <span class="fu">sprintf</span>(<span class="st">"run time of %s, use the cache."</span>, <span class="st">"90 secs."</span>))</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>fit14_08 <span class="ot">&lt;-</span> xfun<span class="sc">::</span><span class="fu">cache_rds</span>({</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> dataKline<span class="sc">$</span>nodes_df,</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> <span class="fu">poisson</span>(<span class="at">link =</span> <span class="st">"identity"</span>),</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">formula =</span>  <span class="fu">bf</span>(total_tools <span class="sc">~</span> <span class="fu">exp</span>(a) <span class="sc">*</span> population<span class="sc">^</span>b <span class="sc">/</span> g,</span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>                  a <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> <span class="fu">gp</span>(lat_pos, lon2_pos, <span class="at">scale =</span> <span class="cn">FALSE</span>),</span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>                  b <span class="sc">+</span> g <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>                  <span class="at">nl =</span> <span class="cn">TRUE</span>),</span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">prior =</span> <span class="fu">c</span>(</span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">nlpar =</span> a),</span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a>      <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">nlpar =</span> b, <span class="at">lb =</span> <span class="dv">0</span>),</span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a>      <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">nlpar =</span> g, <span class="at">lb =</span> <span class="dv">0</span>),</span>
<span id="cb59-14"><a href="#cb59-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">prior</span>(<span class="fu">inv_gamma</span>(<span class="fl">2.874624</span>, <span class="fl">2.941204</span>), <span class="at">class =</span> lscale, <span class="at">coef =</span> gplat_poslon2_pos, <span class="at">nlpar =</span> a),</span>
<span id="cb59-15"><a href="#cb59-15" aria-hidden="true" tabindex="-1"></a>      <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sdgp, <span class="at">coef =</span> gplat_poslon2_pos, <span class="at">nlpar =</span> a)),</span>
<span id="cb59-16"><a href="#cb59-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">2</span>,</span>
<span id="cb59-17"><a href="#cb59-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">sample_prior =</span> <span class="cn">TRUE</span>,</span>
<span id="cb59-18"><a href="#cb59-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">cores =</span> <span class="fu">detectCores</span>(), <span class="at">seed =</span> <span class="dv">1433</span>)},</span>
<span id="cb59-19"><a href="#cb59-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">"ch14_fit14_08"</span>, <span class="at">rerun =</span> <span class="cn">FALSE</span>)</span>
<span id="cb59-20"><a href="#cb59-20" aria-hidden="true" tabindex="-1"></a>tictoc<span class="sc">::</span><span class="fu">toc</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>run time of 90 secs., use the cache.: 0.18 sec elapsed</code></pre>
</div>
</div>
<p>which gives the results</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>fit14_08</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Family: poisson 
  Links: mu = identity 
Formula: total_tools ~ exp(a) * population^b/g 
         a ~ 1 + gp(lat_pos, lon2_pos, scale = FALSE)
         b ~ 1
         g ~ 1
   Data: dataKline$nodes_df (Number of observations: 10) 
  Draws: 2 chains, each with iter = 2000; warmup = 1000; thin = 1;
         total post-warmup draws = 2000

Gaussian Process Terms: 
                            Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS
sdgp(a_gplat_poslon2_pos)       0.50      0.34     0.14     1.42 1.00      628
lscale(a_gplat_poslon2_pos)     1.69      0.98     0.51     4.29 1.00      643
                            Tail_ESS
sdgp(a_gplat_poslon2_pos)       1169
lscale(a_gplat_poslon2_pos)     1068

Population-Level Effects: 
            Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
a_Intercept     0.37      0.85    -1.32     1.95 1.00     1418     1418
b_Intercept     0.25      0.09     0.07     0.43 1.00      761      446
g_Intercept     0.65      0.62     0.06     2.34 1.00     1103      946

Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
</div>
<p>and to have a summary similar to McElreath on p.&nbsp;472 we can use</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>fit14_08 <span class="sc">|&gt;</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize_draws</span>(<span class="st">"mean"</span>, <span class="st">"sd"</span>, <span class="sc">~</span><span class="fu">quantile</span>(.x, <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.055</span>, <span class="fl">0.945</span>)),</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">default_convergence_measures</span>()) <span class="sc">|&gt;</span></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"^lp"</span>, <span class="at">x =</span> variable)) <span class="sc">|&gt;</span></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="at">.cols =</span> <span class="fu">where</span>(is.numeric), <span class="at">.fns =</span> round, <span class="at">digits =</span> <span class="dv">2</span>),</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>         <span class="fu">across</span>(<span class="at">.cols =</span> <span class="fu">starts_with</span>(<span class="st">"ess"</span>), <span class="at">.fns =</span> as.integer))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 20 × 8
   variable                    mean    sd `5.5%` `94.5%`  rhat ess_bulk ess_tail
   &lt;chr&gt;                      &lt;num&gt; &lt;num&gt;  &lt;num&gt;   &lt;num&gt; &lt;num&gt;    &lt;num&gt;    &lt;num&gt;
 1 b_a_Intercept               0.37  0.85  -1.02    1.68     1     1417     1417
 2 b_b_Intercept               0.25  0.09   0.11    0.38     1      761      445
 3 b_g_Intercept               0.65  0.62   0.09    1.78     1     1102      946
 4 sdgp_a_gplat_poslon2_pos    0.5   0.34   0.18    1.09     1      627     1169
 5 lscale_a_gplat_poslon2_pos  1.69  0.98   0.64    3.52     1      642     1068
 6 zgp_a_gplat_poslon2_pos[1] -0.47  0.75  -1.7     0.66     1     1131     1397
 7 zgp_a_gplat_poslon2_pos[2]  0.44  0.87  -0.99    1.8      1     1521     1190
 8 zgp_a_gplat_poslon2_pos[3] -0.62  0.7   -1.65    0.55     1     1335     1371
 9 zgp_a_gplat_poslon2_pos[4]  0.97  0.68  -0.06    2.1      1     1013     1140
10 zgp_a_gplat_poslon2_pos[5]  0.24  0.76  -0.91    1.43     1     1366     1307
11 zgp_a_gplat_poslon2_pos[6] -1.03  0.79  -2.25    0.27     1     1079      987
12 zgp_a_gplat_poslon2_pos[7]  0.15  0.68  -0.97    1.2      1     1594     1179
13 zgp_a_gplat_poslon2_pos[8] -0.18  0.87  -1.6     1.21     1     2175     1102
14 zgp_a_gplat_poslon2_pos[9]  0.4   0.92  -1.12    1.81     1     1676     1228
15 zgp_a_gplat_poslon2_pos[1… -0.36  0.81  -1.71    0.87     1     1171     1299
16 prior_b_a                  -0.01  1.01  -1.62    1.58     1     1943     1719
17 prior_sdgp_a_gplat_poslon…  0.98  0.97   0.06    2.85     1     1737     1789
18 prior_lscale_a__1_gplat_p…  1.51  1.31   0.49    3.59     1     2190     2046
19 prior_b_b                   1.01  1.05   0.06    2.95     1     1955     1906
20 prior_b_g                   1     1.02   0.06    2.96     1     1653     2050</code></pre>
</div>
</div>
<p>or with <code>posterior_summary</code> which is simpler but lacks de ESS</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_summary</span>(fit14_08) <span class="sc">|&gt;</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                    Estimate Est.Error   Q2.5  Q97.5
b_a_Intercept                           0.37      0.85  -1.32   1.95
b_b_Intercept                           0.25      0.09   0.07   0.43
b_g_Intercept                           0.65      0.62   0.06   2.34
sdgp_a_gplat_poslon2_pos                0.50      0.34   0.14   1.42
lscale_a_gplat_poslon2_pos              1.69      0.98   0.51   4.29
zgp_a_gplat_poslon2_pos[1]             -0.47      0.75  -1.99   0.98
zgp_a_gplat_poslon2_pos[2]              0.44      0.87  -1.32   2.13
zgp_a_gplat_poslon2_pos[3]             -0.62      0.70  -1.90   0.94
zgp_a_gplat_poslon2_pos[4]              0.97      0.68  -0.28   2.39
zgp_a_gplat_poslon2_pos[5]              0.24      0.76  -1.27   1.77
zgp_a_gplat_poslon2_pos[6]             -1.03      0.79  -2.55   0.59
zgp_a_gplat_poslon2_pos[7]              0.15      0.68  -1.27   1.47
zgp_a_gplat_poslon2_pos[8]             -0.18      0.87  -1.92   1.55
zgp_a_gplat_poslon2_pos[9]              0.40      0.92  -1.54   2.17
zgp_a_gplat_poslon2_pos[10]            -0.36      0.81  -1.99   1.20
prior_b_a                              -0.01      1.01  -1.97   1.87
prior_sdgp_a_gplat_poslon2_pos          0.98      0.97   0.03   3.68
prior_lscale_a__1_gplat_poslon2_pos     1.51      1.31   0.40   5.09
prior_b_b                               1.01      1.05   0.02   3.91
prior_b_g                               1.00      1.02   0.02   3.73
lprior                                 -4.02      1.57  -7.77  -2.02
lp__                                  -51.68      3.42 -59.55 -46.03</code></pre>
</div>
</div>
</section>
<section id="analysis" class="level4" data-number="14.5.1.4">
<h4 data-number="14.5.1.4" class="anchored" data-anchor-id="analysis"><span class="header-section-number">14.5.1.4</span> Analysis</h4>
<p>The differences with <code>rethinking</code> are because <code>brms</code> uses non-centering. The coefficient that is really different is the <span class="math inline">\(\alpha\)</span> in <span class="math inline">\(\lambda_i = \exp(k_{society}) \frac{\alpha P_i^\beta}{\gamma}\)</span>.</p>
<p>To evaluate the differences between <code>brms</code> and <code>rethinking</code> we can look at what the posterior would be like, without taking into account the covariances.</p>
<p>For <code>brms</code> we have</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>pop <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="fu">c</span>(<span class="fu">min</span>(dataKline<span class="sc">$</span>nodes_df<span class="sc">$</span>population),</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>             <span class="fu">median</span>(dataKline<span class="sc">$</span>nodes_df<span class="sc">$</span>population),</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>             <span class="fu">max</span>(dataKline<span class="sc">$</span>nodes_df<span class="sc">$</span>population)))</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>tools <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="fu">c</span>(<span class="fu">min</span>(dataKline<span class="sc">$</span>nodes_df<span class="sc">$</span>total_tools),</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>               <span class="fu">mean</span>(dataKline<span class="sc">$</span>nodes_df<span class="sc">$</span>total_tools),</span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>               <span class="fu">max</span>(dataKline<span class="sc">$</span>nodes_df<span class="sc">$</span>total_tools)))</span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">fixef</span>(fit14_08)[<span class="st">"a_Intercept"</span>, <span class="st">"Estimate"</span>]</span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="fu">fixef</span>(fit14_08)[<span class="st">"b_Intercept"</span>, <span class="st">"Estimate"</span>]</span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a>g <span class="ot">&lt;-</span> <span class="fu">fixef</span>(fit14_08)[<span class="st">"g_Intercept"</span>, <span class="st">"Estimate"</span>]</span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a><span class="co"># brms uses a different equation for lambda</span></span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a>l <span class="ot">&lt;-</span> <span class="fu">exp</span>(a) <span class="sc">*</span> pop <span class="sc">^</span> b <span class="sc">/</span> g</span>
<span id="cb67-12"><a href="#cb67-12" aria-hidden="true" tabindex="-1"></a>prob_brms <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">dpois</span>(<span class="at">x =</span> tools, <span class="at">lambda =</span> l), <span class="dv">4</span>)</span>
<span id="cb67-13"><a href="#cb67-13" aria-hidden="true" tabindex="-1"></a>prob_brms</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.1099 0.0028 0.0027</code></pre>
</div>
</div>
<p>as opposed to `rehinking`` which would give</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fl">1.41</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="fl">0.28</span></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>g <span class="ot">&lt;-</span> <span class="fl">0.60</span></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a><span class="co"># rethinking uses a different equation for lambda</span></span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>l <span class="ot">&lt;-</span> a <span class="sc">*</span> pop <span class="sc">^</span> b <span class="sc">/</span> g</span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>prob_rethink <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">dpois</span>(<span class="at">x =</span> tools, <span class="at">lambda =</span> l), <span class="dv">4</span>)</span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>prob_rethink</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.0706 0.0437 0.0331</code></pre>
</div>
</div>
<p>The results between the 2 are different and cannot really be compared because</p>
<ul>
<li>correlations between <span class="math inline">\(D\)</span> in <code>rethinking</code> and <span class="math inline">\(D^2\)</span> in <code>brms</code> is not the same and</li>
<li><code>brms</code> has a very different way of computing the likelihood</li>
</ul>
<p>Basically, <code>rethinking</code> uses the following definition of <span class="math inline">\(\bf{K_{ij}}\)</span></p>
<p><span class="math display">\[
\bf{K_{ij}} = \eta^2 \exp \left(-\rho^2D_{ij}^2 \right) + \delta_{ij}\sigma^2
\]</span></p>
<p>where the term <span class="math inline">\(\delta_{ij}\sigma^2\)</span> is used when <span class="math inline">\(i=j\)</span>, see p.&nbsp;470 of <span class="citation" data-cites="elreath2020">McElreath (<a href="references.html#ref-elreath2020" role="doc-biblioref">2020</a>)</span>. In the oceanic case it is not applicable since we have only one observation per society. Therefore the equation is this case is</p>
<p><span class="math display">\[
\bf{K_{ij}} = \eta^2 \exp \left(-\rho^2D_{ij}^2 \right)
\]</span></p>
<p>whereas <code>brms</code> uses</p>
<p><span class="math display">\[
\bf{K_{ij}} = sdgp^2 \exp \left(\frac{-D_{ij}^2}{2 \cdot lscale^2} \right)
\]</span></p>
<p>and so the 2 equations can be compared as follows</p>
<p><span class="math display">\[
\begin{align*}
\eta^2 &amp;= sdgp^2 \\
-\rho^2 &amp;= \frac{1}{2 \cdot lscale^2}
\end{align*}
\]</span></p>
<p>and we note that the distance used can always be found as follows</p>
<p><span class="math display">\[
\begin{align*}
\bf{K_{ij}} &amp;= sdgp^2 \exp \left(\frac{-D_{ij}^2}{2 \cdot lscale^2} \right) \\
\log \left( \bf{K_{ij}} \right) &amp;= \log \left(sdgp^2 \right) + \frac{-D_{ij}^2}{2 \cdot lscale^2} \\
D_{ij}^2 &amp;= 2 \cdot lscale^2 \cdot \left[ \log \left(sdgp^2 \right) - \log \left( \bf{K_{ij}} \right) \right]
\end{align*}
\]</span></p>
<p>and therefore we can figure out the covariance and convert the coefficients between <code>brms</code> and `rethinking``,</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>post14_08 <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>post14_08 <span class="ot">&lt;-</span> <span class="fu">within</span>(post14_08, {</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># function to compute eta squared as per rethinking</span></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>  rethink_eta2 <span class="ot">&lt;-</span> <span class="cf">function</span>(sdgp) {</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>    sdgp<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># function to compute rho squared as per rethinking</span></span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>  rethink_rho2 <span class="ot">&lt;-</span> <span class="cf">function</span>(lscale) {</span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a>    <span class="sc">-</span><span class="dv">1</span> <span class="sc">/</span> (<span class="dv">2</span> <span class="sc">*</span> lscale<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb71-11"><a href="#cb71-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># function to calculate the covariance as per brms</span></span>
<span id="cb71-12"><a href="#cb71-12" aria-hidden="true" tabindex="-1"></a>  brms_cov <span class="ot">&lt;-</span> <span class="cf">function</span>(x, sdgp, lscale) {</span>
<span id="cb71-13"><a href="#cb71-13" aria-hidden="true" tabindex="-1"></a>    sdgp<span class="sc">^</span><span class="dv">2</span> <span class="sc">*</span> <span class="fu">exp</span>(<span class="sc">-</span>(x<span class="sc">^</span><span class="dv">2</span>) <span class="sc">/</span> <span class="dv">2</span> <span class="sc">*</span> lscale<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb71-14"><a href="#cb71-14" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb71-15"><a href="#cb71-15" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>and we transform the posterior data to be able to plot as shown in figure 14.11 on p.&nbsp;473</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>post14_08 <span class="ot">&lt;-</span> <span class="fu">within</span>(post14_08, {</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>  post <span class="ot">&lt;-</span> <span class="fu">tidy_draws</span>(fit14_08)</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># the median of the parameters is used later</span></span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>  stats <span class="ot">&lt;-</span> post <span class="sc">|&gt;</span></span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(prior_sdgp_a_gplat_poslon2_pos,</span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a>           sdgp_a_gplat_poslon2_pos,</span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a>           prior_lscale_a__1_gplat_poslon2_pos,</span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a>           lscale_a_gplat_poslon2_pos) <span class="sc">|&gt;</span></span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">median_qi</span>(<span class="at">.width =</span> <span class="fl">0.89</span>)</span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb72-13"><a href="#cb72-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">1433</span>)</span>
<span id="cb72-14"><a href="#cb72-14" aria-hidden="true" tabindex="-1"></a>  sampl <span class="ot">&lt;-</span> post <span class="sc">|&gt;</span></span>
<span id="cb72-15"><a href="#cb72-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(.draw,</span>
<span id="cb72-16"><a href="#cb72-16" aria-hidden="true" tabindex="-1"></a>           prior_sdgp_a_gplat_poslon2_pos,</span>
<span id="cb72-17"><a href="#cb72-17" aria-hidden="true" tabindex="-1"></a>           sdgp_a_gplat_poslon2_pos,</span>
<span id="cb72-18"><a href="#cb72-18" aria-hidden="true" tabindex="-1"></a>           prior_lscale_a__1_gplat_poslon2_pos,</span>
<span id="cb72-19"><a href="#cb72-19" aria-hidden="true" tabindex="-1"></a>           lscale_a_gplat_poslon2_pos) <span class="sc">|&gt;</span></span>
<span id="cb72-20"><a href="#cb72-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">prior_eta2 =</span> <span class="fu">rethink_eta2</span>(prior_sdgp_a_gplat_poslon2_pos),</span>
<span id="cb72-21"><a href="#cb72-21" aria-hidden="true" tabindex="-1"></a>           <span class="at">eta2 =</span> <span class="fu">rethink_eta2</span>(sdgp_a_gplat_poslon2_pos),</span>
<span id="cb72-22"><a href="#cb72-22" aria-hidden="true" tabindex="-1"></a>           <span class="at">prior_rho2 =</span> <span class="fu">rethink_rho2</span>(prior_lscale_a__1_gplat_poslon2_pos ),</span>
<span id="cb72-23"><a href="#cb72-23" aria-hidden="true" tabindex="-1"></a>           <span class="at">rho2 =</span> <span class="fu">rethink_rho2</span>(lscale_a_gplat_poslon2_pos)) <span class="sc">|&gt;</span></span>
<span id="cb72-24"><a href="#cb72-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">slice_sample</span>(<span class="at">n =</span> <span class="dv">50</span>) <span class="sc">|&gt;</span></span>
<span id="cb72-25"><a href="#cb72-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">expand_grid</span>(<span class="at">dist =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">10</span>, <span class="at">by =</span> <span class="fl">0.05</span>)) <span class="sc">|&gt;</span></span>
<span id="cb72-26"><a href="#cb72-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">prior_cov =</span> <span class="fu">brms_cov</span>(<span class="at">x =</span> dist,</span>
<span id="cb72-27"><a href="#cb72-27" aria-hidden="true" tabindex="-1"></a>                                <span class="at">sdgp =</span> prior_sdgp_a_gplat_poslon2_pos,</span>
<span id="cb72-28"><a href="#cb72-28" aria-hidden="true" tabindex="-1"></a>                                <span class="at">lscale =</span> prior_lscale_a__1_gplat_poslon2_pos),</span>
<span id="cb72-29"><a href="#cb72-29" aria-hidden="true" tabindex="-1"></a>           <span class="at">cov =</span> <span class="fu">brms_cov</span>(<span class="at">x =</span> dist,</span>
<span id="cb72-30"><a href="#cb72-30" aria-hidden="true" tabindex="-1"></a>                          <span class="at">sdgp =</span> sdgp_a_gplat_poslon2_pos,</span>
<span id="cb72-31"><a href="#cb72-31" aria-hidden="true" tabindex="-1"></a>                          <span class="at">lscale =</span> lscale_a_gplat_poslon2_pos))</span>
<span id="cb72-32"><a href="#cb72-32" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb72-33"><a href="#cb72-33" aria-hidden="true" tabindex="-1"></a><span class="co"># glimpse(post14_08$stats)</span></span>
<span id="cb72-34"><a href="#cb72-34" aria-hidden="true" tabindex="-1"></a><span class="co"># glimpse(post14_08$sampl)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>plot14_08 <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>plot14_08 <span class="ot">&lt;-</span> <span class="fu">within</span>(plot14_08, {</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>  prior <span class="ot">&lt;-</span> post14_08<span class="sc">$</span>sampl <span class="sc">|&gt;</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> dist, <span class="at">y =</span> prior_cov)) <span class="sc">+</span></span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> .draw, <span class="at">color =</span> .draw)) <span class="sc">+</span></span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stat_function</span>(</span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">fun =</span> <span class="cf">function</span>(x) {</span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a>        post14_08<span class="sc">$</span><span class="fu">brms_cov</span>(<span class="at">x =</span> <span class="fu">median</span>(post14_08<span class="sc">$</span>sampl<span class="sc">$</span>dist),</span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a>                           <span class="at">sdgp =</span> post14_08<span class="sc">$</span>stats<span class="sc">$</span>prior_sdgp_a_gplat_poslon2_pos,</span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a>                          <span class="at">lscale =</span> post14_08<span class="sc">$</span>stats<span class="sc">$</span>prior_lscale_a__1_gplat_poslon2_pos)},</span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> <span class="st">"firebrick"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb73-11"><a href="#cb73-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> scales<span class="sc">::</span><span class="fu">breaks_width</span>(<span class="at">width =</span> <span class="dv">2</span>),</span>
<span id="cb73-12"><a href="#cb73-12" aria-hidden="true" tabindex="-1"></a>                       <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_number_auto</span>()) <span class="sc">+</span></span>
<span id="cb73-13"><a href="#cb73-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_paletteer_c</span>(<span class="st">"pals::ocean.speed"</span>) <span class="sc">+</span></span>
<span id="cb73-14"><a href="#cb73-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb73-15"><a href="#cb73-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb73-16"><a href="#cb73-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Gaussian process prior"</span>,</span>
<span id="cb73-17"><a href="#cb73-17" aria-hidden="true" tabindex="-1"></a>         <span class="at">subtitle =</span> <span class="st">"Red line is the median of the covariances"</span>,</span>
<span id="cb73-18"><a href="#cb73-18" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> <span class="st">"distance in thousands of km"</span>,</span>
<span id="cb73-19"><a href="#cb73-19" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="st">"covariance"</span>)</span>
<span id="cb73-20"><a href="#cb73-20" aria-hidden="true" tabindex="-1"></a>  post <span class="ot">&lt;-</span> post14_08<span class="sc">$</span>sampl <span class="sc">|&gt;</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> dist, <span class="at">y =</span> cov)) <span class="sc">+</span></span>
<span id="cb73-21"><a href="#cb73-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> .draw, <span class="at">color =</span> .draw)) <span class="sc">+</span></span>
<span id="cb73-22"><a href="#cb73-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stat_function</span>(</span>
<span id="cb73-23"><a href="#cb73-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">fun =</span> <span class="cf">function</span>(x) {</span>
<span id="cb73-24"><a href="#cb73-24" aria-hidden="true" tabindex="-1"></a>        post14_08<span class="sc">$</span><span class="fu">brms_cov</span>(<span class="at">x =</span> <span class="fu">median</span>(post14_08<span class="sc">$</span>sampl<span class="sc">$</span>dist),</span>
<span id="cb73-25"><a href="#cb73-25" aria-hidden="true" tabindex="-1"></a>                           <span class="at">sdgp =</span> <span class="fu">mean</span>(post14_08<span class="sc">$</span>stats<span class="sc">$</span>sdgp_a_gplat_poslon2_pos),</span>
<span id="cb73-26"><a href="#cb73-26" aria-hidden="true" tabindex="-1"></a>                          <span class="at">lscale =</span> <span class="fu">mean</span>(post14_08<span class="sc">$</span>stats<span class="sc">$</span>lscale_a_gplat_poslon2_pos))},</span>
<span id="cb73-27"><a href="#cb73-27" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> <span class="st">"firebrick"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb73-28"><a href="#cb73-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> scales<span class="sc">::</span><span class="fu">breaks_width</span>(<span class="at">width =</span> <span class="dv">2</span>),</span>
<span id="cb73-29"><a href="#cb73-29" aria-hidden="true" tabindex="-1"></a>                       <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_number_auto</span>()) <span class="sc">+</span></span>
<span id="cb73-30"><a href="#cb73-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_paletteer_c</span>(<span class="st">"pals::ocean.speed"</span>) <span class="sc">+</span></span>
<span id="cb73-31"><a href="#cb73-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb73-32"><a href="#cb73-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb73-33"><a href="#cb73-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Gaussian process posterior"</span>,</span>
<span id="cb73-34"><a href="#cb73-34" aria-hidden="true" tabindex="-1"></a>         <span class="at">subtitle =</span> <span class="st">"Red line is the median of the covariances"</span>,</span>
<span id="cb73-35"><a href="#cb73-35" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> <span class="st">"distance in thousands of km"</span>,</span>
<span id="cb73-36"><a href="#cb73-36" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="st">"covariance"</span>)</span>
<span id="cb73-37"><a href="#cb73-37" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb73-38"><a href="#cb73-38" aria-hidden="true" tabindex="-1"></a><span class="fu">wrap_plots</span>(plot14_08[<span class="fu">c</span>(<span class="st">"prior"</span>, <span class="st">"post"</span>)]) <span class="sc">+</span></span>
<span id="cb73-39"><a href="#cb73-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(<span class="at">title =</span> <span class="st">"Oceanic Gaussian Process"</span>) <span class="sc">&amp;</span></span>
<span id="cb73-40"><a href="#cb73-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">title =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"darkblue"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="ch14_covariances_files/figure-html/ch14_plot14_08-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure 14.11</figcaption>
</figure>
</div>
</div>
</div>
<p>and to get the matrix of median covariance we simply map the calculation of covariance using the median values of the parameters</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>post14_08 <span class="ot">&lt;-</span> <span class="fu">within</span>(post14_08, {</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># the covariance matrix using the median of the parameters</span></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># i.e. the median covariance</span></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># The covariance is calculated based on the distance</span></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>  cov <span class="ot">&lt;-</span> post14_08<span class="sc">$</span><span class="fu">brms_cov</span>(</span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> dataKline<span class="sc">$</span>dist,</span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">sdgp =</span> post14_08<span class="sc">$</span>stats<span class="sc">$</span>sdgp_a_gplat_poslon2_pos,</span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">lscale =</span> post14_08<span class="sc">$</span>stats<span class="sc">$</span>lscale_a_gplat_poslon2_pos)</span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># the correlation matrix</span></span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a>  cor <span class="ot">&lt;-</span> <span class="fu">cov2cor</span>(cov) <span class="sc">|&gt;</span></span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">2</span>)</span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb74-13"><a href="#cb74-13" aria-hidden="true" tabindex="-1"></a><span class="co"># post14_08$cor</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>which we can illustrate with a heatmap</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>heatmaply<span class="sc">::</span><span class="fu">heatmaply_cor</span>(</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> post14_08<span class="sc">$</span>cor,</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">cellnote =</span> post14_08<span class="sc">$</span>cor,</span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">colors =</span> <span class="fu">unclass</span>(paletteer<span class="sc">::</span><span class="fu">paletteer_c</span>(<span class="st">"pals::ocean.tempo"</span>, <span class="at">n =</span> <span class="dv">16</span>)),</span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">hide_colorbar =</span> <span class="cn">TRUE</span>,</span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">main =</span> <span class="st">"Correlations between Oceanic Societies in Thousands of km"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-941dedb1c69703414464" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-941dedb1c69703414464">{"x":{"data":[{"x":[4.28125,2.25,null,2.25,2.25,null,2.25,1.5,null,1.5,1.5,null,1.5,1,null,1,1,null,1.5,2,null,2,2,null,2.25,3,null,3,3,null,4.28125,6.3125,null,6.3125,6.3125,null,6.3125,4.5,null,4.5,4.5,null,4.5,4,null,4,4,null,4.5,5,null,5,5,null,6.3125,8.125,null,8.125,8.125,null,8.125,6.75,null,6.75,6.75,null,6.75,6,null,6,6,null,6.75,7.5,null,7.5,7.5,null,7.5,7,null,7,7,null,7.5,8,null,8,8,null,8.125,9.5,null,9.5,9.5,null,9.5,9,null,9,9,null,9.5,10,null,10,10],"y":[1.9326406805197907,1.9326406805197907,null,1.9326406805197907,0.51009802979427399,null,0.51009802979427399,0.51009802979427399,null,0.51009802979427399,0.23086792761230387,null,0.23086792761230387,0.23086792761230387,null,0.23086792761230387,0,null,0.23086792761230387,0.23086792761230387,null,0.23086792761230387,0,null,0.51009802979427399,0.51009802979427399,null,0.51009802979427399,0,null,1.9326406805197907,1.9326406805197907,null,1.9326406805197907,1.6272369219016634,null,1.6272369219016634,1.6272369219016634,null,1.6272369219016634,0.70064256222413435,null,0.70064256222413435,0.70064256222413435,null,0.70064256222413435,0,null,0.70064256222413435,0.70064256222413435,null,0.70064256222413435,0,null,1.6272369219016634,1.6272369219016634,null,1.6272369219016634,1.5066187308008618,null,1.5066187308008618,1.5066187308008618,null,1.5066187308008618,1.4322709240922264,null,1.4322709240922264,1.4322709240922264,null,1.4322709240922264,0,null,1.4322709240922264,1.4322709240922264,null,1.4322709240922264,1.3089308614285173,null,1.3089308614285173,1.3089308614285173,null,1.3089308614285173,0,null,1.3089308614285173,1.3089308614285173,null,1.3089308614285173,0,null,1.5066187308008618,1.5066187308008618,null,1.5066187308008618,0.77575769412877893,null,0.77575769412877893,0.77575769412877893,null,0.77575769412877893,0,null,0.77575769412877893,0.77575769412877893,null,0.77575769412877893,0],"text":["y: 1.9326407","y: 1.9326407",null,"y: 1.9326407","y: 1.9326407",null,"y: 0.5100980","y: 0.5100980",null,"y: 0.5100980","y: 0.5100980",null,"y: 0.2308679","y: 0.2308679",null,"y: 0.2308679","y: 0.2308679",null,"y: 0.2308679","y: 0.2308679",null,"y: 0.2308679","y: 0.2308679",null,"y: 0.5100980","y: 0.5100980",null,"y: 0.5100980","y: 0.5100980",null,"y: 1.9326407","y: 1.9326407",null,"y: 1.9326407","y: 1.9326407",null,"y: 1.6272369","y: 1.6272369",null,"y: 1.6272369","y: 1.6272369",null,"y: 0.7006426","y: 0.7006426",null,"y: 0.7006426","y: 0.7006426",null,"y: 0.7006426","y: 0.7006426",null,"y: 0.7006426","y: 0.7006426",null,"y: 1.6272369","y: 1.6272369",null,"y: 1.6272369","y: 1.6272369",null,"y: 1.5066187","y: 1.5066187",null,"y: 1.5066187","y: 1.5066187",null,"y: 1.4322709","y: 1.4322709",null,"y: 1.4322709","y: 1.4322709",null,"y: 1.4322709","y: 1.4322709",null,"y: 1.4322709","y: 1.4322709",null,"y: 1.3089309","y: 1.3089309",null,"y: 1.3089309","y: 1.3089309",null,"y: 1.3089309","y: 1.3089309",null,"y: 1.3089309","y: 1.3089309",null,"y: 1.5066187","y: 1.5066187",null,"y: 1.5066187","y: 1.5066187",null,"y: 0.7757577","y: 0.7757577",null,"y: 0.7757577","y: 0.7757577",null,"y: 0.7757577","y: 0.7757577",null,"y: 0.7757577","y: 0.7757577"],"type":"scatter","mode":"lines","line":{"width":2.2677165354330708,"color":"rgba(0,0,0,1)","dash":"solid"},"hoveron":"points","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[4.28125,2.25,1.5,1,2,3,6.3125,4.5,4,5,8.125,6.75,6,7.5,7,8,9.5,9,10],"y":[1.9326406805197907,0.51009802979427399,0.23086792761230387,0,0,0,1.6272369219016634,0.70064256222413435,0,0,1.5066187308008618,1.4322709240922264,0,1.3089308614285173,0,0,0.77575769412877893,0,0],"text":["y: 1.9326407","y: 0.5100980","y: 0.2308679","y: 0.0000000","y: 0.0000000","y: 0.0000000","y: 1.6272369","y: 0.7006426","y: 0.0000000","y: 0.0000000","y: 1.5066187","y: 1.4322709","y: 0.0000000","y: 1.3089309","y: 0.0000000","y: 0.0000000","y: 0.7757577","y: 0.0000000","y: 0.0000000"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"transparent","opacity":1,"size":null,"symbol":null,"line":{"width":1.8897637795275593,"color":"transparent"}},"hoveron":"points","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"type":"scatter","mode":"markers","marker":{"color":"rgba(44,160,44,1)","line":{"color":"rgba(44,160,44,1)"}},"error_y":{"color":"rgba(44,160,44,1)"},"error_x":{"color":"rgba(44,160,44,1)"},"line":{"color":"rgba(44,160,44,1)"},"xaxis":"x2","yaxis":"y","frame":null},{"x":[1,2,3,4,5,6,7,8,9,10],"y":[1,2,3,4,5,6,7,8,9,10],"z":[[1,0.90000000000000002,0.66000000000000003,0.080000000000000002,0,0,0,0,0,0.050000000000000003],[0.90000000000000002,1,0.79000000000000004,0.20000000000000001,0.02,0,0,0,0,0.01],[0.66000000000000003,0.79000000000000004,1,0.20000000000000001,0.029999999999999999,0,0,0,0,0.01],[0.080000000000000002,0.20000000000000001,0.20000000000000001,1,0.54000000000000004,0,0,0,0,0],[0,0.02,0.029999999999999999,0.54000000000000004,1,0,0,0,0,0],[0,0,0,0,0,1,0,0,0,0],[0,0,0,0,0,0,1,0.080000000000000002,0.070000000000000007,0],[0,0,0,0,0,0,0.080000000000000002,1,0.20999999999999999,0.029999999999999999],[0,0,0,0,0,0,0.070000000000000007,0.20999999999999999,1,0.46999999999999997],[0.050000000000000003,0.01,0.01,0,0,0,0,0.029999999999999999,0.46999999999999997,1]],"text":[["row: Santa Cruz<br>column: Santa Cruz<br>value: 1.00","row: Santa Cruz<br>column: Tikopia<br>value: 0.90","row: Santa Cruz<br>column: Malekula<br>value: 0.66","row: Santa Cruz<br>column: Lau Fiji<br>value: 0.08","row: Santa Cruz<br>column: Tonga<br>value: 0.00","row: Santa Cruz<br>column: Hawaii<br>value: 0.00","row: Santa Cruz<br>column: Yap<br>value: 0.00","row: Santa Cruz<br>column: Chuuk<br>value: 0.00","row: Santa Cruz<br>column: Manus<br>value: 0.00","row: Santa Cruz<br>column: Trobriand<br>value: 0.05"],["row: Tikopia<br>column: Santa Cruz<br>value: 0.90","row: Tikopia<br>column: Tikopia<br>value: 1.00","row: Tikopia<br>column: Malekula<br>value: 0.79","row: Tikopia<br>column: Lau Fiji<br>value: 0.20","row: Tikopia<br>column: Tonga<br>value: 0.02","row: Tikopia<br>column: Hawaii<br>value: 0.00","row: Tikopia<br>column: Yap<br>value: 0.00","row: Tikopia<br>column: Chuuk<br>value: 0.00","row: Tikopia<br>column: Manus<br>value: 0.00","row: Tikopia<br>column: Trobriand<br>value: 0.01"],["row: Malekula<br>column: Santa Cruz<br>value: 0.66","row: Malekula<br>column: Tikopia<br>value: 0.79","row: Malekula<br>column: Malekula<br>value: 1.00","row: Malekula<br>column: Lau Fiji<br>value: 0.20","row: Malekula<br>column: Tonga<br>value: 0.03","row: Malekula<br>column: Hawaii<br>value: 0.00","row: Malekula<br>column: Yap<br>value: 0.00","row: Malekula<br>column: Chuuk<br>value: 0.00","row: Malekula<br>column: Manus<br>value: 0.00","row: Malekula<br>column: Trobriand<br>value: 0.01"],["row: Lau Fiji<br>column: Santa Cruz<br>value: 0.08","row: Lau Fiji<br>column: Tikopia<br>value: 0.20","row: Lau Fiji<br>column: Malekula<br>value: 0.20","row: Lau Fiji<br>column: Lau Fiji<br>value: 1.00","row: Lau Fiji<br>column: Tonga<br>value: 0.54","row: Lau Fiji<br>column: Hawaii<br>value: 0.00","row: Lau Fiji<br>column: Yap<br>value: 0.00","row: Lau Fiji<br>column: Chuuk<br>value: 0.00","row: Lau Fiji<br>column: Manus<br>value: 0.00","row: Lau Fiji<br>column: Trobriand<br>value: 0.00"],["row: Tonga<br>column: Santa Cruz<br>value: 0.00","row: Tonga<br>column: Tikopia<br>value: 0.02","row: Tonga<br>column: Malekula<br>value: 0.03","row: Tonga<br>column: Lau Fiji<br>value: 0.54","row: Tonga<br>column: Tonga<br>value: 1.00","row: Tonga<br>column: Hawaii<br>value: 0.00","row: Tonga<br>column: Yap<br>value: 0.00","row: Tonga<br>column: Chuuk<br>value: 0.00","row: Tonga<br>column: Manus<br>value: 0.00","row: Tonga<br>column: Trobriand<br>value: 0.00"],["row: Hawaii<br>column: Santa Cruz<br>value: 0.00","row: Hawaii<br>column: Tikopia<br>value: 0.00","row: Hawaii<br>column: Malekula<br>value: 0.00","row: Hawaii<br>column: Lau Fiji<br>value: 0.00","row: Hawaii<br>column: Tonga<br>value: 0.00","row: Hawaii<br>column: Hawaii<br>value: 1.00","row: Hawaii<br>column: Yap<br>value: 0.00","row: Hawaii<br>column: Chuuk<br>value: 0.00","row: Hawaii<br>column: Manus<br>value: 0.00","row: Hawaii<br>column: Trobriand<br>value: 0.00"],["row: Yap<br>column: Santa Cruz<br>value: 0.00","row: Yap<br>column: Tikopia<br>value: 0.00","row: Yap<br>column: Malekula<br>value: 0.00","row: Yap<br>column: Lau Fiji<br>value: 0.00","row: Yap<br>column: Tonga<br>value: 0.00","row: Yap<br>column: Hawaii<br>value: 0.00","row: Yap<br>column: Yap<br>value: 1.00","row: Yap<br>column: Chuuk<br>value: 0.08","row: Yap<br>column: Manus<br>value: 0.07","row: Yap<br>column: Trobriand<br>value: 0.00"],["row: Chuuk<br>column: Santa Cruz<br>value: 0.00","row: Chuuk<br>column: Tikopia<br>value: 0.00","row: Chuuk<br>column: Malekula<br>value: 0.00","row: Chuuk<br>column: Lau Fiji<br>value: 0.00","row: Chuuk<br>column: Tonga<br>value: 0.00","row: Chuuk<br>column: Hawaii<br>value: 0.00","row: Chuuk<br>column: Yap<br>value: 0.08","row: Chuuk<br>column: Chuuk<br>value: 1.00","row: Chuuk<br>column: Manus<br>value: 0.21","row: Chuuk<br>column: Trobriand<br>value: 0.03"],["row: Manus<br>column: Santa Cruz<br>value: 0.00","row: Manus<br>column: Tikopia<br>value: 0.00","row: Manus<br>column: Malekula<br>value: 0.00","row: Manus<br>column: Lau Fiji<br>value: 0.00","row: Manus<br>column: Tonga<br>value: 0.00","row: Manus<br>column: Hawaii<br>value: 0.00","row: Manus<br>column: Yap<br>value: 0.07","row: Manus<br>column: Chuuk<br>value: 0.21","row: Manus<br>column: Manus<br>value: 1.00","row: Manus<br>column: Trobriand<br>value: 0.47"],["row: Trobriand<br>column: Santa Cruz<br>value: 0.05","row: Trobriand<br>column: Tikopia<br>value: 0.01","row: Trobriand<br>column: Malekula<br>value: 0.01","row: Trobriand<br>column: Lau Fiji<br>value: 0.00","row: Trobriand<br>column: Tonga<br>value: 0.00","row: Trobriand<br>column: Hawaii<br>value: 0.00","row: Trobriand<br>column: Yap<br>value: 0.00","row: Trobriand<br>column: Chuuk<br>value: 0.03","row: Trobriand<br>column: Manus<br>value: 0.47","row: Trobriand<br>column: Trobriand<br>value: 1.00"]],"colorscale":[[0,"#31927F"],[0.01,"#2F917E"],[0.02,"#2D907E"],[0.029999999999999999,"#2B8F7E"],[0.050000000000000003,"#268D7D"],[0.070000000000000007,"#228B7D"],[0.080000000000000002,"#218A7D"],[0.20000000000000001,"#147D78"],[0.20999999999999999,"#147C77"],[0.46999999999999997,"#195C69"],[0.54000000000000004,"#1A5463"],[0.66000000000000003,"#1B465B"],[0.79000000000000004,"#1A3652"],[0.90000000000000002,"#17294B"],[1,"#151D44"]],"type":"heatmap","showscale":false,"autocolorscale":false,"showlegend":false,"xaxis":"x","yaxis":"y2","hoverinfo":"text","frame":null},{"x":[1],"y":[1],"name":"99_fb85fef0ac52b7a54430eed6208a5ebb","type":"scatter","mode":"markers","opacity":0,"hoverinfo":"skip","showlegend":false,"marker":{"color":[0,1],"colorscale":[[0,"#FFF6F4"],[0.0033444816053511683,"#FEF5F3"],[0.0066889632107023367,"#FCF4F1"],[0.010033444816053505,"#FBF4F0"],[0.013377926421404673,"#FAF3EF"],[0.016722408026755842,"#F9F2EE"],[0.02006688963210701,"#F7F1EC"],[0.023411371237458178,"#F6F0EB"],[0.026755852842809347,"#F5F0EA"],[0.030100334448160515,"#F4EFE9"],[0.033444816053511683,"#F2EEE7"],[0.036789297658862852,"#F1EDE6"],[0.04013377926421402,"#F0ECE5"],[0.043478260869565188,"#EFECE4"],[0.046822742474916357,"#EDEBE2"],[0.050167224080267581,"#ECEAE1"],[0.053511705685618749,"#EBE9E0"],[0.056856187290969917,"#EAE8DF"],[0.060200668896321086,"#E8E8DD"],[0.063545150501672254,"#E7E7DC"],[0.066889632107023422,"#E6E6DB"],[0.070234113712374591,"#E5E5DA"],[0.073578595317725759,"#E3E4D8"],[0.076923076923076927,"#E2E4D7"],[0.080267558528428096,"#E1E3D6"],[0.083612040133779264,"#E0E2D5"],[0.086956521739130432,"#DFE1D4"],[0.090301003344481601,"#DDE1D2"],[0.093645484949832769,"#DCE0D1"],[0.096989966555183937,"#DBDFD0"],[0.10033444816053511,"#DADECF"],[0.10367892976588627,"#D9DECE"],[0.10702341137123744,"#D7DDCC"],[0.11036789297658861,"#D6DCCB"],[0.11371237458193978,"#D5DBCA"],[0.11705685618729095,"#D4DBC9"],[0.12040133779264217,"#D3DAC8"],[0.12374581939799334,"#D1D9C6"],[0.12709030100334451,"#D0D8C5"],[0.13043478260869568,"#CFD8C4"],[0.13377926421404684,"#CED7C3"],[0.13712374581939801,"#CDD6C2"],[0.14046822742474918,"#CBD6C1"],[0.14381270903010035,"#CAD5C0"],[0.14715719063545152,"#C9D4BF"],[0.15050167224080269,"#C7D4BE"],[0.15384615384615385,"#C6D3BD"],[0.15719063545150502,"#C5D2BC"],[0.16053511705685619,"#C3D2BB"],[0.16387959866220736,"#C2D1BA"],[0.16722408026755853,"#C1D0B9"],[0.1705685618729097,"#BFD0B8"],[0.17391304347826086,"#BECFB7"],[0.17725752508361203,"#BDCEB6"],[0.1806020066889632,"#BCCEB5"],[0.18394648829431437,"#BACDB5"],[0.18729096989966554,"#B9CCB4"],[0.19063545150501671,"#B8CCB3"],[0.19397993311036787,"#B6CBB2"],[0.19732441471571904,"#B5CBB1"],[0.20066889632107021,"#B4CAB0"],[0.20401337792642138,"#B2C9AF"],[0.20735785953177255,"#B1C9AE"],[0.21070234113712372,"#B0C8AD"],[0.21404682274247488,"#AEC7AC"],[0.21739130434782605,"#ADC7AB"],[0.22073578595317722,"#ACC6AA"],[0.22408026755852839,"#AAC6A9"],[0.22742474916387956,"#A9C5A9"],[0.23076923076923073,"#A8C4A8"],[0.23411371237458189,"#A6C4A7"],[0.23745819397993312,"#A5C3A6"],[0.24080267558528429,"#A4C3A5"],[0.24414715719063546,"#A2C2A4"],[0.24749163879598662,"#A1C1A3"],[0.25083612040133779,"#9FC1A2"],[0.25418060200668896,"#9EC0A1"],[0.25752508361204013,"#9DC0A0"],[0.2608695652173913,"#9BBFA0"],[0.26421404682274247,"#9ABE9F"],[0.26755852842809363,"#99BE9E"],[0.2709030100334448,"#97BD9D"],[0.27424749163879597,"#96BD9D"],[0.27759197324414714,"#94BC9C"],[0.28093645484949831,"#93BB9B"],[0.28428093645484948,"#91BB9B"],[0.28762541806020064,"#90BA9A"],[0.29096989966555181,"#8EBA99"],[0.29431438127090298,"#8DB999"],[0.29765886287625415,"#8BB898"],[0.30100334448160537,"#8AB897"],[0.30434782608695654,"#88B797"],[0.30769230769230771,"#87B796"],[0.31103678929765888,"#85B695"],[0.31438127090301005,"#84B595"],[0.31772575250836121,"#82B594"],[0.32107023411371238,"#81B493"],[0.32441471571906355,"#7FB493"],[0.32775919732441472,"#7EB392"],[0.33110367892976589,"#7CB291"],[0.33444816053511706,"#7BB291"],[0.33779264214046822,"#79B190"],[0.34113712374581939,"#78B190"],[0.34448160535117056,"#76B08F"],[0.34782608695652173,"#75AF8F"],[0.3511705685618729,"#73AF8E"],[0.35451505016722407,"#72AE8E"],[0.35785953177257523,"#70AE8D"],[0.3612040133779264,"#6EAD8D"],[0.36454849498327757,"#6DAC8C"],[0.36789297658862874,"#6BAC8C"],[0.37123745819397991,"#6AAB8B"],[0.37458193979933108,"#68AB8B"],[0.37792642140468224,"#67AA8A"],[0.38127090301003341,"#65A98A"],[0.38461538461538458,"#63A989"],[0.38795986622073581,"#62A889"],[0.39130434782608697,"#60A888"],[0.39464882943143814,"#5FA788"],[0.39799331103678931,"#5DA687"],[0.40133779264214048,"#5BA687"],[0.40468227424749165,"#5AA587"],[0.40802675585284282,"#59A486"],[0.41137123745819398,"#57A486"],[0.41471571906354515,"#56A385"],[0.41806020066889632,"#54A285"],[0.42140468227424749,"#53A285"],[0.42474916387959866,"#52A184"],[0.42809364548494983,"#50A184"],[0.43143812709030099,"#4FA084"],[0.43478260869565216,"#4D9F83"],[0.43812709030100333,"#4C9F83"],[0.4414715719063545,"#4A9E83"],[0.44481605351170567,"#499D82"],[0.44816053511705684,"#479D82"],[0.451505016722408,"#459C82"],[0.45484949832775917,"#449B81"],[0.45819397993311034,"#429B81"],[0.46153846153846151,"#419A81"],[0.46488294314381268,"#3F9980"],[0.46822742474916385,"#3D9980"],[0.47157190635451507,"#3C9880"],[0.47491638795986624,"#3B9780"],[0.47826086956521741,"#3A977F"],[0.48160535117056857,"#39967F"],[0.48494983277591974,"#37957F"],[0.48829431438127091,"#36947F"],[0.49163879598662208,"#35947F"],[0.49498327759197325,"#33937F"],[0.49832775919732442,"#32927F"],[0.50167224080267558,"#31927E"],[0.50501672240802675,"#2F917E"],[0.50836120401337792,"#2E907E"],[0.51170568561872909,"#2C907E"],[0.51505016722408026,"#2B8F7E"],[0.51839464882943143,"#298E7E"],[0.52173913043478259,"#288D7E"],[0.52508361204013376,"#268D7D"],[0.52842809364548493,"#258C7D"],[0.5317725752508361,"#238B7D"],[0.53511705685618727,"#228B7D"],[0.53846153846153844,"#218A7D"],[0.5418060200668896,"#20897C"],[0.54515050167224077,"#20887C"],[0.54849498327759194,"#1F887C"],[0.55183946488294311,"#1F877C"],[0.55518394648829428,"#1E867B"],[0.55852842809364545,"#1D867B"],[0.56187290969899661,"#1D857B"],[0.56521739130434778,"#1C847B"],[0.56856187290969895,"#1B847A"],[0.57190635451505012,"#1A837A"],[0.57525083612040129,"#1A827A"],[0.57859531772575246,"#19817A"],[0.58193979933110362,"#188179"],[0.58528428093645479,"#188079"],[0.58862876254180596,"#177F79"],[0.59197324414715713,"#167F79"],[0.5953177257525083,"#157E78"],[0.59866220735785947,"#147D78"],[0.60200668896321075,"#147C78"],[0.60535117056856191,"#147C77"],[0.60869565217391308,"#157B77"],[0.61204013377926425,"#157A77"],[0.61538461538461542,"#157976"],[0.61872909698996659,"#157876"],[0.62207357859531776,"#157776"],[0.62541806020066892,"#167675"],[0.62876254180602009,"#167675"],[0.63210702341137126,"#167575"],[0.63545150501672243,"#167474"],[0.6387959866220736,"#167374"],[0.64214046822742477,"#167274"],[0.64548494983277593,"#167173"],[0.6488294314381271,"#177173"],[0.65217391304347827,"#177073"],[0.65551839464882944,"#176F72"],[0.65886287625418061,"#176E72"],[0.66220735785953178,"#176D71"],[0.66555183946488294,"#176C71"],[0.66889632107023411,"#176B71"],[0.67224080267558528,"#176B70"],[0.67558528428093645,"#176A70"],[0.67892976588628762,"#186970"],[0.68227424749163879,"#18686F"],[0.68561872909698995,"#18676F"],[0.68896321070234112,"#18676E"],[0.69230769230769229,"#18666E"],[0.69565217391304346,"#18656E"],[0.69899665551839463,"#18646D"],[0.7023411371237458,"#18636D"],[0.70568561872909696,"#18636C"],[0.70903010033444813,"#19626C"],[0.7123745819397993,"#19616C"],[0.71571906354515047,"#19606B"],[0.71906354515050164,"#195F6B"],[0.72240802675585281,"#195F6A"],[0.72575250836120397,"#195E6A"],[0.72909698996655514,"#195D6A"],[0.73244147157190631,"#195C69"],[0.73578595317725748,"#195B69"],[0.73913043478260865,"#195B68"],[0.74247491638795982,"#195A68"],[0.74581939799331098,"#195967"],[0.74916387959866215,"#195867"],[0.75250836120401332,"#195866"],[0.75585284280936449,"#1A5766"],[0.75919732441471566,"#1A5665"],[0.76254180602006683,"#1A5565"],[0.76588628762541799,"#1A5564"],[0.76923076923076916,"#1A5464"],[0.77257525083612044,"#1A5363"],[0.77591973244147161,"#1A5263"],[0.77926421404682278,"#1A5262"],[0.78260869565217395,"#1A5162"],[0.78595317725752512,"#1A5061"],[0.78929765886287628,"#1A4F61"],[0.79264214046822745,"#1A4F60"],[0.79598662207357862,"#1A4E60"],[0.79933110367892979,"#1A4D5F"],[0.80267558528428096,"#1A4C5F"],[0.80602006688963213,"#1A4C5E"],[0.80936454849498329,"#1A4B5E"],[0.81270903010033446,"#1A4A5D"],[0.81605351170568563,"#1A495D"],[0.8193979933110368,"#1B485C"],[0.82274247491638797,"#1B475C"],[0.82608695652173914,"#1B475B"],[0.8294314381270903,"#1B465B"],[0.83277591973244147,"#1B455B"],[0.83612040133779264,"#1B445A"],[0.83946488294314381,"#1B435A"],[0.84280936454849498,"#1B4359"],[0.84615384615384615,"#1B4259"],[0.84949832775919731,"#1B4158"],[0.85284280936454848,"#1B4058"],[0.85618729096989965,"#1B3F57"],[0.85953177257525082,"#1B3F57"],[0.86287625418060199,"#1B3E57"],[0.86622073578595316,"#1B3D56"],[0.86956521739130432,"#1B3C56"],[0.87290969899665549,"#1B3B55"],[0.87625418060200666,"#1B3B55"],[0.87959866220735783,"#1B3A54"],[0.882943143812709,"#1A3954"],[0.88628762541806017,"#1A3853"],[0.88963210702341133,"#1A3753"],[0.8929765886287625,"#1A3752"],[0.89632107023411367,"#1A3652"],[0.89966555183946484,"#1A3552"],[0.90301003344481601,"#1A3451"],[0.90635451505016718,"#193351"],[0.90969899665551834,"#193350"],[0.91304347826086951,"#193250"],[0.91638795986622068,"#19314F"],[0.91973244147157185,"#19304F"],[0.92307692307692302,"#192F4E"],[0.92642140468227419,"#182F4E"],[0.92976588628762535,"#182E4D"],[0.93311036789297652,"#182D4D"],[0.93645484949832769,"#182C4D"],[0.93979933110367886,"#182B4C"],[0.94314381270903014,"#182B4C"],[0.94648829431438131,"#182A4B"],[0.94983277591973247,"#17294B"],[0.95317725752508364,"#17284A"],[0.95652173913043481,"#17274A"],[0.95986622073578598,"#172749"],[0.96321070234113715,"#172649"],[0.96655518394648832,"#172549"],[0.96989966555183948,"#172448"],[0.97324414715719065,"#162348"],[0.97658862876254182,"#162347"],[0.97993311036789299,"#162247"],[0.98327759197324416,"#162146"],[0.98662207357859533,"#162046"],[0.98996655518394649,"#161F45"],[0.99331103678929766,"#151F45"],[0.99665551839464883,"#151E44"],[1,"#151D44"]],"colorbar":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.8897637795275593,"thickness":23.039999999999996,"title":null,"titlefont":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724},"tickmode":"array","ticktext":["-1.0","-0.5","0.0","0.5","1.0"],"tickvals":[0,0.25,0.5,0.75,1],"tickfont":{"color":"rgba(0,0,0,1)","family":"","size":11.68949771689498},"ticklen":2,"len":0.5},"showscale":false},"xaxis":"x","yaxis":"y2","frame":null},{"x":[1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,9,9,9,9,9,9,9,9,9,9,10,10,10,10,10,10,10,10,10,10],"y":[1,2,3,4,5,6,7,8,9,10,1,2,3,4,5,6,7,8,9,10,1,2,3,4,5,6,7,8,9,10,1,2,3,4,5,6,7,8,9,10,1,2,3,4,5,6,7,8,9,10,1,2,3,4,5,6,7,8,9,10,1,2,3,4,5,6,7,8,9,10,1,2,3,4,5,6,7,8,9,10,1,2,3,4,5,6,7,8,9,10,1,2,3,4,5,6,7,8,9,10],"text":["1","0.9","0.66","0.08","0","0","0","0","0","0.05","0.9","1","0.79","0.2","0.02","0","0","0","0","0.01","0.66","0.79","1","0.2","0.03","0","0","0","0","0.01","0.08","0.2","0.2","1","0.54","0","0","0","0","0","0","0.02","0.03","0.54","1","0","0","0","0","0","0","0","0","0","0","1","0","0","0","0","0","0","0","0","0","0","1","0.08","0.07","0","0","0","0","0","0","0","0.08","1","0.21","0.03","0","0","0","0","0","0","0.07","0.21","1","0.47","0.05","0.01","0.01","0","0","0","0","0.03","0.47","1"],"customdata":[1,0.90000000000000002,0.66000000000000003,0.080000000000000002,0,0,0,0,0,0.050000000000000003,0.90000000000000002,1,0.79000000000000004,0.20000000000000001,0.02,0,0,0,0,0.01,0.66000000000000003,0.79000000000000004,1,0.20000000000000001,0.029999999999999999,0,0,0,0,0.01,0.080000000000000002,0.20000000000000001,0.20000000000000001,1,0.54000000000000004,0,0,0,0,0,0,0.02,0.029999999999999999,0.54000000000000004,1,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,1,0.080000000000000002,0.070000000000000007,0,0,0,0,0,0,0,0.080000000000000002,1,0.20999999999999999,0.029999999999999999,0,0,0,0,0,0,0.070000000000000007,0.20999999999999999,1,0.46999999999999997,0.050000000000000003,0.01,0.01,0,0,0,0,0.029999999999999999,0.46999999999999997,1],"type":"scatter","mode":"text","textposition":["middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right","middle right"],"hovertemplate":["row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>"],"showlegend":false,"textfont":{"color":["rgba(255,255,255,1)","rgba(255,255,255,1)","rgba(255,255,255,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(255,255,255,1)","rgba(255,255,255,1)","rgba(255,255,255,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(255,255,255,1)","rgba(255,255,255,1)","rgba(255,255,255,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(255,255,255,1)","rgba(255,255,255,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(255,255,255,1)","rgba(255,255,255,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(255,255,255,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(255,255,255,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(255,255,255,1)","rgba(255,255,255,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(255,255,255,1)","rgba(255,255,255,1)","rgba(255,255,255,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(255,255,255,1)","rgba(255,255,255,1)"],"size":12},"marker":{"color":"rgba(140,86,75,1)","line":{"color":"rgba(140,86,75,1)"},"showscale":false},"error_y":{"color":"rgba(140,86,75,1)"},"error_x":{"color":"rgba(140,86,75,1)"},"line":{"color":"rgba(140,86,75,1)"},"xaxis":"x","yaxis":"y2","frame":null},{"x":[1.9326406805197907,1.9326406805197907,null,1.9326406805197907,0.51009802979427399,null,0.51009802979427399,0.51009802979427399,null,0.51009802979427399,0.23086792761230387,null,0.23086792761230387,0.23086792761230387,null,0.23086792761230387,0,null,0.23086792761230387,0.23086792761230387,null,0.23086792761230387,0,null,0.51009802979427399,0.51009802979427399,null,0.51009802979427399,0,null,1.9326406805197907,1.9326406805197907,null,1.9326406805197907,1.6272369219016634,null,1.6272369219016634,1.6272369219016634,null,1.6272369219016634,0.70064256222413435,null,0.70064256222413435,0.70064256222413435,null,0.70064256222413435,0,null,0.70064256222413435,0.70064256222413435,null,0.70064256222413435,0,null,1.6272369219016634,1.6272369219016634,null,1.6272369219016634,1.5066187308008618,null,1.5066187308008618,1.5066187308008618,null,1.5066187308008618,1.4322709240922264,null,1.4322709240922264,1.4322709240922264,null,1.4322709240922264,0,null,1.4322709240922264,1.4322709240922264,null,1.4322709240922264,1.3089308614285173,null,1.3089308614285173,1.3089308614285173,null,1.3089308614285173,0,null,1.3089308614285173,1.3089308614285173,null,1.3089308614285173,0,null,1.5066187308008618,1.5066187308008618,null,1.5066187308008618,0.77575769412877893,null,0.77575769412877893,0.77575769412877893,null,0.77575769412877893,0,null,0.77575769412877893,0.77575769412877893,null,0.77575769412877893,0],"y":[4.28125,2.25,null,2.25,2.25,null,2.25,1.5,null,1.5,1.5,null,1.5,1,null,1,1,null,1.5,2,null,2,2,null,2.25,3,null,3,3,null,4.28125,6.3125,null,6.3125,6.3125,null,6.3125,4.5,null,4.5,4.5,null,4.5,4,null,4,4,null,4.5,5,null,5,5,null,6.3125,8.125,null,8.125,8.125,null,8.125,6.75,null,6.75,6.75,null,6.75,6,null,6,6,null,6.75,7.5,null,7.5,7.5,null,7.5,7,null,7,7,null,7.5,8,null,8,8,null,8.125,9.5,null,9.5,9.5,null,9.5,9,null,9,9,null,9.5,10,null,10,10],"text":["y: 1.9326407","y: 1.9326407",null,"y: 1.9326407","y: 1.9326407",null,"y: 0.5100980","y: 0.5100980",null,"y: 0.5100980","y: 0.5100980",null,"y: 0.2308679","y: 0.2308679",null,"y: 0.2308679","y: 0.2308679",null,"y: 0.2308679","y: 0.2308679",null,"y: 0.2308679","y: 0.2308679",null,"y: 0.5100980","y: 0.5100980",null,"y: 0.5100980","y: 0.5100980",null,"y: 1.9326407","y: 1.9326407",null,"y: 1.9326407","y: 1.9326407",null,"y: 1.6272369","y: 1.6272369",null,"y: 1.6272369","y: 1.6272369",null,"y: 0.7006426","y: 0.7006426",null,"y: 0.7006426","y: 0.7006426",null,"y: 0.7006426","y: 0.7006426",null,"y: 0.7006426","y: 0.7006426",null,"y: 1.6272369","y: 1.6272369",null,"y: 1.6272369","y: 1.6272369",null,"y: 1.5066187","y: 1.5066187",null,"y: 1.5066187","y: 1.5066187",null,"y: 1.4322709","y: 1.4322709",null,"y: 1.4322709","y: 1.4322709",null,"y: 1.4322709","y: 1.4322709",null,"y: 1.4322709","y: 1.4322709",null,"y: 1.3089309","y: 1.3089309",null,"y: 1.3089309","y: 1.3089309",null,"y: 1.3089309","y: 1.3089309",null,"y: 1.3089309","y: 1.3089309",null,"y: 1.5066187","y: 1.5066187",null,"y: 1.5066187","y: 1.5066187",null,"y: 0.7757577","y: 0.7757577",null,"y: 0.7757577","y: 0.7757577",null,"y: 0.7757577","y: 0.7757577",null,"y: 0.7757577","y: 0.7757577"],"type":"scatter","mode":"lines","line":{"width":2.2677165354330708,"color":"rgba(0,0,0,1)","dash":"solid"},"hoveron":"points","showlegend":false,"xaxis":"x2","yaxis":"y2","hoverinfo":"text","frame":null},{"x":[1.9326406805197907,0.51009802979427399,0.23086792761230387,0,0,0,1.6272369219016634,0.70064256222413435,0,0,1.5066187308008618,1.4322709240922264,0,1.3089308614285173,0,0,0.77575769412877893,0,0],"y":[4.28125,2.25,1.5,1,2,3,6.3125,4.5,4,5,8.125,6.75,6,7.5,7,8,9.5,9,10],"text":["y: 1.9326407","y: 0.5100980","y: 0.2308679","y: 0.0000000","y: 0.0000000","y: 0.0000000","y: 1.6272369","y: 0.7006426","y: 0.0000000","y: 0.0000000","y: 1.5066187","y: 1.4322709","y: 0.0000000","y: 1.3089309","y: 0.0000000","y: 0.0000000","y: 0.7757577","y: 0.0000000","y: 0.0000000"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"transparent","opacity":1,"size":null,"symbol":null,"line":{"width":1.8897637795275593,"color":"transparent"}},"hoveron":"points","showlegend":false,"xaxis":"x2","yaxis":"y2","hoverinfo":"text","frame":null}],"layout":{"xaxis":{"domain":[0,0.80000000000000004],"automargin":true,"type":"linear","autorange":false,"range":[0.5,10.5],"tickmode":"array","ticktext":["Santa Cruz","Tikopia","Malekula","Lau Fiji","Tonga","Hawaii","Yap","Chuuk","Manus","Trobriand"],"tickvals":[1,2,3,4,5,6,7,8,9,10],"categoryorder":"array","categoryarray":["Santa Cruz","Tikopia","Malekula","Lau Fiji","Tonga","Hawaii","Yap","Chuuk","Manus","Trobriand"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.6529680365296811,"tickwidth":0.66417600664176002,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":13.283520132835198},"tickangle":-45,"showline":true,"linecolor":"rgba(0,0,0,1)","linewidth":0.66417600664176002,"showgrid":false,"gridcolor":null,"gridwidth":0,"zeroline":false,"anchor":"y2","title":"","hoverformat":".2f"},"xaxis2":{"domain":[0.80000000000000004,1],"automargin":true,"showticklabels":false,"showgrid":false,"zeroline":false,"anchor":"y2","type":"linear","autorange":false,"range":[0,1.9326406805197907],"tickmode":"array","ticktext":["0.0","0.5","1.0","1.5"],"tickvals":[0,0.5,1,1.5],"categoryorder":"array","categoryarray":["0.0","0.5","1.0","1.5"],"nticks":null,"ticks":"","tickcolor":null,"ticklen":3.6529680365296811,"tickwidth":0,"tickfont":{"color":null,"family":null,"size":0},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"gridcolor":null,"gridwidth":0,"title":{"text":"","font":{"color":null,"family":null,"size":0}},"hoverformat":".2f"},"yaxis2":{"domain":[0,0.80000000000000004],"automargin":true,"type":"linear","autorange":false,"range":[0.5,10.5],"tickmode":"array","ticktext":["Santa Cruz","Tikopia","Malekula","Lau Fiji","Tonga","Hawaii","Yap","Chuuk","Manus","Trobriand"],"tickvals":[1,2,3,4,5,6,7,8,9,10],"categoryorder":"array","categoryarray":["Santa Cruz","Tikopia","Malekula","Lau Fiji","Tonga","Hawaii","Yap","Chuuk","Manus","Trobriand"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.6529680365296811,"tickwidth":0.66417600664176002,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":13.283520132835205},"tickangle":-0,"showline":true,"linecolor":"rgba(0,0,0,1)","linewidth":0.66417600664176002,"showgrid":false,"gridcolor":null,"gridwidth":0,"zeroline":false,"anchor":"x","title":"","hoverformat":".2f"},"yaxis":{"domain":[0.80000000000000004,1],"automargin":true,"showticklabels":false,"showgrid":false,"zeroline":false,"anchor":"x","type":"linear","autorange":false,"range":[0,1.9326406805197907],"tickmode":"array","ticktext":["0.0","0.5","1.0","1.5"],"tickvals":[0,0.5,1,1.5],"categoryorder":"array","categoryarray":["0.0","0.5","1.0","1.5"],"nticks":null,"ticks":"","tickcolor":null,"ticklen":3.6529680365296811,"tickwidth":0,"tickfont":{"color":null,"family":null,"size":0},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"gridcolor":null,"gridwidth":0,"title":{"text":"","font":{"color":null,"family":null,"size":0}},"hoverformat":".2f"},"annotations":[],"shapes":[{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0,"x1":0.80000000000000004,"y0":0.80000000000000004,"y1":1},{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0,"x1":0.80000000000000004,"y0":0,"y1":0.80000000000000004},{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0.80000000000000004,"x1":1,"y0":0,"y1":0.80000000000000004}],"images":[],"margin":{"t":30,"r":null,"b":79.701120797011228,"l":79.701120797011228},"font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724},"showlegend":false,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.8897637795275593,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.68949771689498},"title":{"text":"","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}},"y":1,"yanchor":"top"},"hovermode":"closest","barmode":"relative","paper_bgcolor":"rgba(255,255,255,1)","title":"Correlations between Oceanic Societies in Thousands of km"},"attrs":{"3c2c1767513f":{"xend":{},"yend":{},"colour":{},"linetype":{},"size":{},"x":{},"y":{},"type":"scatter"},"3c2c593979b9":{"colour":{},"shape":{},"size":{},"x":{},"y":{}},"3c2c121e2a1d":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20]},"3c2c3d17380b":{"x":{},"y":{},"fill":{},"text":{},"type":"heatmap"},"3c2c37035c91":{"x":{},"y":{},"text":{},"customdata":{},"type":"scatter","mode":"text","textposition":"middle right","hovertemplate":"row: %{y}<br />column: %{x}<br />value: %{customdata}<extra><\/extra>","showlegend":false,"textfont":{"color":["rgba(255,255,255,1)","rgba(255,255,255,1)","rgba(255,255,255,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(255,255,255,1)","rgba(255,255,255,1)","rgba(255,255,255,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(255,255,255,1)","rgba(255,255,255,1)","rgba(255,255,255,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(255,255,255,1)","rgba(255,255,255,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(255,255,255,1)","rgba(255,255,255,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(255,255,255,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(255,255,255,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(255,255,255,1)","rgba(255,255,255,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(255,255,255,1)","rgba(255,255,255,1)","rgba(255,255,255,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(0,0,0,1)","rgba(255,255,255,1)","rgba(255,255,255,1)"],"size":12},"inherit":false},"3c2c306723d6":{"xend":{},"yend":{},"colour":{},"linetype":{},"size":{},"x":{},"y":{},"type":"scatter"},"3c2c49183214":{"colour":{},"shape":{},"size":{},"x":{},"y":{}}},"source":"A","config":{"doubleClick":"reset","modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false,"displaylogo":false,"modeBarButtonsToRemove":["sendDataToCloud","select2d","lasso2d","autoScale2d","hoverClosestCartesian","hoverCompareCartesian","sendDataToCloud"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"subplot":true,"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>and we add the correlations to our edges to be able to plot them</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>dataKline <span class="ot">&lt;-</span> <span class="fu">within</span>(dataKline, {</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># create the correlation dataframe</span></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>  cor_df <span class="ot">&lt;-</span> post14_08<span class="sc">$</span>cor</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># set lower triangle and diagonal to 0 to avoid double values.</span></span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># zeros can be removed later</span></span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a>  cor_df[<span class="fu">lower.tri</span>(cor_df, <span class="at">diag =</span> <span class="cn">FALSE</span>)] <span class="ot">&lt;-</span> <span class="cn">NA_real_</span></span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>  cor_df <span class="ot">&lt;-</span> cor_df <span class="sc">|&gt;</span></span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.data.frame</span>() <span class="sc">|&gt;</span></span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a>    tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">"x"</span>) <span class="sc">|&gt;</span></span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span>x, <span class="at">names_to =</span> <span class="st">"y"</span>, <span class="at">values_to =</span> <span class="st">"cor"</span>)</span>
<span id="cb76-11"><a href="#cb76-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb76-12"><a href="#cb76-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># make sure you don't miss a number</span></span>
<span id="cb76-13"><a href="#cb76-13" aria-hidden="true" tabindex="-1"></a>  check <span class="ot">&lt;-</span> <span class="fu">sum</span>(post14_08<span class="sc">$</span>cor[<span class="fu">lower.tri</span>(post14_08<span class="sc">$</span>cor, <span class="at">diag =</span> <span class="cn">TRUE</span>)])</span>
<span id="cb76-14"><a href="#cb76-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stopifnot</span>(<span class="fu">sum</span>(cor_df<span class="sc">$</span>cor, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">-</span> check <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb76-15"><a href="#cb76-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb76-16"><a href="#cb76-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># add the correlation to the edges</span></span>
<span id="cb76-17"><a href="#cb76-17" aria-hidden="true" tabindex="-1"></a>  edges_df <span class="ot">&lt;-</span> edges_df <span class="sc">|&gt;</span></span>
<span id="cb76-18"><a href="#cb76-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">inner_join</span>(<span class="at">y =</span> cor_df, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"x"</span> <span class="ot">=</span> <span class="st">"x"</span>, <span class="st">"y"</span> <span class="ot">=</span> <span class="st">"y"</span>))</span>
<span id="cb76-19"><a href="#cb76-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stopifnot</span>(<span class="fu">sum</span>(edges_df<span class="sc">$</span>cor, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">-</span> check <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb76-20"><a href="#cb76-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb76-21"><a href="#cb76-21" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>graph14_08 <span class="ot">&lt;-</span> <span class="fu">within</span>(graph14_08, {</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># the edges' colors</span></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>  colrs <span class="ot">&lt;-</span> paletteer<span class="sc">::</span><span class="fu">paletteer_c</span>(<span class="st">"oompaBase::bluescale"</span>, <span class="at">n =</span> <span class="dv">16</span>)</span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># create the graph object</span></span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># the manual layout requires a special treatment when using ggraph</span></span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># source for manual layout:</span></span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># https://stackoverflow.com/questions/67756538/plot-ggraph-using-supplied-node-coordinates</span></span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># must add the x and y coords to the nodes for manual layout to work</span></span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true" tabindex="-1"></a>  the_nodes <span class="ot">&lt;-</span> dataKline<span class="sc">$</span>nodes_df <span class="sc">|&gt;</span></span>
<span id="cb77-12"><a href="#cb77-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(culture, <span class="at">x =</span> lon2_pos, <span class="at">y =</span> lat_pos, logpop)</span>
<span id="cb77-13"><a href="#cb77-13" aria-hidden="true" tabindex="-1"></a>  the_edges <span class="ot">&lt;-</span> dataKline<span class="sc">$</span>edges_df <span class="sc">|&gt;</span></span>
<span id="cb77-14"><a href="#cb77-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="fu">between</span>(cor, <span class="fl">0.01</span>, <span class="dv">1</span>))</span>
<span id="cb77-15"><a href="#cb77-15" aria-hidden="true" tabindex="-1"></a>  grf <span class="ot">&lt;-</span> <span class="fu">tbl_graph</span>(<span class="at">nodes =</span> the_nodes, <span class="at">edges =</span> the_edges, <span class="at">directed =</span> <span class="cn">FALSE</span>)</span>
<span id="cb77-16"><a href="#cb77-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb77-17"><a href="#cb77-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># the basic graph</span></span>
<span id="cb77-18"><a href="#cb77-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># when we use the manual layout, when the x and y have different names to avoid</span></span>
<span id="cb77-19"><a href="#cb77-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># conflicts. See the source on manual layout mentioned above</span></span>
<span id="cb77-20"><a href="#cb77-20" aria-hidden="true" tabindex="-1"></a>  p1 <span class="ot">&lt;-</span> <span class="fu">ggraph</span>(grf, <span class="at">layout =</span> <span class="fu">data.frame</span>(<span class="at">lx =</span> <span class="cn">NA</span>, <span class="at">ly =</span> <span class="cn">NA</span>)) <span class="sc">+</span></span>
<span id="cb77-21"><a href="#cb77-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_node_point</span>(<span class="fu">aes</span>(<span class="at">size =</span> logpop), <span class="at">color =</span> <span class="st">"purple"</span>) <span class="sc">+</span></span>
<span id="cb77-22"><a href="#cb77-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_edge_link</span>(<span class="fu">aes</span>(<span class="at">color =</span> cor, <span class="at">width =</span> cor)) <span class="sc">+</span></span>
<span id="cb77-23"><a href="#cb77-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_node_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> culture), <span class="at">color =</span> <span class="st">"darkblue"</span>, <span class="at">size =</span> <span class="dv">3</span>, <span class="at">repel =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb77-24"><a href="#cb77-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_size_continuous</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">4</span>)) <span class="sc">+</span></span>
<span id="cb77-25"><a href="#cb77-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_edge_width</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="fl">0.25</span>, <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb77-26"><a href="#cb77-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_edge_color_gradientn</span>(<span class="at">colors =</span> colrs) <span class="sc">+</span></span>
<span id="cb77-27"><a href="#cb77-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb77-28"><a href="#cb77-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Relative positions of societies"</span>,</span>
<span id="cb77-29"><a href="#cb77-29" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"edges = correlation"</span>,</span>
<span id="cb77-30"><a href="#cb77-30" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"longitude in thousands of km"</span>, <span class="at">y =</span> <span class="st">"latitude in thousands of km"</span>)</span>
<span id="cb77-31"><a href="#cb77-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb77-32"><a href="#cb77-32" aria-hidden="true" tabindex="-1"></a>  <span class="co"># and we only need to change the nodes for the graph with tools and population</span></span>
<span id="cb77-33"><a href="#cb77-33" aria-hidden="true" tabindex="-1"></a>  the_nodes <span class="ot">&lt;-</span> dataKline<span class="sc">$</span>nodes_df <span class="sc">|&gt;</span></span>
<span id="cb77-34"><a href="#cb77-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(culture, <span class="at">x =</span> logpop, <span class="at">y =</span> total_tools)</span>
<span id="cb77-35"><a href="#cb77-35" aria-hidden="true" tabindex="-1"></a>  the_edges <span class="ot">&lt;-</span> dataKline<span class="sc">$</span>edges_df <span class="sc">|&gt;</span></span>
<span id="cb77-36"><a href="#cb77-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="fu">between</span>(cor, <span class="fl">0.01</span>, <span class="dv">1</span>))</span>
<span id="cb77-37"><a href="#cb77-37" aria-hidden="true" tabindex="-1"></a>  grf <span class="ot">&lt;-</span> <span class="fu">tbl_graph</span>(<span class="at">nodes =</span> the_nodes, <span class="at">edges =</span> the_edges, <span class="at">directed =</span> <span class="cn">FALSE</span>)</span>
<span id="cb77-38"><a href="#cb77-38" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb77-39"><a href="#cb77-39" aria-hidden="true" tabindex="-1"></a>  p2 <span class="ot">&lt;-</span> <span class="fu">ggraph</span>(grf, <span class="at">layout =</span> <span class="fu">data.frame</span>(<span class="at">lx =</span> <span class="cn">NA</span>, <span class="at">ly =</span> <span class="cn">NA</span>)) <span class="sc">+</span></span>
<span id="cb77-40"><a href="#cb77-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_node_point</span>(<span class="fu">aes</span>(<span class="at">size =</span> x), <span class="at">color =</span> <span class="st">"purple"</span>) <span class="sc">+</span></span>
<span id="cb77-41"><a href="#cb77-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_edge_link</span>(<span class="fu">aes</span>(<span class="at">color =</span> cor, <span class="at">width =</span> cor)) <span class="sc">+</span></span>
<span id="cb77-42"><a href="#cb77-42" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_node_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> culture), <span class="at">color =</span> <span class="st">"darkblue"</span>, <span class="at">size =</span> <span class="dv">3</span>, <span class="at">repel =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb77-43"><a href="#cb77-43" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_size_continuous</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">4</span>)) <span class="sc">+</span></span>
<span id="cb77-44"><a href="#cb77-44" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_edge_width</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="fl">0.25</span>, <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb77-45"><a href="#cb77-45" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_edge_color_gradientn</span>(<span class="at">colors =</span> colrs) <span class="sc">+</span></span>
<span id="cb77-46"><a href="#cb77-46" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb77-47"><a href="#cb77-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Relations between population and tools"</span>,</span>
<span id="cb77-48"><a href="#cb77-48" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"edges = correlation"</span>,</span>
<span id="cb77-49"><a href="#cb77-49" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"log of population"</span>, <span class="at">y =</span> <span class="st">"total tools"</span>)</span>
<span id="cb77-50"><a href="#cb77-50" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb77-51"><a href="#cb77-51" aria-hidden="true" tabindex="-1"></a><span class="fu">wrap_plots</span>(graph14_08[<span class="fu">c</span>(<span class="st">"p1"</span>, <span class="st">"p2"</span>)]) <span class="sc">+</span></span>
<span id="cb77-52"><a href="#cb77-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(<span class="at">title =</span> <span class="st">"Oceanic Gaussian Process"</span>) <span class="sc">&amp;</span></span>
<span id="cb77-53"><a href="#cb77-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">title =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"darkblue"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="ch14_covariances_files/figure-html/unnamed-chunk-38-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure 14.12</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="phylogenic-distance" class="level3" data-number="14.5.2">
<h3 data-number="14.5.2" class="anchored" data-anchor-id="phylogenic-distance"><span class="header-section-number">14.5.2</span> Phylogenic distance</h3>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>dagPhylo <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>dagPhylo <span class="ot">&lt;-</span> <span class="fu">within</span>(dagPhylo, {</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ggdag has no built-in method to faciliate using subscripts.</span></span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># This is one way to do it!</span></span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># IMPORTANT the nodes labels must be empty</span></span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a>  the_nodes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"B1"</span> <span class="ot">=</span> <span class="st">""</span>, </span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"B2"</span> <span class="ot">=</span> <span class="st">""</span>, </span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"G1"</span> <span class="ot">=</span> <span class="st">""</span>, </span>
<span id="cb78-10"><a href="#cb78-10" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"G2"</span> <span class="ot">=</span> <span class="st">""</span>,</span>
<span id="cb78-11"><a href="#cb78-11" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"U1"</span> <span class="ot">=</span> <span class="st">""</span>,</span>
<span id="cb78-12"><a href="#cb78-12" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"U2"</span> <span class="ot">=</span> <span class="st">""</span>)</span>
<span id="cb78-13"><a href="#cb78-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb78-14"><a href="#cb78-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># IMPORTANT: The text labels must follow the order of the nodes</span></span>
<span id="cb78-15"><a href="#cb78-15" aria-hidden="true" tabindex="-1"></a>  text_labels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">expression</span>(B[<span class="dv">1</span>]), <span class="fu">expression</span>(B[<span class="dv">2</span>]),</span>
<span id="cb78-16"><a href="#cb78-16" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">expression</span>(G[<span class="dv">1</span>]), <span class="fu">expression</span>(G[<span class="dv">2</span>]),</span>
<span id="cb78-17"><a href="#cb78-17" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">expression</span>(U[<span class="dv">1</span>]), <span class="fu">expression</span>(U[<span class="dv">2</span>]))</span>
<span id="cb78-18"><a href="#cb78-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb78-19"><a href="#cb78-19" aria-hidden="true" tabindex="-1"></a>  dag1 <span class="ot">&lt;-</span> ggdag<span class="sc">::</span><span class="fu">dagify</span>(G2 <span class="sc">~</span> G1 <span class="sc">+</span> U1, B2 <span class="sc">~</span> G1 <span class="sc">+</span> B1 <span class="sc">+</span> U1, U2 <span class="sc">~</span> U1,</span>
<span id="cb78-20"><a href="#cb78-20" aria-hidden="true" tabindex="-1"></a>                        <span class="at">outcome =</span> <span class="st">"B2"</span>,</span>
<span id="cb78-21"><a href="#cb78-21" aria-hidden="true" tabindex="-1"></a>                        <span class="at">exposure =</span> <span class="fu">c</span>(<span class="st">"B1"</span>, <span class="st">"G1"</span>),</span>
<span id="cb78-22"><a href="#cb78-22" aria-hidden="true" tabindex="-1"></a>                        <span class="at">latent =</span> <span class="fu">c</span>(<span class="st">"U1"</span>, <span class="st">"U2"</span>),</span>
<span id="cb78-23"><a href="#cb78-23" aria-hidden="true" tabindex="-1"></a>                       <span class="at">labels =</span> the_nodes)</span>
<span id="cb78-24"><a href="#cb78-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb78-25"><a href="#cb78-25" aria-hidden="true" tabindex="-1"></a>  p1 <span class="ot">&lt;-</span>  dag1 <span class="sc">|&gt;</span></span>
<span id="cb78-26"><a href="#cb78-26" aria-hidden="true" tabindex="-1"></a>    ggdag<span class="sc">::</span><span class="fu">ggdag_status</span>(<span class="at">layout =</span> <span class="st">"sugiyama"</span>, <span class="at">node =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb78-27"><a href="#cb78-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_dag_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> status)) <span class="sc">+</span></span>
<span id="cb78-28"><a href="#cb78-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_dag_text</span>(<span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb78-29"><a href="#cb78-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_paletteer_d</span>(<span class="st">"ggsci::nrc_npg"</span>, <span class="at">na.value =</span> <span class="st">"grey"</span>) <span class="sc">+</span></span>
<span id="cb78-30"><a href="#cb78-30" aria-hidden="true" tabindex="-1"></a>    ggdag<span class="sc">::</span><span class="fu">theme_dag_blank</span>(</span>
<span id="cb78-31"><a href="#cb78-31" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"snow"</span>, <span class="at">color =</span> <span class="st">"snow"</span>))</span>
<span id="cb78-32"><a href="#cb78-32" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb78-33"><a href="#cb78-33" aria-hidden="true" tabindex="-1"></a>dagPhylo<span class="sc">$</span>p1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="ch14_covariances_files/figure-html/chap14_dagPhylo-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>dagPhylo <span class="ot">&lt;-</span> <span class="fu">within</span>(dagPhylo, {</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>  dag2 <span class="ot">&lt;-</span> ggdag<span class="sc">::</span><span class="fu">dagify</span>(</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>    B <span class="sc">~</span> G <span class="sc">+</span> M <span class="sc">+</span> U,</span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>    G <span class="sc">~</span> M <span class="sc">+</span> U,</span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>    M <span class="sc">~</span> U,</span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a>    U <span class="sc">~</span> P,</span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">outcome =</span> <span class="st">"B"</span>,</span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">latent =</span> <span class="fu">c</span>(<span class="st">"P"</span>, <span class="st">"U"</span>),</span>
<span id="cb79-9"><a href="#cb79-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">exposure =</span> <span class="fu">c</span>(<span class="st">"G"</span>, <span class="st">"M"</span>)</span>
<span id="cb79-10"><a href="#cb79-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb79-11"><a href="#cb79-11" aria-hidden="true" tabindex="-1"></a>  p2 <span class="ot">&lt;-</span> dag2 <span class="sc">|&gt;</span></span>
<span id="cb79-12"><a href="#cb79-12" aria-hidden="true" tabindex="-1"></a>    ggdag<span class="sc">::</span><span class="fu">ggdag_status</span>(<span class="at">layout =</span> <span class="st">"sugiyama"</span>) <span class="sc">+</span></span>
<span id="cb79-13"><a href="#cb79-13" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_dag_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> status)) <span class="sc">+</span></span>
<span id="cb79-14"><a href="#cb79-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_dag_text</span>(<span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb79-15"><a href="#cb79-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_paletteer_d</span>(<span class="st">"ggsci::nrc_npg"</span>, <span class="at">na.value =</span> <span class="st">"grey"</span>) <span class="sc">+</span></span>
<span id="cb79-16"><a href="#cb79-16" aria-hidden="true" tabindex="-1"></a>    ggdag<span class="sc">::</span><span class="fu">theme_dag_blank</span>(</span>
<span id="cb79-17"><a href="#cb79-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"snow"</span>, <span class="at">color =</span> <span class="st">"snow"</span>))</span>
<span id="cb79-18"><a href="#cb79-18" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb79-19"><a href="#cb79-19" aria-hidden="true" tabindex="-1"></a>dagPhylo<span class="sc">$</span>p2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="ch14_covariances_files/figure-html/unnamed-chunk-39-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<section id="data-2" class="level4" data-number="14.5.2.1">
<h4 data-number="14.5.2.1" class="anchored" data-anchor-id="data-2"><span class="header-section-number">14.5.2.1</span> Data</h4>
<p>The data is as follows</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Primates301, <span class="at">package =</span> <span class="st">"rethinking"</span>) </span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Primates301_nex)</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(Primates301_nex)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 4
 $ edge       : int [1:594, 1:2] 302 303 304 305 306 307 308 308 309 310 ...
 $ edge.length: num [1:594] 4.16 22.03 16.81 8.59 6.54 ...
 $ Nnode      : int 294
 $ tip.label  : chr [1:301] "Allenopithecus_nigroviridis" "Cercopithecus_albogularis" "Cercopithecus_ascanius" "Cercopithecus_campbelli" ...
 - attr(*, "class")= chr "phylo"
 - attr(*, "order")= chr "cladewise"</code></pre>
</div>
</div>
<p>We standardize the data</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>dataPrimates <span class="ot">&lt;-</span> Primates301 <span class="sc">|&gt;</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">as.character</span>(name)) <span class="sc">|&gt;</span> </span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>(group_size, body, brain) <span class="sc">|&gt;</span> </span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">M =</span> <span class="fu">as.vector</span>(<span class="fu">scale</span>(<span class="fu">log</span>(body))),</span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">B =</span> <span class="fu">as.vector</span>(<span class="fu">scale</span>(<span class="fu">log</span>(brain))),</span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">G =</span> <span class="fu">as.vector</span>(<span class="fu">scale</span>(<span class="fu">log</span>(group_size))))</span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a><span class="co"># glimpse(dataPrimates)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>and to plot is we use the <code>ggtree</code> package. Details on <code>ggtree</code> can be found at <a href="https://yulab-smu.top/treedata-book/index.html">ggtree</a>. It is not available on CRAN at the time of writing this. You can find it in github and install it with <code>devtools::install_github("GuangchuangYu/ggtree")</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="co"># devtools::install_github("GuangchuangYu/ggtree")</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>ggtree<span class="sc">::</span><span class="fu">ggtree</span>(<span class="at">tr =</span> Primates301_nex, <span class="at">layout =</span> <span class="st">"circular"</span>, <span class="at">color =</span> <span class="st">"firebrick"</span>) <span class="sc">+</span></span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tiplab</span>(<span class="at">size =</span> <span class="dv">5</span><span class="sc">/</span><span class="dv">3</span>, <span class="at">color =</span> <span class="st">"darkgrey"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ch14_covariances_files/figure-html/unnamed-chunk-42-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="model-2" class="level4" data-number="14.5.2.2">
<h4 data-number="14.5.2.2" class="anchored" data-anchor-id="model-2"><span class="header-section-number">14.5.2.2</span> Model</h4>
<p><span class="math display">\[
\begin{align*}
\bf{B} &amp;\sim \mathcal{MVNormal}(\mu, \bf{S})\\
\mu_i &amp;= \alpha + \beta_G G_i + \beta_M M_i \\
\bf{S} &amp;= \sigma^2 \bf{I}
\end{align*}
\]</span></p>
<p>We begin by fitting a naive model that does not take into account the phylogenetic covariances.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>tictoc<span class="sc">::</span><span class="fu">tic</span>(<span class="at">msg =</span> <span class="fu">sprintf</span>(<span class="st">"run time of %s, use the cache."</span>, <span class="st">"60 secs."</span>))</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>fit14_09 <span class="ot">&lt;-</span> xfun<span class="sc">::</span><span class="fu">cache_rds</span>({</span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(</span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> dataPrimates,</span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> gaussian,</span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">formula =</span>  B <span class="sc">~</span> M <span class="sc">+</span> G,</span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">prior =</span> <span class="fu">c</span>(</span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">class =</span> b),</span>
<span id="cb84-10"><a href="#cb84-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb84-11"><a href="#cb84-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">iter =</span> <span class="dv">1000</span>, <span class="at">warmup =</span> <span class="dv">500</span>, <span class="at">chains =</span> <span class="dv">2</span>,</span>
<span id="cb84-12"><a href="#cb84-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">cores =</span> <span class="fu">detectCores</span>(), <span class="at">seed =</span> <span class="dv">1439</span>)},</span>
<span id="cb84-13"><a href="#cb84-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">"ch14_fit14_09"</span>, <span class="at">rerun =</span> <span class="cn">FALSE</span>)</span>
<span id="cb84-14"><a href="#cb84-14" aria-hidden="true" tabindex="-1"></a>tictoc<span class="sc">::</span><span class="fu">toc</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>run time of 60 secs., use the cache.: 0.17 sec elapsed</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>fit14_09</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Family: gaussian 
  Links: mu = identity; sigma = identity 
Formula: B ~ M + G 
   Data: dataPrimates (Number of observations: 151) 
  Draws: 2 chains, each with iter = 1000; warmup = 500; thin = 1;
         total post-warmup draws = 1000

Population-Level Effects: 
          Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
Intercept     0.00      0.02    -0.03     0.03 1.01      933      540
M             0.89      0.02     0.85     0.93 1.00      864      760
G             0.12      0.02     0.08     0.16 1.00      825      798

Family Specific Parameters: 
      Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
sigma     0.22      0.01     0.19     0.25 1.00      923      599

Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
</div>
<p>We use the <code>ape</code> package to compute the implied covariance matrix and distance matrix</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>treePhylo <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>treePhylo <span class="ot">&lt;-</span> <span class="fu">within</span>(treePhylo, {</span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>  spp_obs <span class="ot">&lt;-</span> dataPrimates<span class="sc">$</span>name</span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a>  tree_trimmed <span class="ot">&lt;-</span> ape<span class="sc">::</span><span class="fu">keep.tip</span>(Primates301_nex, spp_obs)</span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a>  Rbm <span class="ot">&lt;-</span> ape<span class="sc">::</span><span class="fu">corBrownian</span>(<span class="at">phy =</span> tree_trimmed)</span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a>  V <span class="ot">&lt;-</span> ape<span class="sc">::</span><span class="fu">vcv</span>(Rbm)</span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a>  Dmat <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">cophenetic</span>(tree_trimmed)</span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in Initialize.corPhyl(phy, dummy.df): No covariate specified, species
will be taken as ordered in the data frame. To avoid this message, specify a
covariate containing the species names with the 'form' argument.</code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="summary" class="level2" data-number="14.6">
<h2 data-number="14.6" class="anchored" data-anchor-id="summary"><span class="header-section-number">14.6</span> Summary</h2>
</section>
<section id="practice" class="level2" data-number="14.7">
<h2 data-number="14.7" class="anchored" data-anchor-id="practice"><span class="header-section-number">14.7</span> Practice</h2>


<div id="refs" class="references csl-bib-body hanging-indent" role="list" style="display: none">
<div id="ref-kurtz2020b" class="csl-entry" role="listitem">
Kurz, Solomon. 2020. <em>Statistical Rethinking with Brms</em>. 2nd ed. <a href="https://bookdown.org/content/4857/">https://bookdown.org/content/4857/</a>.
</div>
<div id="ref-elreath2020" class="csl-entry" role="listitem">
McElreath, Richard. 2020. <em>Statistical Rethinking: A Bayesian Course with Examples in <span>R</span> and Stan</em>. 2nd ed. Boca Raton, Florida: Chapman; Hall/CRC. <a href="http://www.taylorandfrancis.com">http://www.taylorandfrancis.com</a>.
</div>
</div>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./ch13_multilevels.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Multilevel Models</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./references.html" class="pagination-link">
        <span class="nav-page-text">References</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>